---
title: Migrations with Drift
---

A **migration** is the process of safely applying schema changes to an existing database without losing data. The recommended way to handle this is with Drift's command-line tools.

## The Guided Migration Workflow

### 1. Configure the Migration Tool

Create a `build.yaml` file in your project root to tell Drift's tools where to find your database class.

```yaml
targets:
  $default:
    builders:
      drift_dev:
        options:
          # This tells the tool where your database class is located.
          databases:
            my_database: lib/database.dart
```

### 2. Generate the Initial Schema

Before making any changes, run the `make-migrations` command. This creates a **snapshot** of your current database schema (version 1).

```bash
dart run drift_dev make-migrations
```

This will create a new directory (usually `drift_schemas/`) containing a JSON file representing your V1 schema.

### 3. Make Your Schema Changes in Dart

Now, you can modify your database.

- **Update the table class in `lib/database.dart`**:

  A critical rule in database management is that you cannot add a `NOT NULL` column to a table that already contains data without providing a default value. We will do this in the column definition.

  ```dart
  @DataClassName('User')
  class Users extends Table {
      IntColumn get id => integer().autoIncrement()();
      TextColumn get name => text()();

      // NEW: Add the non-nullable email column with a default value.
      TextColumn get email => text().withDefault(const Constant('no-email-provided'))();
  }
  ```

- **Bump the `schemaVersion` in `lib/database.dart`**:

  ```dart
  // lib/database.dart
  @DriftDatabase(tables: [Users])
  class AppDatabase extends _$AppDatabase {
      // ... constructor is the same

      @override
      // Bump the version to signal a schema change.
      int get schemaVersion => 2;

      // ...
  }
  ```

### 4. Generate the Migration Steps

Run the same command again. This time, Drift will compare your code with the V1 schema snapshot and generate a helper file for the migration.

```bash
dart run drift_dev make-migrations
```

This command generates a new file, `lib/database.steps.dart`, which contains boilerplate code for your migration.

### 5. Implement the Generated Step

Finally, wire up the generated helper in your `AppDatabase` class. The `database.steps.dart` file is not the migration itself; it's a helper file generated by Drift that provides the `stepByStep` function. This function gives you a structured way to write your migration logic.

Update your `AppDatabase` class in `lib/database.dart`:

```dart
import 'database.steps.dart'; // Import the generated steps file

@DriftDatabase(tables: [Users])
class AppDatabase extends _$AppDatabase {
  AppDatabase() : super(_openConnection());

  @override
  int get schemaVersion => 2;

  @override
  MigrationStrategy get migration {
    return MigrationStrategy(
      onCreate: (migrator) async {
        await migrator.createAll();
      },
      // Use the generated stepByStep helper
      onUpgrade: stepByStep(
        from1To2: (migrator, schema) async {
          // The 'schema' object is a type-safe representation of your V2 schema.
          // Simply tell the migrator to add the new column.
          await migrator.addColumn(schema.users, schema.users.email);
        },
      ),
    );
  }
}
```

The `from1To2` block is crucial. It ensures this specific migration step only runs once for users upgrading from version 1. Because we provided a default value in the table definition, Drift intelligently generates the correct SQL (`... ADD COLUMN ... DEFAULT ...`) to handle existing rows safely.

### 6. Regenerate Final Code

Run the following command one last time to update your main generated file.

```bash
dart run build_runner build --delete-conflicting-outputs
```

<Info>
  For more advanced topics, such as testing migrations, renaming columns, or
  changing a column's type, refer to the [official Drift documentation on
  migrations](https://drift.simonbinder.eu/migrations/).
</Info>
