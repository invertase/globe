import 'package:dart_style/dart_style.dart';
import 'package:globe_functions/src/spec/rpc_procedure.dart';
import 'package:globe_functions/src/spec/sourced_entry.dart';
import 'package:globe_functions/src/spec/sourced_imports.dart';
import 'package:globe_functions/src/spec/types.dart';

const header = '''
// GENERATED CODE - DO NOT MODIFY BY HAND
// This file was generated by shelf_rpc.
// ignore_for_file: non_constant_identifier_names, unused_local_variable, implementation_imports, no_leading_underscores_for_local_identifiers, prefer_null_aware_operators

''';

abstract class BaseWriter {
  BaseWriter({required this.imports, required this.entrypoints});
  final SourcedImports imports;
  final List<SourcedEntry> entrypoints;

  final formatter = DartFormatter(
    languageVersion: DartFormatter.latestLanguageVersion,
  );

  final StringBuffer b = StringBuffer(header.trimLeft());

  String write();

  String writeImports() {
    final b = StringBuffer();
    for (var i = 0; i < imports.imports.length; i++) {
      final uri = imports.imports.elementAt(i);
      b.writeln("import '$uri' as i$i;");
    }
    return b.toString();
  }
}
