// GENERATED FILE â€” DO NOT MODIFY BY HAND
// This file was generated from package.json

const packageVersion = '1.0.0';

const packageSource = r'''
var cl=Object.create;var Fn=Object.defineProperty,pl=Object.defineProperties,dl=Object.getOwnPropertyDescriptor,ml=Object.getOwnPropertyDescriptors,fl=Object.getOwnPropertyNames,an=Object.getOwnPropertySymbols,hl=Object.getPrototypeOf,Ln=Object.prototype.hasOwnProperty,Ma=Object.prototype.propertyIsEnumerable;var Na=(e,t)=>(t=Symbol[e])?t:Symbol.for("Symbol."+e);var ja=(e,t,r)=>t in e?Fn(e,t,{enumerable:true,configurable:true,writable:true,value:r}):e[t]=r,p=(e,t)=>{for(var r in t||(t={}))Ln.call(t,r)&&ja(e,r,t[r]);if(an)for(var r of an(t))Ma.call(t,r)&&ja(e,r,t[r]);return e},f=(e,t)=>pl(e,ml(t));var Ce=(e,t)=>{var r={};for(var n in e)Ln.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&an)for(var n of an(e))t.indexOf(n)<0&&Ma.call(e,n)&&(r[n]=e[n]);return r};var gl=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var yl=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of fl(t))!Ln.call(e,a)&&a!==r&&Fn(e,a,{get:()=>t[a],enumerable:!(n=dl(t,a))||n.enumerable});return e};var vl=(e,t,r)=>(r=e!=null?cl(hl(e)):{},yl(Fn(r,"default",{value:e,enumerable:true}),e));var T=(e,t,r)=>new Promise((n,a)=>{var s=u=>{try{l(r.next(u));}catch(c){a(c);}},o=u=>{try{l(r.throw(u));}catch(c){a(c);}},l=u=>u.done?n(u.value):Promise.resolve(u.value).then(s,o);l((r=r.apply(e,t)).next());});var sn=(e,t,r)=>(t=e[Na("asyncIterator")])?t.call(e):(e=e[Na("iterator")](),t={},r=(n,a)=>(a=e[n])&&(t[n]=s=>new Promise((o,l,u)=>(s=a.call(e,s),u=s.done,Promise.resolve(s.value).then(c=>o({value:c,done:u}),l)))),r("next"),r("return"),t);var Ms=gl((Cf,fr)=>{var Xu=typeof Buffer!="undefined",Ps=/"(?:_|\\u005[Ff])(?:_|\\u005[Ff])(?:p|\\u0070)(?:r|\\u0072)(?:o|\\u006[Ff])(?:t|\\u0074)(?:o|\\u006[Ff])(?:_|\\u005[Ff])(?:_|\\u005[Ff])"\s*:/,Os=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/;function Ns(e,t,r){r==null&&t!==null&&typeof t=="object"&&(r=t,t=void 0),Xu&&Buffer.isBuffer(e)&&(e=e.toString()),e&&e.charCodeAt(0)===65279&&(e=e.slice(1));let n=JSON.parse(e,t);if(n===null||typeof n!="object")return n;let a=r&&r.protoAction||"error",s=r&&r.constructorAction||"error";if(a==="ignore"&&s==="ignore")return n;if(a!=="ignore"&&s!=="ignore"){if(Ps.test(e)===false&&Os.test(e)===false)return n}else if(a!=="ignore"&&s==="ignore"){if(Ps.test(e)===false)return n}else if(Os.test(e)===false)return n;return js(n,{protoAction:a,constructorAction:s,safe:r&&r.safe})}function js(e,{protoAction:t="error",constructorAction:r="error",safe:n}={}){let a=[e];for(;a.length;){let s=a;a=[];for(let o of s){if(t!=="ignore"&&Object.prototype.hasOwnProperty.call(o,"__proto__")){if(n===true)return null;if(t==="error")throw new SyntaxError("Object contains forbidden prototype property");delete o.__proto__;}if(r!=="ignore"&&Object.prototype.hasOwnProperty.call(o,"constructor")&&Object.prototype.hasOwnProperty.call(o.constructor,"prototype")){if(n===true)return null;if(r==="error")throw new SyntaxError("Object contains forbidden prototype property");delete o.constructor;}for(let l in o){let u=o[l];u&&typeof u=="object"&&a.push(u);}}}return e}function Wn(e,t,r){let n=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return Ns(e,t,r)}finally{Error.stackTraceLimit=n;}}function Qu(e,t){let r=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return Ns(e,t,{safe:!0})}catch(n){return null}finally{Error.stackTraceLimit=r;}}fr.exports=Wn;fr.exports.default=Wn;fr.exports.parse=Wn;fr.exports.safeParse=Qu;fr.exports.scan=js;});var W;(function(e){e.assertEqual=a=>a;function t(a){}e.assertIs=t;function r(a){throw new Error}e.assertNever=r,e.arrayToEnum=a=>{let s={};for(let o of a)s[o]=o;return s},e.getValidEnumValues=a=>{let s=e.objectKeys(a).filter(l=>typeof a[a[l]]!="number"),o={};for(let l of s)o[l]=a[l];return e.objectValues(o)},e.objectValues=a=>e.objectKeys(a).map(function(s){return a[s]}),e.objectKeys=typeof Object.keys=="function"?a=>Object.keys(a):a=>{let s=[];for(let o in a)Object.prototype.hasOwnProperty.call(a,o)&&s.push(o);return s},e.find=(a,s)=>{for(let o of a)if(s(o))return o},e.isInteger=typeof Number.isInteger=="function"?a=>Number.isInteger(a):a=>typeof a=="number"&&isFinite(a)&&Math.floor(a)===a;function n(a,s=" | "){return a.map(o=>typeof o=="string"?`'${o}'`:o).join(s)}e.joinValues=n,e.jsonStringifyReplacer=(a,s)=>typeof s=="bigint"?s.toString():s;})(W||(W={}));var Jn;(function(e){e.mergeShapes=(t,r)=>p(p({},t),r);})(Jn||(Jn={}));var R=W.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),vt=e=>{switch(typeof e){case "undefined":return R.undefined;case "string":return R.string;case "number":return isNaN(e)?R.nan:R.number;case "boolean":return R.boolean;case "function":return R.function;case "bigint":return R.bigint;case "symbol":return R.symbol;case "object":return Array.isArray(e)?R.array:e===null?R.null:e.then&&typeof e.then=="function"&&e.catch&&typeof e.catch=="function"?R.promise:typeof Map!="undefined"&&e instanceof Map?R.map:typeof Set!="undefined"&&e instanceof Set?R.set:typeof Date!="undefined"&&e instanceof Date?R.date:R.object;default:return R.unknown}},w=W.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),_l=e=>JSON.stringify(e,null,2).replace(/"([^"]+)":/g,"$1:"),Le=class e extends Error{get errors(){return this.issues}constructor(t){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n];},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n];};let r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=t;}format(t){let r=t||function(s){return s.message},n={_errors:[]},a=s=>{for(let o of s.issues)if(o.code==="invalid_union")o.unionErrors.map(a);else if(o.code==="invalid_return_type")a(o.returnTypeError);else if(o.code==="invalid_arguments")a(o.argumentsError);else if(o.path.length===0)n._errors.push(r(o));else {let l=n,u=0;for(;u<o.path.length;){let c=o.path[u];u===o.path.length-1?(l[c]=l[c]||{_errors:[]},l[c]._errors.push(r(o))):l[c]=l[c]||{_errors:[]},l=l[c],u++;}}};return a(this),n}static assert(t){if(!(t instanceof e))throw new Error(`Not a ZodError: ${t}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,W.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(t=r=>r.message){let r={},n=[];for(let a of this.issues)a.path.length>0?(r[a.path[0]]=r[a.path[0]]||[],r[a.path[0]].push(t(a))):n.push(t(a));return {formErrors:n,fieldErrors:r}}get formErrors(){return this.flatten()}};Le.create=e=>new Le(e);var lr=(e,t)=>{let r;switch(e.code){case w.invalid_type:e.received===R.undefined?r="Required":r=`Expected ${e.expected}, received ${e.received}`;break;case w.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(e.expected,W.jsonStringifyReplacer)}`;break;case w.unrecognized_keys:r=`Unrecognized key(s) in object: ${W.joinValues(e.keys,", ")}`;break;case w.invalid_union:r="Invalid input";break;case w.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${W.joinValues(e.options)}`;break;case w.invalid_enum_value:r=`Invalid enum value. Expected ${W.joinValues(e.options)}, received '${e.received}'`;break;case w.invalid_arguments:r="Invalid function arguments";break;case w.invalid_return_type:r="Invalid function return type";break;case w.invalid_date:r="Invalid date";break;case w.invalid_string:typeof e.validation=="object"?"includes"in e.validation?(r=`Invalid input: must include "${e.validation.includes}"`,typeof e.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?r=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?r=`Invalid input: must end with "${e.validation.endsWith}"`:W.assertNever(e.validation):e.validation!=="regex"?r=`Invalid ${e.validation}`:r="Invalid";break;case w.too_small:e.type==="array"?r=`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:e.type==="string"?r=`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:e.type==="number"?r=`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:e.type==="date"?r=`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:r="Invalid input";break;case w.too_big:e.type==="array"?r=`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:e.type==="string"?r=`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:e.type==="number"?r=`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="bigint"?r=`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="date"?r=`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:r="Invalid input";break;case w.custom:r="Invalid input";break;case w.invalid_intersection_types:r="Intersection results could not be merged";break;case w.not_multiple_of:r=`Number must be a multiple of ${e.multipleOf}`;break;case w.not_finite:r="Number must be finite";break;default:r=t.defaultError,W.assertNever(e);}return {message:r}},Ua=lr;function bl(e){Ua=e;}function on(){return Ua}var ln=e=>{let{data:t,path:r,errorMaps:n,issueData:a}=e,s=[...r,...a.path||[]],o=f(p({},a),{path:s});if(a.message!==void 0)return f(p({},a),{path:s,message:a.message});let l="",u=n.filter(c=>!!c).slice().reverse();for(let c of u)l=c(o,{data:t,defaultError:l}).message;return f(p({},a),{path:s,message:l})},wl=[];function E(e,t){let r=on(),n=ln({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,r,r===lr?void 0:lr].filter(a=>!!a)});e.common.issues.push(n);}var Re=class e{constructor(){this.value="valid";}dirty(){this.value==="valid"&&(this.value="dirty");}abort(){this.value!=="aborted"&&(this.value="aborted");}static mergeArray(t,r){let n=[];for(let a of r){if(a.status==="aborted")return q;a.status==="dirty"&&t.dirty(),n.push(a.value);}return {status:t.value,value:n}}static mergeObjectAsync(t,r){return T(this,null,function*(){let n=[];for(let a of r){let s=yield a.key,o=yield a.value;n.push({key:s,value:o});}return e.mergeObjectSync(t,n)})}static mergeObjectSync(t,r){let n={};for(let a of r){let{key:s,value:o}=a;if(s.status==="aborted"||o.status==="aborted")return q;s.status==="dirty"&&t.dirty(),o.status==="dirty"&&t.dirty(),s.value!=="__proto__"&&(typeof o.value!="undefined"||a.alwaysSet)&&(n[s.value]=o.value);}return {status:t.value,value:n}}},q=Object.freeze({status:"aborted"}),ir=e=>({status:"dirty",value:e}),Oe=e=>({status:"valid",value:e}),Vn=e=>e.status==="aborted",zn=e=>e.status==="dirty",Ut=e=>e.status==="valid",jr=e=>typeof Promise!="undefined"&&e instanceof Promise;function un(e,t,r,n){if(typeof t=="function"?e!==t||true:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t.get(e)}function Fa(e,t,r,n,a){if(typeof t=="function"?e!==t||true:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return t.set(e,r),r}var j;(function(e){e.errToObj=t=>typeof t=="string"?{message:t}:t||{},e.toString=t=>typeof t=="string"?t:t==null?void 0:t.message;})(j||(j={}));var Or,Nr,Be=class{constructor(t,r,n,a){this._cachedPath=[],this.parent=t,this.data=r,this._path=n,this._key=a;}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},Da=(e,t)=>{if(Ut(t))return {success:true,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return {success:false,get error(){if(this._error)return this._error;let r=new Le(e.common.issues);return this._error=r,this._error}}};function Z(e){if(!e)return {};let{errorMap:t,invalid_type_error:r,required_error:n,description:a}=e;if(t&&(r||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return t?{errorMap:t,description:a}:{errorMap:(o,l)=>{var u,c;let{message:d}=e;return o.code==="invalid_enum_value"?{message:d!=null?d:l.defaultError}:typeof l.data=="undefined"?{message:(u=d!=null?d:n)!==null&&u!==void 0?u:l.defaultError}:o.code!=="invalid_type"?{message:l.defaultError}:{message:(c=d!=null?d:r)!==null&&c!==void 0?c:l.defaultError}},description:a}}var J=class{get description(){return this._def.description}_getType(t){return vt(t.data)}_getOrReturnCtx(t,r){return r||{common:t.parent.common,data:t.data,parsedType:vt(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}_processInputParams(t){return {status:new Re,ctx:{common:t.parent.common,data:t.data,parsedType:vt(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}}_parseSync(t){let r=this._parse(t);if(jr(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(t){let r=this._parse(t);return Promise.resolve(r)}parse(t,r){let n=this.safeParse(t,r);if(n.success)return n.data;throw n.error}safeParse(t,r){var n;let a={common:{issues:[],async:(n=r==null?void 0:r.async)!==null&&n!==void 0?n:false,contextualErrorMap:r==null?void 0:r.errorMap},path:(r==null?void 0:r.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:vt(t)},s=this._parseSync({data:t,path:a.path,parent:a});return Da(a,s)}"~validate"(t){var r,n;let a={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:vt(t)};if(!this["~standard"].async)try{let s=this._parseSync({data:t,path:[],parent:a});return Ut(s)?{value:s.value}:{issues:a.common.issues}}catch(s){!((n=(r=s==null?void 0:s.message)===null||r===void 0?void 0:r.toLowerCase())===null||n===void 0)&&n.includes("encountered")&&(this["~standard"].async=true),a.common={issues:[],async:true};}return this._parseAsync({data:t,path:[],parent:a}).then(s=>Ut(s)?{value:s.value}:{issues:a.common.issues})}parseAsync(t,r){return T(this,null,function*(){let n=yield this.safeParseAsync(t,r);if(n.success)return n.data;throw n.error})}safeParseAsync(t,r){return T(this,null,function*(){let n={common:{issues:[],contextualErrorMap:r==null?void 0:r.errorMap,async:true},path:(r==null?void 0:r.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:vt(t)},a=this._parse({data:t,path:n.path,parent:n}),s=yield jr(a)?a:Promise.resolve(a);return Da(n,s)})}refine(t,r){let n=a=>typeof r=="string"||typeof r=="undefined"?{message:r}:typeof r=="function"?r(a):r;return this._refinement((a,s)=>{let o=t(a),l=()=>s.addIssue(p({code:w.custom},n(a)));return typeof Promise!="undefined"&&o instanceof Promise?o.then(u=>u?true:(l(),false)):o?true:(l(),false)})}refinement(t,r){return this._refinement((n,a)=>t(n)?true:(a.addIssue(typeof r=="function"?r(n,a):r),false))}_refinement(t){return new Ze({schema:this,typeName:x.ZodEffects,effect:{type:"refinement",refinement:t}})}superRefine(t){return this._refinement(t)}constructor(t){this.spa=this.safeParseAsync,this._def=t,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:r=>this["~validate"](r)};}optional(){return qe.create(this,this._def)}nullable(){return ct.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return bt.create(this)}promise(){return Rt.create(this,this._def)}or(t){return Bt.create([this,t],this._def)}and(t){return Gt.create(this,t,this._def)}transform(t){return new Ze(f(p({},Z(this._def)),{schema:this,typeName:x.ZodEffects,effect:{type:"transform",transform:t}}))}default(t){let r=typeof t=="function"?t:()=>t;return new Xt(f(p({},Z(this._def)),{innerType:this,defaultValue:r,typeName:x.ZodDefault}))}brand(){return new Mr(p({typeName:x.ZodBranded,type:this},Z(this._def)))}catch(t){let r=typeof t=="function"?t:()=>t;return new Qt(f(p({},Z(this._def)),{innerType:this,catchValue:r,typeName:x.ZodCatch}))}describe(t){let r=this.constructor;return new r(f(p({},this._def),{description:t}))}pipe(t){return Dr.create(this,t)}readonly(){return er.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},xl=/^c[^\s-]{8,}$/i,Sl=/^[0-9a-z]+$/,Tl=/^[0-9A-HJKMNP-TV-Z]{26}$/i,Il=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,kl=/^[a-z0-9_-]{21}$/i,El=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,Al=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Cl=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Rl="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",Zn,Pl=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Ol=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,Nl=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,jl=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Ml=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Dl=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,La="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",$l=new RegExp(`^${La}$`);function Za(e){let t="[0-5]\\d";e.precision?t=`${t}\\.\\d{${e.precision}}`:e.precision==null&&(t=`${t}(\\.\\d+)?`);let r=e.precision?"+":"?";return `([01]\\d|2[0-3]):[0-5]\\d(:${t})${r}`}function ql(e){return new RegExp(`^${Za(e)}$`)}function Ja(e){let t=`${La}T${Za(e)}`,r=[];return r.push(e.local?"Z?":"Z"),e.offset&&r.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${r.join("|")})`,new RegExp(`^${t}$`)}function Ul(e,t){return !!((t==="v4"||!t)&&Pl.test(e)||(t==="v6"||!t)&&Nl.test(e))}function Fl(e,t){if(!El.test(e))return  false;try{let[r]=e.split("."),n=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),a=JSON.parse(atob(n));return !(typeof a!="object"||a===null||!a.typ||!a.alg||t&&a.alg!==t)}catch(r){return  false}}function Ll(e,t){return !!((t==="v4"||!t)&&Ol.test(e)||(t==="v6"||!t)&&jl.test(e))}var At=class e extends J{_parse(t){if(this._def.coerce&&(t.data=String(t.data)),this._getType(t)!==R.string){let s=this._getOrReturnCtx(t);return E(s,{code:w.invalid_type,expected:R.string,received:s.parsedType}),q}let n=new Re,a;for(let s of this._def.checks)if(s.kind==="min")t.data.length<s.value&&(a=this._getOrReturnCtx(t,a),E(a,{code:w.too_small,minimum:s.value,type:"string",inclusive:true,exact:false,message:s.message}),n.dirty());else if(s.kind==="max")t.data.length>s.value&&(a=this._getOrReturnCtx(t,a),E(a,{code:w.too_big,maximum:s.value,type:"string",inclusive:true,exact:false,message:s.message}),n.dirty());else if(s.kind==="length"){let o=t.data.length>s.value,l=t.data.length<s.value;(o||l)&&(a=this._getOrReturnCtx(t,a),o?E(a,{code:w.too_big,maximum:s.value,type:"string",inclusive:true,exact:true,message:s.message}):l&&E(a,{code:w.too_small,minimum:s.value,type:"string",inclusive:true,exact:true,message:s.message}),n.dirty());}else if(s.kind==="email")Cl.test(t.data)||(a=this._getOrReturnCtx(t,a),E(a,{validation:"email",code:w.invalid_string,message:s.message}),n.dirty());else if(s.kind==="emoji")Zn||(Zn=new RegExp(Rl,"u")),Zn.test(t.data)||(a=this._getOrReturnCtx(t,a),E(a,{validation:"emoji",code:w.invalid_string,message:s.message}),n.dirty());else if(s.kind==="uuid")Il.test(t.data)||(a=this._getOrReturnCtx(t,a),E(a,{validation:"uuid",code:w.invalid_string,message:s.message}),n.dirty());else if(s.kind==="nanoid")kl.test(t.data)||(a=this._getOrReturnCtx(t,a),E(a,{validation:"nanoid",code:w.invalid_string,message:s.message}),n.dirty());else if(s.kind==="cuid")xl.test(t.data)||(a=this._getOrReturnCtx(t,a),E(a,{validation:"cuid",code:w.invalid_string,message:s.message}),n.dirty());else if(s.kind==="cuid2")Sl.test(t.data)||(a=this._getOrReturnCtx(t,a),E(a,{validation:"cuid2",code:w.invalid_string,message:s.message}),n.dirty());else if(s.kind==="ulid")Tl.test(t.data)||(a=this._getOrReturnCtx(t,a),E(a,{validation:"ulid",code:w.invalid_string,message:s.message}),n.dirty());else if(s.kind==="url")try{new URL(t.data);}catch(o){a=this._getOrReturnCtx(t,a),E(a,{validation:"url",code:w.invalid_string,message:s.message}),n.dirty();}else s.kind==="regex"?(s.regex.lastIndex=0,s.regex.test(t.data)||(a=this._getOrReturnCtx(t,a),E(a,{validation:"regex",code:w.invalid_string,message:s.message}),n.dirty())):s.kind==="trim"?t.data=t.data.trim():s.kind==="includes"?t.data.includes(s.value,s.position)||(a=this._getOrReturnCtx(t,a),E(a,{code:w.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),n.dirty()):s.kind==="toLowerCase"?t.data=t.data.toLowerCase():s.kind==="toUpperCase"?t.data=t.data.toUpperCase():s.kind==="startsWith"?t.data.startsWith(s.value)||(a=this._getOrReturnCtx(t,a),E(a,{code:w.invalid_string,validation:{startsWith:s.value},message:s.message}),n.dirty()):s.kind==="endsWith"?t.data.endsWith(s.value)||(a=this._getOrReturnCtx(t,a),E(a,{code:w.invalid_string,validation:{endsWith:s.value},message:s.message}),n.dirty()):s.kind==="datetime"?Ja(s).test(t.data)||(a=this._getOrReturnCtx(t,a),E(a,{code:w.invalid_string,validation:"datetime",message:s.message}),n.dirty()):s.kind==="date"?$l.test(t.data)||(a=this._getOrReturnCtx(t,a),E(a,{code:w.invalid_string,validation:"date",message:s.message}),n.dirty()):s.kind==="time"?ql(s).test(t.data)||(a=this._getOrReturnCtx(t,a),E(a,{code:w.invalid_string,validation:"time",message:s.message}),n.dirty()):s.kind==="duration"?Al.test(t.data)||(a=this._getOrReturnCtx(t,a),E(a,{validation:"duration",code:w.invalid_string,message:s.message}),n.dirty()):s.kind==="ip"?Ul(t.data,s.version)||(a=this._getOrReturnCtx(t,a),E(a,{validation:"ip",code:w.invalid_string,message:s.message}),n.dirty()):s.kind==="jwt"?Fl(t.data,s.alg)||(a=this._getOrReturnCtx(t,a),E(a,{validation:"jwt",code:w.invalid_string,message:s.message}),n.dirty()):s.kind==="cidr"?Ll(t.data,s.version)||(a=this._getOrReturnCtx(t,a),E(a,{validation:"cidr",code:w.invalid_string,message:s.message}),n.dirty()):s.kind==="base64"?Ml.test(t.data)||(a=this._getOrReturnCtx(t,a),E(a,{validation:"base64",code:w.invalid_string,message:s.message}),n.dirty()):s.kind==="base64url"?Dl.test(t.data)||(a=this._getOrReturnCtx(t,a),E(a,{validation:"base64url",code:w.invalid_string,message:s.message}),n.dirty()):W.assertNever(s);return {status:n.value,value:t.data}}_regex(t,r,n){return this.refinement(a=>t.test(a),p({validation:r,code:w.invalid_string},j.errToObj(n)))}_addCheck(t){return new e(f(p({},this._def),{checks:[...this._def.checks,t]}))}email(t){return this._addCheck(p({kind:"email"},j.errToObj(t)))}url(t){return this._addCheck(p({kind:"url"},j.errToObj(t)))}emoji(t){return this._addCheck(p({kind:"emoji"},j.errToObj(t)))}uuid(t){return this._addCheck(p({kind:"uuid"},j.errToObj(t)))}nanoid(t){return this._addCheck(p({kind:"nanoid"},j.errToObj(t)))}cuid(t){return this._addCheck(p({kind:"cuid"},j.errToObj(t)))}cuid2(t){return this._addCheck(p({kind:"cuid2"},j.errToObj(t)))}ulid(t){return this._addCheck(p({kind:"ulid"},j.errToObj(t)))}base64(t){return this._addCheck(p({kind:"base64"},j.errToObj(t)))}base64url(t){return this._addCheck(p({kind:"base64url"},j.errToObj(t)))}jwt(t){return this._addCheck(p({kind:"jwt"},j.errToObj(t)))}ip(t){return this._addCheck(p({kind:"ip"},j.errToObj(t)))}cidr(t){return this._addCheck(p({kind:"cidr"},j.errToObj(t)))}datetime(t){var r,n;return typeof t=="string"?this._addCheck({kind:"datetime",precision:null,offset:false,local:false,message:t}):this._addCheck(p({kind:"datetime",precision:typeof(t==null?void 0:t.precision)=="undefined"?null:t==null?void 0:t.precision,offset:(r=t==null?void 0:t.offset)!==null&&r!==void 0?r:false,local:(n=t==null?void 0:t.local)!==null&&n!==void 0?n:false},j.errToObj(t==null?void 0:t.message)))}date(t){return this._addCheck({kind:"date",message:t})}time(t){return typeof t=="string"?this._addCheck({kind:"time",precision:null,message:t}):this._addCheck(p({kind:"time",precision:typeof(t==null?void 0:t.precision)=="undefined"?null:t==null?void 0:t.precision},j.errToObj(t==null?void 0:t.message)))}duration(t){return this._addCheck(p({kind:"duration"},j.errToObj(t)))}regex(t,r){return this._addCheck(p({kind:"regex",regex:t},j.errToObj(r)))}includes(t,r){return this._addCheck(p({kind:"includes",value:t,position:r==null?void 0:r.position},j.errToObj(r==null?void 0:r.message)))}startsWith(t,r){return this._addCheck(p({kind:"startsWith",value:t},j.errToObj(r)))}endsWith(t,r){return this._addCheck(p({kind:"endsWith",value:t},j.errToObj(r)))}min(t,r){return this._addCheck(p({kind:"min",value:t},j.errToObj(r)))}max(t,r){return this._addCheck(p({kind:"max",value:t},j.errToObj(r)))}length(t,r){return this._addCheck(p({kind:"length",value:t},j.errToObj(r)))}nonempty(t){return this.min(1,j.errToObj(t))}trim(){return new e(f(p({},this._def),{checks:[...this._def.checks,{kind:"trim"}]}))}toLowerCase(){return new e(f(p({},this._def),{checks:[...this._def.checks,{kind:"toLowerCase"}]}))}toUpperCase(){return new e(f(p({},this._def),{checks:[...this._def.checks,{kind:"toUpperCase"}]}))}get isDatetime(){return !!this._def.checks.find(t=>t.kind==="datetime")}get isDate(){return !!this._def.checks.find(t=>t.kind==="date")}get isTime(){return !!this._def.checks.find(t=>t.kind==="time")}get isDuration(){return !!this._def.checks.find(t=>t.kind==="duration")}get isEmail(){return !!this._def.checks.find(t=>t.kind==="email")}get isURL(){return !!this._def.checks.find(t=>t.kind==="url")}get isEmoji(){return !!this._def.checks.find(t=>t.kind==="emoji")}get isUUID(){return !!this._def.checks.find(t=>t.kind==="uuid")}get isNANOID(){return !!this._def.checks.find(t=>t.kind==="nanoid")}get isCUID(){return !!this._def.checks.find(t=>t.kind==="cuid")}get isCUID2(){return !!this._def.checks.find(t=>t.kind==="cuid2")}get isULID(){return !!this._def.checks.find(t=>t.kind==="ulid")}get isIP(){return !!this._def.checks.find(t=>t.kind==="ip")}get isCIDR(){return !!this._def.checks.find(t=>t.kind==="cidr")}get isBase64(){return !!this._def.checks.find(t=>t.kind==="base64")}get isBase64url(){return !!this._def.checks.find(t=>t.kind==="base64url")}get minLength(){let t=null;for(let r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t}get maxLength(){let t=null;for(let r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t}};At.create=e=>{var t;return new At(p({checks:[],typeName:x.ZodString,coerce:(t=e==null?void 0:e.coerce)!==null&&t!==void 0?t:false},Z(e)))};function Zl(e,t){let r=(e.toString().split(".")[1]||"").length,n=(t.toString().split(".")[1]||"").length,a=r>n?r:n,s=parseInt(e.toFixed(a).replace(".","")),o=parseInt(t.toFixed(a).replace(".",""));return s%o/Math.pow(10,a)}var Ft=class e extends J{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf;}_parse(t){if(this._def.coerce&&(t.data=Number(t.data)),this._getType(t)!==R.number){let s=this._getOrReturnCtx(t);return E(s,{code:w.invalid_type,expected:R.number,received:s.parsedType}),q}let n,a=new Re;for(let s of this._def.checks)s.kind==="int"?W.isInteger(t.data)||(n=this._getOrReturnCtx(t,n),E(n,{code:w.invalid_type,expected:"integer",received:"float",message:s.message}),a.dirty()):s.kind==="min"?(s.inclusive?t.data<s.value:t.data<=s.value)&&(n=this._getOrReturnCtx(t,n),E(n,{code:w.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:false,message:s.message}),a.dirty()):s.kind==="max"?(s.inclusive?t.data>s.value:t.data>=s.value)&&(n=this._getOrReturnCtx(t,n),E(n,{code:w.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:false,message:s.message}),a.dirty()):s.kind==="multipleOf"?Zl(t.data,s.value)!==0&&(n=this._getOrReturnCtx(t,n),E(n,{code:w.not_multiple_of,multipleOf:s.value,message:s.message}),a.dirty()):s.kind==="finite"?Number.isFinite(t.data)||(n=this._getOrReturnCtx(t,n),E(n,{code:w.not_finite,message:s.message}),a.dirty()):W.assertNever(s);return {status:a.value,value:t.data}}gte(t,r){return this.setLimit("min",t,true,j.toString(r))}gt(t,r){return this.setLimit("min",t,false,j.toString(r))}lte(t,r){return this.setLimit("max",t,true,j.toString(r))}lt(t,r){return this.setLimit("max",t,false,j.toString(r))}setLimit(t,r,n,a){return new e(f(p({},this._def),{checks:[...this._def.checks,{kind:t,value:r,inclusive:n,message:j.toString(a)}]}))}_addCheck(t){return new e(f(p({},this._def),{checks:[...this._def.checks,t]}))}int(t){return this._addCheck({kind:"int",message:j.toString(t)})}positive(t){return this._addCheck({kind:"min",value:0,inclusive:false,message:j.toString(t)})}negative(t){return this._addCheck({kind:"max",value:0,inclusive:false,message:j.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:0,inclusive:true,message:j.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:0,inclusive:true,message:j.toString(t)})}multipleOf(t,r){return this._addCheck({kind:"multipleOf",value:t,message:j.toString(r)})}finite(t){return this._addCheck({kind:"finite",message:j.toString(t)})}safe(t){return this._addCheck({kind:"min",inclusive:true,value:Number.MIN_SAFE_INTEGER,message:j.toString(t)})._addCheck({kind:"max",inclusive:true,value:Number.MAX_SAFE_INTEGER,message:j.toString(t)})}get minValue(){let t=null;for(let r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t}get maxValue(){let t=null;for(let r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t}get isInt(){return !!this._def.checks.find(t=>t.kind==="int"||t.kind==="multipleOf"&&W.isInteger(t.value))}get isFinite(){let t=null,r=null;for(let n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return  true;n.kind==="min"?(r===null||n.value>r)&&(r=n.value):n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);}return Number.isFinite(r)&&Number.isFinite(t)}};Ft.create=e=>new Ft(p({checks:[],typeName:x.ZodNumber,coerce:(e==null?void 0:e.coerce)||false},Z(e)));var Lt=class e extends J{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte;}_parse(t){if(this._def.coerce)try{t.data=BigInt(t.data);}catch(s){return this._getInvalidInput(t)}if(this._getType(t)!==R.bigint)return this._getInvalidInput(t);let n,a=new Re;for(let s of this._def.checks)s.kind==="min"?(s.inclusive?t.data<s.value:t.data<=s.value)&&(n=this._getOrReturnCtx(t,n),E(n,{code:w.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),a.dirty()):s.kind==="max"?(s.inclusive?t.data>s.value:t.data>=s.value)&&(n=this._getOrReturnCtx(t,n),E(n,{code:w.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),a.dirty()):s.kind==="multipleOf"?t.data%s.value!==BigInt(0)&&(n=this._getOrReturnCtx(t,n),E(n,{code:w.not_multiple_of,multipleOf:s.value,message:s.message}),a.dirty()):W.assertNever(s);return {status:a.value,value:t.data}}_getInvalidInput(t){let r=this._getOrReturnCtx(t);return E(r,{code:w.invalid_type,expected:R.bigint,received:r.parsedType}),q}gte(t,r){return this.setLimit("min",t,true,j.toString(r))}gt(t,r){return this.setLimit("min",t,false,j.toString(r))}lte(t,r){return this.setLimit("max",t,true,j.toString(r))}lt(t,r){return this.setLimit("max",t,false,j.toString(r))}setLimit(t,r,n,a){return new e(f(p({},this._def),{checks:[...this._def.checks,{kind:t,value:r,inclusive:n,message:j.toString(a)}]}))}_addCheck(t){return new e(f(p({},this._def),{checks:[...this._def.checks,t]}))}positive(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:false,message:j.toString(t)})}negative(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:false,message:j.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:true,message:j.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:true,message:j.toString(t)})}multipleOf(t,r){return this._addCheck({kind:"multipleOf",value:t,message:j.toString(r)})}get minValue(){let t=null;for(let r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t}get maxValue(){let t=null;for(let r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t}};Lt.create=e=>{var t;return new Lt(p({checks:[],typeName:x.ZodBigInt,coerce:(t=e==null?void 0:e.coerce)!==null&&t!==void 0?t:false},Z(e)))};var Zt=class extends J{_parse(t){if(this._def.coerce&&(t.data=!!t.data),this._getType(t)!==R.boolean){let n=this._getOrReturnCtx(t);return E(n,{code:w.invalid_type,expected:R.boolean,received:n.parsedType}),q}return Oe(t.data)}};Zt.create=e=>new Zt(p({typeName:x.ZodBoolean,coerce:(e==null?void 0:e.coerce)||false},Z(e)));var Jt=class e extends J{_parse(t){if(this._def.coerce&&(t.data=new Date(t.data)),this._getType(t)!==R.date){let s=this._getOrReturnCtx(t);return E(s,{code:w.invalid_type,expected:R.date,received:s.parsedType}),q}if(isNaN(t.data.getTime())){let s=this._getOrReturnCtx(t);return E(s,{code:w.invalid_date}),q}let n=new Re,a;for(let s of this._def.checks)s.kind==="min"?t.data.getTime()<s.value&&(a=this._getOrReturnCtx(t,a),E(a,{code:w.too_small,message:s.message,inclusive:true,exact:false,minimum:s.value,type:"date"}),n.dirty()):s.kind==="max"?t.data.getTime()>s.value&&(a=this._getOrReturnCtx(t,a),E(a,{code:w.too_big,message:s.message,inclusive:true,exact:false,maximum:s.value,type:"date"}),n.dirty()):W.assertNever(s);return {status:n.value,value:new Date(t.data.getTime())}}_addCheck(t){return new e(f(p({},this._def),{checks:[...this._def.checks,t]}))}min(t,r){return this._addCheck({kind:"min",value:t.getTime(),message:j.toString(r)})}max(t,r){return this._addCheck({kind:"max",value:t.getTime(),message:j.toString(r)})}get minDate(){let t=null;for(let r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t!=null?new Date(t):null}get maxDate(){let t=null;for(let r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t!=null?new Date(t):null}};Jt.create=e=>new Jt(p({checks:[],coerce:(e==null?void 0:e.coerce)||false,typeName:x.ZodDate},Z(e)));var ur=class extends J{_parse(t){if(this._getType(t)!==R.symbol){let n=this._getOrReturnCtx(t);return E(n,{code:w.invalid_type,expected:R.symbol,received:n.parsedType}),q}return Oe(t.data)}};ur.create=e=>new ur(p({typeName:x.ZodSymbol},Z(e)));var Vt=class extends J{_parse(t){if(this._getType(t)!==R.undefined){let n=this._getOrReturnCtx(t);return E(n,{code:w.invalid_type,expected:R.undefined,received:n.parsedType}),q}return Oe(t.data)}};Vt.create=e=>new Vt(p({typeName:x.ZodUndefined},Z(e)));var zt=class extends J{_parse(t){if(this._getType(t)!==R.null){let n=this._getOrReturnCtx(t);return E(n,{code:w.invalid_type,expected:R.null,received:n.parsedType}),q}return Oe(t.data)}};zt.create=e=>new zt(p({typeName:x.ZodNull},Z(e)));var Ct=class extends J{constructor(){super(...arguments),this._any=true;}_parse(t){return Oe(t.data)}};Ct.create=e=>new Ct(p({typeName:x.ZodAny},Z(e)));var _t=class extends J{constructor(){super(...arguments),this._unknown=true;}_parse(t){return Oe(t.data)}};_t.create=e=>new _t(p({typeName:x.ZodUnknown},Z(e)));var Xe=class extends J{_parse(t){let r=this._getOrReturnCtx(t);return E(r,{code:w.invalid_type,expected:R.never,received:r.parsedType}),q}};Xe.create=e=>new Xe(p({typeName:x.ZodNever},Z(e)));var cr=class extends J{_parse(t){if(this._getType(t)!==R.undefined){let n=this._getOrReturnCtx(t);return E(n,{code:w.invalid_type,expected:R.void,received:n.parsedType}),q}return Oe(t.data)}};cr.create=e=>new cr(p({typeName:x.ZodVoid},Z(e)));var bt=class e extends J{_parse(t){let{ctx:r,status:n}=this._processInputParams(t),a=this._def;if(r.parsedType!==R.array)return E(r,{code:w.invalid_type,expected:R.array,received:r.parsedType}),q;if(a.exactLength!==null){let o=r.data.length>a.exactLength.value,l=r.data.length<a.exactLength.value;(o||l)&&(E(r,{code:o?w.too_big:w.too_small,minimum:l?a.exactLength.value:void 0,maximum:o?a.exactLength.value:void 0,type:"array",inclusive:true,exact:true,message:a.exactLength.message}),n.dirty());}if(a.minLength!==null&&r.data.length<a.minLength.value&&(E(r,{code:w.too_small,minimum:a.minLength.value,type:"array",inclusive:true,exact:false,message:a.minLength.message}),n.dirty()),a.maxLength!==null&&r.data.length>a.maxLength.value&&(E(r,{code:w.too_big,maximum:a.maxLength.value,type:"array",inclusive:true,exact:false,message:a.maxLength.message}),n.dirty()),r.common.async)return Promise.all([...r.data].map((o,l)=>a.type._parseAsync(new Be(r,o,r.path,l)))).then(o=>Re.mergeArray(n,o));let s=[...r.data].map((o,l)=>a.type._parseSync(new Be(r,o,r.path,l)));return Re.mergeArray(n,s)}get element(){return this._def.type}min(t,r){return new e(f(p({},this._def),{minLength:{value:t,message:j.toString(r)}}))}max(t,r){return new e(f(p({},this._def),{maxLength:{value:t,message:j.toString(r)}}))}length(t,r){return new e(f(p({},this._def),{exactLength:{value:t,message:j.toString(r)}}))}nonempty(t){return this.min(1,t)}};bt.create=(e,t)=>new bt(p({type:e,minLength:null,maxLength:null,exactLength:null,typeName:x.ZodArray},Z(t)));function or(e){if(e instanceof Ue){let t={};for(let r in e.shape){let n=e.shape[r];t[r]=qe.create(or(n));}return new Ue(f(p({},e._def),{shape:()=>t}))}else return e instanceof bt?new bt(f(p({},e._def),{type:or(e.element)})):e instanceof qe?qe.create(or(e.unwrap())):e instanceof ct?ct.create(or(e.unwrap())):e instanceof ut?ut.create(e.items.map(t=>or(t))):e}var Ue=class e extends J{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend;}_getCached(){if(this._cached!==null)return this._cached;let t=this._def.shape(),r=W.objectKeys(t);return this._cached={shape:t,keys:r}}_parse(t){if(this._getType(t)!==R.object){let c=this._getOrReturnCtx(t);return E(c,{code:w.invalid_type,expected:R.object,received:c.parsedType}),q}let{status:n,ctx:a}=this._processInputParams(t),{shape:s,keys:o}=this._getCached(),l=[];if(!(this._def.catchall instanceof Xe&&this._def.unknownKeys==="strip"))for(let c in a.data)o.includes(c)||l.push(c);let u=[];for(let c of o){let d=s[c],m=a.data[c];u.push({key:{status:"valid",value:c},value:d._parse(new Be(a,m,a.path,c)),alwaysSet:c in a.data});}if(this._def.catchall instanceof Xe){let c=this._def.unknownKeys;if(c==="passthrough")for(let d of l)u.push({key:{status:"valid",value:d},value:{status:"valid",value:a.data[d]}});else if(c==="strict")l.length>0&&(E(a,{code:w.unrecognized_keys,keys:l}),n.dirty());else if(c!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else {let c=this._def.catchall;for(let d of l){let m=a.data[d];u.push({key:{status:"valid",value:d},value:c._parse(new Be(a,m,a.path,d)),alwaysSet:d in a.data});}}return a.common.async?Promise.resolve().then(()=>T(this,null,function*(){let c=[];for(let d of u){let m=yield d.key,h=yield d.value;c.push({key:m,value:h,alwaysSet:d.alwaysSet});}return c})).then(c=>Re.mergeObjectSync(n,c)):Re.mergeObjectSync(n,u)}get shape(){return this._def.shape()}strict(t){return j.errToObj,new e(p(f(p({},this._def),{unknownKeys:"strict"}),t!==void 0?{errorMap:(r,n)=>{var a,s,o,l;let u=(o=(s=(a=this._def).errorMap)===null||s===void 0?void 0:s.call(a,r,n).message)!==null&&o!==void 0?o:n.defaultError;return r.code==="unrecognized_keys"?{message:(l=j.errToObj(t).message)!==null&&l!==void 0?l:u}:{message:u}}}:{}))}strip(){return new e(f(p({},this._def),{unknownKeys:"strip"}))}passthrough(){return new e(f(p({},this._def),{unknownKeys:"passthrough"}))}extend(t){return new e(f(p({},this._def),{shape:()=>p(p({},this._def.shape()),t)}))}merge(t){return new e({unknownKeys:t._def.unknownKeys,catchall:t._def.catchall,shape:()=>p(p({},this._def.shape()),t._def.shape()),typeName:x.ZodObject})}setKey(t,r){return this.augment({[t]:r})}catchall(t){return new e(f(p({},this._def),{catchall:t}))}pick(t){let r={};return W.objectKeys(t).forEach(n=>{t[n]&&this.shape[n]&&(r[n]=this.shape[n]);}),new e(f(p({},this._def),{shape:()=>r}))}omit(t){let r={};return W.objectKeys(this.shape).forEach(n=>{t[n]||(r[n]=this.shape[n]);}),new e(f(p({},this._def),{shape:()=>r}))}deepPartial(){return or(this)}partial(t){let r={};return W.objectKeys(this.shape).forEach(n=>{let a=this.shape[n];t&&!t[n]?r[n]=a:r[n]=a.optional();}),new e(f(p({},this._def),{shape:()=>r}))}required(t){let r={};return W.objectKeys(this.shape).forEach(n=>{if(t&&!t[n])r[n]=this.shape[n];else {let s=this.shape[n];for(;s instanceof qe;)s=s._def.innerType;r[n]=s;}}),new e(f(p({},this._def),{shape:()=>r}))}keyof(){return Va(W.objectKeys(this.shape))}};Ue.create=(e,t)=>new Ue(p({shape:()=>e,unknownKeys:"strip",catchall:Xe.create(),typeName:x.ZodObject},Z(t)));Ue.strictCreate=(e,t)=>new Ue(p({shape:()=>e,unknownKeys:"strict",catchall:Xe.create(),typeName:x.ZodObject},Z(t)));Ue.lazycreate=(e,t)=>new Ue(p({shape:e,unknownKeys:"strip",catchall:Xe.create(),typeName:x.ZodObject},Z(t)));var Bt=class extends J{_parse(t){let{ctx:r}=this._processInputParams(t),n=this._def.options;function a(s){for(let l of s)if(l.result.status==="valid")return l.result;for(let l of s)if(l.result.status==="dirty")return r.common.issues.push(...l.ctx.common.issues),l.result;let o=s.map(l=>new Le(l.ctx.common.issues));return E(r,{code:w.invalid_union,unionErrors:o}),q}if(r.common.async)return Promise.all(n.map(s=>T(this,null,function*(){let o=f(p({},r),{common:f(p({},r.common),{issues:[]}),parent:null});return {result:yield s._parseAsync({data:r.data,path:r.path,parent:o}),ctx:o}}))).then(a);{let s,o=[];for(let u of n){let c=f(p({},r),{common:f(p({},r.common),{issues:[]}),parent:null}),d=u._parseSync({data:r.data,path:r.path,parent:c});if(d.status==="valid")return d;d.status==="dirty"&&!s&&(s={result:d,ctx:c}),c.common.issues.length&&o.push(c.common.issues);}if(s)return r.common.issues.push(...s.ctx.common.issues),s.result;let l=o.map(u=>new Le(u));return E(r,{code:w.invalid_union,unionErrors:l}),q}}get options(){return this._def.options}};Bt.create=(e,t)=>new Bt(p({options:e,typeName:x.ZodUnion},Z(t)));var yt=e=>e instanceof Ht?yt(e.schema):e instanceof Ze?yt(e.innerType()):e instanceof Wt?[e.value]:e instanceof Kt?e.options:e instanceof Yt?W.objectValues(e.enum):e instanceof Xt?yt(e._def.innerType):e instanceof Vt?[void 0]:e instanceof zt?[null]:e instanceof qe?[void 0,...yt(e.unwrap())]:e instanceof ct?[null,...yt(e.unwrap())]:e instanceof Mr||e instanceof er?yt(e.unwrap()):e instanceof Qt?yt(e._def.innerType):[],cn=class e extends J{_parse(t){let{ctx:r}=this._processInputParams(t);if(r.parsedType!==R.object)return E(r,{code:w.invalid_type,expected:R.object,received:r.parsedType}),q;let n=this.discriminator,a=r.data[n],s=this.optionsMap.get(a);return s?r.common.async?s._parseAsync({data:r.data,path:r.path,parent:r}):s._parseSync({data:r.data,path:r.path,parent:r}):(E(r,{code:w.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),q)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(t,r,n){let a=new Map;for(let s of r){let o=yt(s.shape[t]);if(!o.length)throw new Error(`A discriminator value for key \`${t}\` could not be extracted from all schema options`);for(let l of o){if(a.has(l))throw new Error(`Discriminator property ${String(t)} has duplicate value ${String(l)}`);a.set(l,s);}}return new e(p({typeName:x.ZodDiscriminatedUnion,discriminator:t,options:r,optionsMap:a},Z(n)))}};function Bn(e,t){let r=vt(e),n=vt(t);if(e===t)return {valid:true,data:e};if(r===R.object&&n===R.object){let a=W.objectKeys(t),s=W.objectKeys(e).filter(l=>a.indexOf(l)!==-1),o=p(p({},e),t);for(let l of s){let u=Bn(e[l],t[l]);if(!u.valid)return {valid:false};o[l]=u.data;}return {valid:true,data:o}}else if(r===R.array&&n===R.array){if(e.length!==t.length)return {valid:false};let a=[];for(let s=0;s<e.length;s++){let o=e[s],l=t[s],u=Bn(o,l);if(!u.valid)return {valid:false};a.push(u.data);}return {valid:true,data:a}}else return r===R.date&&n===R.date&&+e==+t?{valid:true,data:e}:{valid:false}}var Gt=class extends J{_parse(t){let{status:r,ctx:n}=this._processInputParams(t),a=(s,o)=>{if(Vn(s)||Vn(o))return q;let l=Bn(s.value,o.value);return l.valid?((zn(s)||zn(o))&&r.dirty(),{status:r.value,value:l.data}):(E(n,{code:w.invalid_intersection_types}),q)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([s,o])=>a(s,o)):a(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}};Gt.create=(e,t,r)=>new Gt(p({left:e,right:t,typeName:x.ZodIntersection},Z(r)));var ut=class e extends J{_parse(t){let{status:r,ctx:n}=this._processInputParams(t);if(n.parsedType!==R.array)return E(n,{code:w.invalid_type,expected:R.array,received:n.parsedType}),q;if(n.data.length<this._def.items.length)return E(n,{code:w.too_small,minimum:this._def.items.length,inclusive:true,exact:false,type:"array"}),q;!this._def.rest&&n.data.length>this._def.items.length&&(E(n,{code:w.too_big,maximum:this._def.items.length,inclusive:true,exact:false,type:"array"}),r.dirty());let s=[...n.data].map((o,l)=>{let u=this._def.items[l]||this._def.rest;return u?u._parse(new Be(n,o,n.path,l)):null}).filter(o=>!!o);return n.common.async?Promise.all(s).then(o=>Re.mergeArray(r,o)):Re.mergeArray(r,s)}get items(){return this._def.items}rest(t){return new e(f(p({},this._def),{rest:t}))}};ut.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new ut(p({items:e,typeName:x.ZodTuple,rest:null},Z(t)))};var pn=class e extends J{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){let{status:r,ctx:n}=this._processInputParams(t);if(n.parsedType!==R.object)return E(n,{code:w.invalid_type,expected:R.object,received:n.parsedType}),q;let a=[],s=this._def.keyType,o=this._def.valueType;for(let l in n.data)a.push({key:s._parse(new Be(n,l,n.path,l)),value:o._parse(new Be(n,n.data[l],n.path,l)),alwaysSet:l in n.data});return n.common.async?Re.mergeObjectAsync(r,a):Re.mergeObjectSync(r,a)}get element(){return this._def.valueType}static create(t,r,n){return r instanceof J?new e(p({keyType:t,valueType:r,typeName:x.ZodRecord},Z(n))):new e(p({keyType:At.create(),valueType:t,typeName:x.ZodRecord},Z(r)))}},pr=class extends J{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){let{status:r,ctx:n}=this._processInputParams(t);if(n.parsedType!==R.map)return E(n,{code:w.invalid_type,expected:R.map,received:n.parsedType}),q;let a=this._def.keyType,s=this._def.valueType,o=[...n.data.entries()].map(([l,u],c)=>({key:a._parse(new Be(n,l,n.path,[c,"key"])),value:s._parse(new Be(n,u,n.path,[c,"value"]))}));if(n.common.async){let l=new Map;return Promise.resolve().then(()=>T(this,null,function*(){for(let u of o){let c=yield u.key,d=yield u.value;if(c.status==="aborted"||d.status==="aborted")return q;(c.status==="dirty"||d.status==="dirty")&&r.dirty(),l.set(c.value,d.value);}return {status:r.value,value:l}}))}else {let l=new Map;for(let u of o){let c=u.key,d=u.value;if(c.status==="aborted"||d.status==="aborted")return q;(c.status==="dirty"||d.status==="dirty")&&r.dirty(),l.set(c.value,d.value);}return {status:r.value,value:l}}}};pr.create=(e,t,r)=>new pr(p({valueType:t,keyType:e,typeName:x.ZodMap},Z(r)));var dr=class e extends J{_parse(t){let{status:r,ctx:n}=this._processInputParams(t);if(n.parsedType!==R.set)return E(n,{code:w.invalid_type,expected:R.set,received:n.parsedType}),q;let a=this._def;a.minSize!==null&&n.data.size<a.minSize.value&&(E(n,{code:w.too_small,minimum:a.minSize.value,type:"set",inclusive:true,exact:false,message:a.minSize.message}),r.dirty()),a.maxSize!==null&&n.data.size>a.maxSize.value&&(E(n,{code:w.too_big,maximum:a.maxSize.value,type:"set",inclusive:true,exact:false,message:a.maxSize.message}),r.dirty());let s=this._def.valueType;function o(u){let c=new Set;for(let d of u){if(d.status==="aborted")return q;d.status==="dirty"&&r.dirty(),c.add(d.value);}return {status:r.value,value:c}}let l=[...n.data.values()].map((u,c)=>s._parse(new Be(n,u,n.path,c)));return n.common.async?Promise.all(l).then(u=>o(u)):o(l)}min(t,r){return new e(f(p({},this._def),{minSize:{value:t,message:j.toString(r)}}))}max(t,r){return new e(f(p({},this._def),{maxSize:{value:t,message:j.toString(r)}}))}size(t,r){return this.min(t,r).max(t,r)}nonempty(t){return this.min(1,t)}};dr.create=(e,t)=>new dr(p({valueType:e,minSize:null,maxSize:null,typeName:x.ZodSet},Z(t)));var dn=class e extends J{constructor(){super(...arguments),this.validate=this.implement;}_parse(t){let{ctx:r}=this._processInputParams(t);if(r.parsedType!==R.function)return E(r,{code:w.invalid_type,expected:R.function,received:r.parsedType}),q;function n(l,u){return ln({data:l,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,on(),lr].filter(c=>!!c),issueData:{code:w.invalid_arguments,argumentsError:u}})}function a(l,u){return ln({data:l,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,on(),lr].filter(c=>!!c),issueData:{code:w.invalid_return_type,returnTypeError:u}})}let s={errorMap:r.common.contextualErrorMap},o=r.data;if(this._def.returns instanceof Rt){let l=this;return Oe(function(...u){return T(this,null,function*(){let c=new Le([]),d=yield l._def.args.parseAsync(u,s).catch(_=>{throw c.addIssue(n(u,_)),c}),m=yield Reflect.apply(o,this,d);return yield l._def.returns._def.type.parseAsync(m,s).catch(_=>{throw c.addIssue(a(m,_)),c})})})}else {let l=this;return Oe(function(...u){let c=l._def.args.safeParse(u,s);if(!c.success)throw new Le([n(u,c.error)]);let d=Reflect.apply(o,this,c.data),m=l._def.returns.safeParse(d,s);if(!m.success)throw new Le([a(d,m.error)]);return m.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...t){return new e(f(p({},this._def),{args:ut.create(t).rest(_t.create())}))}returns(t){return new e(f(p({},this._def),{returns:t}))}implement(t){return this.parse(t)}strictImplement(t){return this.parse(t)}static create(t,r,n){return new e(p({args:t||ut.create([]).rest(_t.create()),returns:r||_t.create(),typeName:x.ZodFunction},Z(n)))}},Ht=class extends J{get schema(){return this._def.getter()}_parse(t){let{ctx:r}=this._processInputParams(t);return this._def.getter()._parse({data:r.data,path:r.path,parent:r})}};Ht.create=(e,t)=>new Ht(p({getter:e,typeName:x.ZodLazy},Z(t)));var Wt=class extends J{_parse(t){if(t.data!==this._def.value){let r=this._getOrReturnCtx(t);return E(r,{received:r.data,code:w.invalid_literal,expected:this._def.value}),q}return {status:"valid",value:t.data}}get value(){return this._def.value}};Wt.create=(e,t)=>new Wt(p({value:e,typeName:x.ZodLiteral},Z(t)));function Va(e,t){return new Kt(p({values:e,typeName:x.ZodEnum},Z(t)))}var Kt=class e extends J{constructor(){super(...arguments),Or.set(this,void 0);}_parse(t){if(typeof t.data!="string"){let r=this._getOrReturnCtx(t),n=this._def.values;return E(r,{expected:W.joinValues(n),received:r.parsedType,code:w.invalid_type}),q}if(un(this,Or)||Fa(this,Or,new Set(this._def.values)),!un(this,Or).has(t.data)){let r=this._getOrReturnCtx(t),n=this._def.values;return E(r,{received:r.data,code:w.invalid_enum_value,options:n}),q}return Oe(t.data)}get options(){return this._def.values}get enum(){let t={};for(let r of this._def.values)t[r]=r;return t}get Values(){let t={};for(let r of this._def.values)t[r]=r;return t}get Enum(){let t={};for(let r of this._def.values)t[r]=r;return t}extract(t,r=this._def){return e.create(t,p(p({},this._def),r))}exclude(t,r=this._def){return e.create(this.options.filter(n=>!t.includes(n)),p(p({},this._def),r))}};Or=new WeakMap;Kt.create=Va;var Yt=class extends J{constructor(){super(...arguments),Nr.set(this,void 0);}_parse(t){let r=W.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(t);if(n.parsedType!==R.string&&n.parsedType!==R.number){let a=W.objectValues(r);return E(n,{expected:W.joinValues(a),received:n.parsedType,code:w.invalid_type}),q}if(un(this,Nr)||Fa(this,Nr,new Set(W.getValidEnumValues(this._def.values))),!un(this,Nr).has(t.data)){let a=W.objectValues(r);return E(n,{received:n.data,code:w.invalid_enum_value,options:a}),q}return Oe(t.data)}get enum(){return this._def.values}};Nr=new WeakMap;Yt.create=(e,t)=>new Yt(p({values:e,typeName:x.ZodNativeEnum},Z(t)));var Rt=class extends J{unwrap(){return this._def.type}_parse(t){let{ctx:r}=this._processInputParams(t);if(r.parsedType!==R.promise&&r.common.async===false)return E(r,{code:w.invalid_type,expected:R.promise,received:r.parsedType}),q;let n=r.parsedType===R.promise?r.data:Promise.resolve(r.data);return Oe(n.then(a=>this._def.type.parseAsync(a,{path:r.path,errorMap:r.common.contextualErrorMap})))}};Rt.create=(e,t)=>new Rt(p({type:e,typeName:x.ZodPromise},Z(t)));var Ze=class extends J{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===x.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(t){let{status:r,ctx:n}=this._processInputParams(t),a=this._def.effect||null,s={addIssue:o=>{E(n,o),o.fatal?r.abort():r.dirty();},get path(){return n.path}};if(s.addIssue=s.addIssue.bind(s),a.type==="preprocess"){let o=a.transform(n.data,s);if(n.common.async)return Promise.resolve(o).then(l=>T(this,null,function*(){if(r.value==="aborted")return q;let u=yield this._def.schema._parseAsync({data:l,path:n.path,parent:n});return u.status==="aborted"?q:u.status==="dirty"||r.value==="dirty"?ir(u.value):u}));{if(r.value==="aborted")return q;let l=this._def.schema._parseSync({data:o,path:n.path,parent:n});return l.status==="aborted"?q:l.status==="dirty"||r.value==="dirty"?ir(l.value):l}}if(a.type==="refinement"){let o=l=>{let u=a.refinement(l,s);if(n.common.async)return Promise.resolve(u);if(u instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return l};if(n.common.async===false){let l=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return l.status==="aborted"?q:(l.status==="dirty"&&r.dirty(),o(l.value),{status:r.value,value:l.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(l=>l.status==="aborted"?q:(l.status==="dirty"&&r.dirty(),o(l.value).then(()=>({status:r.value,value:l.value}))))}if(a.type==="transform")if(n.common.async===false){let o=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!Ut(o))return o;let l=a.transform(o.value,s);if(l instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return {status:r.value,value:l}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(o=>Ut(o)?Promise.resolve(a.transform(o.value,s)).then(l=>({status:r.value,value:l})):o);W.assertNever(a);}};Ze.create=(e,t,r)=>new Ze(p({schema:e,typeName:x.ZodEffects,effect:t},Z(r)));Ze.createWithPreprocess=(e,t,r)=>new Ze(p({schema:t,effect:{type:"preprocess",transform:e},typeName:x.ZodEffects},Z(r)));var qe=class extends J{_parse(t){return this._getType(t)===R.undefined?Oe(void 0):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}};qe.create=(e,t)=>new qe(p({innerType:e,typeName:x.ZodOptional},Z(t)));var ct=class extends J{_parse(t){return this._getType(t)===R.null?Oe(null):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}};ct.create=(e,t)=>new ct(p({innerType:e,typeName:x.ZodNullable},Z(t)));var Xt=class extends J{_parse(t){let{ctx:r}=this._processInputParams(t),n=r.data;return r.parsedType===R.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:r.path,parent:r})}removeDefault(){return this._def.innerType}};Xt.create=(e,t)=>new Xt(p({innerType:e,typeName:x.ZodDefault,defaultValue:typeof t.default=="function"?t.default:()=>t.default},Z(t)));var Qt=class extends J{_parse(t){let{ctx:r}=this._processInputParams(t),n=f(p({},r),{common:f(p({},r.common),{issues:[]})}),a=this._def.innerType._parse({data:n.data,path:n.path,parent:p({},n)});return jr(a)?a.then(s=>({status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new Le(n.common.issues)},input:n.data})})):{status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new Le(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}};Qt.create=(e,t)=>new Qt(p({innerType:e,typeName:x.ZodCatch,catchValue:typeof t.catch=="function"?t.catch:()=>t.catch},Z(t)));var mr=class extends J{_parse(t){if(this._getType(t)!==R.nan){let n=this._getOrReturnCtx(t);return E(n,{code:w.invalid_type,expected:R.nan,received:n.parsedType}),q}return {status:"valid",value:t.data}}};mr.create=e=>new mr(p({typeName:x.ZodNaN},Z(e)));var Jl=Symbol("zod_brand"),Mr=class extends J{_parse(t){let{ctx:r}=this._processInputParams(t),n=r.data;return this._def.type._parse({data:n,path:r.path,parent:r})}unwrap(){return this._def.type}},Dr=class e extends J{_parse(t){let{status:r,ctx:n}=this._processInputParams(t);if(n.common.async)return T(this,null,function*(){let s=yield this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return s.status==="aborted"?q:s.status==="dirty"?(r.dirty(),ir(s.value)):this._def.out._parseAsync({data:s.value,path:n.path,parent:n})});{let a=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return a.status==="aborted"?q:a.status==="dirty"?(r.dirty(),{status:"dirty",value:a.value}):this._def.out._parseSync({data:a.value,path:n.path,parent:n})}}static create(t,r){return new e({in:t,out:r,typeName:x.ZodPipeline})}},er=class extends J{_parse(t){let r=this._def.innerType._parse(t),n=a=>(Ut(a)&&(a.value=Object.freeze(a.value)),a);return jr(r)?r.then(a=>n(a)):n(r)}unwrap(){return this._def.innerType}};er.create=(e,t)=>new er(p({innerType:e,typeName:x.ZodReadonly},Z(t)));function $a(e,t){let r=typeof e=="function"?e(t):typeof e=="string"?{message:e}:e;return typeof r=="string"?{message:r}:r}function za(e,t={},r){return e?Ct.create().superRefine((n,a)=>{var s,o;let l=e(n);if(l instanceof Promise)return l.then(u=>{var c,d;if(!u){let m=$a(t,n),h=(d=(c=m.fatal)!==null&&c!==void 0?c:r)!==null&&d!==void 0?d:true;a.addIssue(f(p({code:"custom"},m),{fatal:h}));}});if(!l){let u=$a(t,n),c=(o=(s=u.fatal)!==null&&s!==void 0?s:r)!==null&&o!==void 0?o:true;a.addIssue(f(p({code:"custom"},u),{fatal:c}));}}):Ct.create()}var Vl={object:Ue.lazycreate},x;(function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly";})(x||(x={}));var zl=(e,t={message:`Input not instance of ${e.name}`})=>za(r=>r instanceof e,t),Ba=At.create,Ga=Ft.create,Bl=mr.create,Gl=Lt.create,Ha=Zt.create,Hl=Jt.create,Wl=ur.create,Kl=Vt.create,Yl=zt.create,Xl=Ct.create,Ql=_t.create,eu=Xe.create,tu=cr.create,ru=bt.create,nu=Ue.create,au=Ue.strictCreate,su=Bt.create,ou=cn.create,iu=Gt.create,lu=ut.create,uu=pn.create,cu=pr.create,pu=dr.create,du=dn.create,mu=Ht.create,fu=Wt.create,hu=Kt.create,gu=Yt.create,yu=Rt.create,qa=Ze.create,vu=qe.create,_u=ct.create,bu=Ze.createWithPreprocess,wu=Dr.create,xu=()=>Ba().optional(),Su=()=>Ga().optional(),Tu=()=>Ha().optional(),Iu={string:e=>At.create(f(p({},e),{coerce:true})),number:e=>Ft.create(f(p({},e),{coerce:true})),boolean:e=>Zt.create(f(p({},e),{coerce:true})),bigint:e=>Lt.create(f(p({},e),{coerce:true})),date:e=>Jt.create(f(p({},e),{coerce:true}))},ku=q,i=Object.freeze({__proto__:null,defaultErrorMap:lr,setErrorMap:bl,getErrorMap:on,makeIssue:ln,EMPTY_PATH:wl,addIssueToContext:E,ParseStatus:Re,INVALID:q,DIRTY:ir,OK:Oe,isAborted:Vn,isDirty:zn,isValid:Ut,isAsync:jr,get util(){return W},get objectUtil(){return Jn},ZodParsedType:R,getParsedType:vt,ZodType:J,datetimeRegex:Ja,ZodString:At,ZodNumber:Ft,ZodBigInt:Lt,ZodBoolean:Zt,ZodDate:Jt,ZodSymbol:ur,ZodUndefined:Vt,ZodNull:zt,ZodAny:Ct,ZodUnknown:_t,ZodNever:Xe,ZodVoid:cr,ZodArray:bt,ZodObject:Ue,ZodUnion:Bt,ZodDiscriminatedUnion:cn,ZodIntersection:Gt,ZodTuple:ut,ZodRecord:pn,ZodMap:pr,ZodSet:dr,ZodFunction:dn,ZodLazy:Ht,ZodLiteral:Wt,ZodEnum:Kt,ZodNativeEnum:Yt,ZodPromise:Rt,ZodEffects:Ze,ZodTransformer:Ze,ZodOptional:qe,ZodNullable:ct,ZodDefault:Xt,ZodCatch:Qt,ZodNaN:mr,BRAND:Jl,ZodBranded:Mr,ZodPipeline:Dr,ZodReadonly:er,custom:za,Schema:J,ZodSchema:J,late:Vl,get ZodFirstPartyTypeKind(){return x},coerce:Iu,any:Xl,array:ru,bigint:Gl,boolean:Ha,date:Hl,discriminatedUnion:ou,effect:qa,enum:hu,function:du,instanceof:zl,intersection:iu,lazy:mu,literal:fu,map:cu,nan:Bl,nativeEnum:gu,never:eu,null:Yl,nullable:_u,number:Ga,object:nu,oboolean:Tu,onumber:Su,optional:vu,ostring:xu,pipeline:wu,preprocess:bu,promise:yu,record:uu,set:pu,strictObject:au,string:Ba,symbol:Wl,transformer:qa,tuple:lu,undefined:Kl,union:su,unknown:Ql,void:tu,NEVER:ku,ZodIssueCode:w,quotelessJson:_l,ZodError:Le});var $r=class{static convert(t){return this.parseSchema(t)}static matchesCondition(t,r){if(!r.properties)return  true;if(typeof t!="object"||t===null||Array.isArray(t))return  false;let n=t;for(let[a,s]of Object.entries(r.properties)){if(!(a in n)){if("const"in s)return  false;continue}let o=n[a];if("const"in s&&o!==s.const||"minimum"in s&&typeof o=="number"&&o<s.minimum||"maximum"in s&&typeof o=="number"&&o>s.maximum)return  false}return  true}static validateConditionalSchema(t,r,n){this.validateRequiredProperties(t,r,n),this.validatePropertyPatterns(t,r,n),this.validateNestedConditions(t,r,n);}static validateRequiredProperties(t,r,n){if(r.required){if(typeof t!="object"||t===null){for(let a of r.required)n.addIssue({code:i.ZodIssueCode.custom,message:`Required property '${a}' is missing`,path:[a]});return}for(let a of r.required)a in t||n.addIssue({code:i.ZodIssueCode.custom,message:`Required property '${a}' is missing`,path:[a]});}}static validatePropertyPatterns(t,r,n){if(!r.properties||typeof t!="object"||t===null||Array.isArray(t))return;let a=t;for(let[s,o]of Object.entries(r.properties)){if(!(s in a))continue;let l=a[s];o.pattern&&typeof l=="string"&&(new RegExp(o.pattern).test(l)||n.addIssue({code:i.ZodIssueCode.custom,message:`String '${l}' does not match pattern '${o.pattern}'`,path:[s]}));}}static validateNestedConditions(t,r,n){if(!r.if||!r.then)return;this.matchesCondition(t,r.if)?this.validateConditionalSchema(t,r.then,n):r.else&&this.validateConditionalSchema(t,r.else,n);}static parseSchema(t){return Array.isArray(t.type)?this.handleTypeArray(t):t.oneOf||t.anyOf||t.allOf?this.parseCombinator(t):t.if&&t.then?this.parseObject(t):t.properties&&(!t.type||t.type==="object")?this.parseObject(t):this.handleSingleType(t)}static handleTypeArray(t){if(!Array.isArray(t.type))throw new Error("Expected schema.type to be an array");return t.type.includes("null")?this.handleNullableType(t):this.createUnionFromTypes(t.type,t)}static handleNullableType(t){if(!Array.isArray(t.type))throw new Error("Expected schema.type to be an array");let r=p({},t);return r.type=t.type.filter(a=>a!=="null"),r.type.length===1?this.handleSingleType(f(p({},t),{type:r.type[0]})).nullable():this.parseSchema(r).nullable()}static createUnionFromTypes(t,r){let n=t.map(a=>{let s=f(p({},r),{type:a});return this.parseSchema(s)});return i.union(n)}static handleSingleType(t){if(t.type===void 0)return t.oneOf||t.anyOf||t.allOf?this.parseCombinator(t):t.properties?this.parseObject(t):i.any();switch(t.type){case "string":return this.parseString(t);case "number":case "integer":return this.parseNumberSchema(t);case "boolean":return i.boolean();case "array":return this.parseArray(t);case "object":return this.parseObject(t);default:throw new Error("Unsupported schema type")}}static parseNumberSchema(t){let r=i.number(),n=r;return n=this.applyNumberBounds(r,t),n=this.applyNumberMultipleOf(r,t),n=this.applyNumberEnum(r,t),n=this.applyIntegerConstraint(r,t),n}static applyNumberBounds(t,r){let n=t;return r.minimum!==void 0&&(n=r.exclusiveMinimum?n.gt(r.minimum):n.gte(r.minimum)),r.maximum!==void 0&&(n=r.exclusiveMaximum?n.lt(r.maximum):n.lte(r.maximum)),n}static applyNumberMultipleOf(t,r){return r.multipleOf===void 0?t:t.refine(n=>n%r.multipleOf===0,{message:`Number must be a multiple of ${r.multipleOf}`})}static applyNumberEnum(t,r){if(!r.enum)return t;let n=r.enum.filter(a=>typeof a=="number");return n.length===0?t:t.refine(a=>n.includes(a),{message:`Number must be one of: ${n.join(", ")}`})}static applyIntegerConstraint(t,r){return r.type!=="integer"?t:t.refine(n=>Number.isInteger(n),{message:"Number must be an integer"})}static parseString(t){let r=i.string(),n=r;return t.format?this.applyStringFormat(r,t):(n=this.applyStringPattern(r,t),n=this.applyStringLength(r,t),n=this.applyStringEnum(r,t),n)}static applyStringFormat(t,r){if(!r.format)return t;switch(r.format){case "email":return t.email();case "date-time":return t.datetime();case "uri":return t.url();case "uuid":return t.uuid();case "date":return t.date();default:return t}}static applyStringPattern(t,r){if(!r.pattern)return t;let n=new RegExp(r.pattern);return t.regex(n,{message:`String must match pattern: ${r.pattern}`})}static applyStringLength(t,r){let n=t;return r.minLength!==void 0&&(t=t.min(r.minLength)),r.maxLength!==void 0&&(t=t.max(r.maxLength)),n}static applyStringEnum(t,r){var n;return r.enum?t.refine(a=>{var s;return (s=r.enum)==null?void 0:s.includes(a)},{message:`Value must be one of: ${(n=r.enum)==null?void 0:n.join(", ")}`}):t}static parseArray(t){if(Array.isArray(t.items)){let s=t.items.map(o=>this.parseSchema(o));return i.union(s)}let r=t.items?this.parseSchema(t.items):i.any(),n=i.array(r),a=n;return a=this.applyArrayConstraints(n,t),a}static applyArrayConstraints(t,r){return r.minItems!==void 0&&(t=t.min(r.minItems)),r.maxItems!==void 0&&(t=t.max(r.maxItems)),r.uniqueItems?t.refine(n=>new Set(n).size===n.length,{message:"Array items must be unique"}):t}static parseObject(t){if(t.if&&t.then)return this.parseConditional(t);let r={};return this.processObjectProperties(t,r),this.processAdditionalProperties(t,i.object(r))}static processObjectProperties(t,r){let n=new Set(t.required||[]);if(t.properties)for(let[a,s]of Object.entries(t.properties)){let o=this.parseSchema(s);r[a]=n.has(a)?o:o.optional();}}static processAdditionalProperties(t,r){if(t.additionalProperties===true)return r.passthrough();if(t.additionalProperties&&typeof t.additionalProperties=="object"){let n=this.parseSchema(t.additionalProperties);return r.catchall(n)}else return r.strict()}static parseConditional(t){let r=this.createBaseObjectSchema(t),n=t.if,a=t.then,s=t.else;return r.superRefine((o,l)=>{let u=this.applyDefaultValues(o,t);this.matchesCondition(u,n)?this.validateConditionalSchema(u,a,l):s&&this.validateConditionalSchema(u,s,l);})}static createBaseObjectSchema(t){let r={},n=new Set(t.required||[]);for(let[s,o]of Object.entries(t.properties||{})){let l=this.parseSchema(o);r[s]=n.has(s)?l:l.optional();}let a=i.object(r);return this.processAdditionalProperties(t,a)}static applyDefaultValues(t,r){if(typeof t!="object"||t===null||Array.isArray(t))return t;let a=p({},t);if(!r.properties)return a;for(let[s,o]of Object.entries(r.properties))!(s in a)&&"default"in o&&(a[s]=o.default);return a}static parseCombinator(t){if(t.oneOf)return this.parseOneOf(t.oneOf);if(t.anyOf)return this.parseAnyOf(t.anyOf);if(t.allOf)return this.parseAllOf(t.allOf);throw new Error("Unsupported schema type")}static parseOneOf(t){return this.createUnionFromSchemas(t)}static parseAnyOf(t){return this.createUnionFromSchemas(t)}static createUnionFromSchemas(t){if(t.length===0)return i.any();if(t.length===1)return this.parseSchema(t[0]);let r=[];for(let n of t)n.type==="null"?r.push(i.null()):r.push(this.parseSchema(n));return r.length>=2?i.union(r):r.length===1?r[0]:i.any()}static parseAllOf(t){if(t.length===0)return i.any();if(t.length===1)return this.parseSchema(t[0]);let r=t.reduce((n,a)=>this.mergeSchemas(n,a));return this.parseSchema(r)}static mergeSchemas(t,r){let n=p(p({},t),r);if(t.properties&&r.properties){let a=p(p({},t.properties),r.properties);n.properties=a;}if(t.required&&r.required){let a=[...new Set([...t.required,...r.required])];n.required=a;}return n}};var Wa="vercel.ai.error",Eu=Symbol.for(Wa),Ka,Au=class Ya extends Error{constructor({name:t,message:r,cause:n}){super(r),this[Ka]=true,this.name=t,this.cause=n;}static isInstance(t){return Ya.hasMarker(t,Wa)}static hasMarker(t,r){let n=Symbol.for(r);return t!=null&&typeof t=="object"&&n in t&&typeof t[n]=="boolean"&&t[n]===true}};Ka=Eu;var N=Au,Xa="AI_APICallError",Qa=`vercel.ai.error.${Xa}`,Cu=Symbol.for(Qa),es,Ne=class extends N{constructor({message:e,url:t,requestBodyValues:r,statusCode:n,responseHeaders:a,responseBody:s,cause:o,isRetryable:l=n!=null&&(n===408||n===409||n===429||n>=500),data:u}){super({name:Xa,message:e,cause:o}),this[es]=true,this.url=t,this.requestBodyValues=r,this.statusCode=n,this.responseHeaders=a,this.responseBody=s,this.isRetryable=l,this.data=u;}static isInstance(e){return N.hasMarker(e,Qa)}};es=Cu;var ts="AI_EmptyResponseBodyError",rs=`vercel.ai.error.${ts}`,Ru=Symbol.for(rs),ns,as=class extends N{constructor({message:e="Empty response body"}={}){super({name:ts,message:e}),this[ns]=true;}static isInstance(e){return N.hasMarker(e,rs)}};ns=Ru;function Pt(e){return e==null?"unknown error":typeof e=="string"?e:e instanceof Error?e.message:JSON.stringify(e)}var ss="AI_InvalidArgumentError",os=`vercel.ai.error.${ss}`,Pu=Symbol.for(os),is,fn=class extends N{constructor({message:e,cause:t,argument:r}){super({name:ss,message:e,cause:t}),this[is]=true,this.argument=r;}static isInstance(e){return N.hasMarker(e,os)}};is=Pu;var ls="AI_InvalidPromptError",us=`vercel.ai.error.${ls}`,Ou=Symbol.for(us),cs,Qe=class extends N{constructor({prompt:e,message:t,cause:r}){super({name:ls,message:`Invalid prompt: ${t}`,cause:r}),this[cs]=true,this.prompt=e;}static isInstance(e){return N.hasMarker(e,us)}};cs=Ou;var ps="AI_InvalidResponseDataError",ds=`vercel.ai.error.${ps}`,Nu=Symbol.for(ds),ms,hn=class extends N{constructor({data:e,message:t=`Invalid response data: ${JSON.stringify(e)}.`}){super({name:ps,message:t}),this[ms]=true,this.data=e;}static isInstance(e){return N.hasMarker(e,ds)}};ms=Nu;var fs="AI_JSONParseError",hs=`vercel.ai.error.${fs}`,ju=Symbol.for(hs),gs,tr=class extends N{constructor({text:e,cause:t}){super({name:fs,message:`JSON parsing failed: Text: ${e}.
Error message: ${Pt(t)}`,cause:t}),this[gs]=true,this.text=e;}static isInstance(e){return N.hasMarker(e,hs)}};gs=ju;var ys="AI_LoadAPIKeyError",vs=`vercel.ai.error.${ys}`,Mu=Symbol.for(vs),_s,qr=class extends N{constructor({message:e}){super({name:ys,message:e}),this[_s]=true;}static isInstance(e){return N.hasMarker(e,vs)}};_s=Mu;var bs="AI_TooManyEmbeddingValuesForCallError",ws=`vercel.ai.error.${bs}`,Hu=Symbol.for(ws),xs,Ss=class extends N{constructor(e){super({name:bs,message:`Too many values for a single embedding call. The ${e.provider} model "${e.modelId}" can only embed up to ${e.maxEmbeddingsPerCall} values per call, but ${e.values.length} values were provided.`}),this[xs]=true,this.provider=e.provider,this.modelId=e.modelId,this.maxEmbeddingsPerCall=e.maxEmbeddingsPerCall,this.values=e.values;}static isInstance(e){return N.hasMarker(e,ws)}};xs=Hu;var Ts="AI_TypeValidationError",Is=`vercel.ai.error.${Ts}`,Wu=Symbol.for(Is),ks,Ku=class Gn extends N{constructor({value:t,cause:r}){super({name:Ts,message:`Type validation failed: Value: ${JSON.stringify(t)}.
Error message: ${Pt(r)}`,cause:r}),this[ks]=true,this.value=t;}static isInstance(t){return N.hasMarker(t,Is)}static wrap({value:t,cause:r}){return Gn.isInstance(r)&&r.value===t?r:new Gn({value:t,cause:r})}};ks=Wu;var Je=Ku,Es="AI_UnsupportedFunctionalityError",As=`vercel.ai.error.${Es}`,Yu=Symbol.for(As),Cs,ee=class extends N{constructor({functionality:e,message:t=`'${e}' functionality not supported.`}){super({name:Es,message:t}),this[Cs]=true,this.functionality=e;}static isInstance(e){return N.hasMarker(e,As)}};Cs=Yu;function mn(e){return e===null||typeof e=="string"||typeof e=="number"||typeof e=="boolean"?true:Array.isArray(e)?e.every(mn):typeof e=="object"?Object.entries(e).every(([t,r])=>typeof t=="string"&&mn(r)):false}function Hn(e){return Array.isArray(e)&&e.every(mn)}function gn(e){return e!=null&&typeof e=="object"&&Object.entries(e).every(([t,r])=>typeof t=="string"&&mn(r))}var Rs=(e,t=21)=>(r=t)=>{let n="",a=r|0;for(;a--;)n+=e[Math.random()*e.length|0];return n};var yn=vl(Ms());function Ie(...e){return e.reduce((t,r)=>p(p({},t),r!=null?r:{}),{})}function Ds(e){return new ReadableStream({pull(r){return T(this,null,function*(){try{let{value:n,done:a}=yield e.next();a?r.close():r.enqueue(n);}catch(n){r.error(n);}})},cancel(){}})}function $s(e){return T(this,null,function*(){return e==null?Promise.resolve():new Promise(t=>setTimeout(t,e))})}function ec(){let e="",t,r=[],n,a;function s(u,c){if(u===""){o(c);return}if(u.startsWith(":"))return;let d=u.indexOf(":");if(d===-1){l(u,"");return}let m=u.slice(0,d),h=d+1,_=h<u.length&&u[h]===" "?u.slice(h+1):u.slice(h);l(m,_);}function o(u){r.length>0&&(u.enqueue({event:t,data:r.join(`
`),id:n,retry:a}),r=[],t=void 0,a=void 0);}function l(u,c){switch(u){case "event":t=c;break;case "data":r.push(c);break;case "id":n=c;break;case "retry":let d=parseInt(c,10);isNaN(d)||(a=d);break}}return new TransformStream({transform(u,c){let{lines:d,incompleteLine:m}=tc(e,u);e=m;for(let h=0;h<d.length;h++)s(d[h],c);},flush(u){s(e,u),o(u);}})}function tc(e,t){let r=[],n=e;for(let a=0;a<t.length;){let s=t[a++];s===`
`?(r.push(n),n=""):s==="\r"?(r.push(n),n="",t[a+1]===`
`&&a++):n+=s;}return {lines:r,incompleteLine:n}}function Lr(e){let t={};return e.headers.forEach((r,n)=>{t[n]=r;}),t}var et=({prefix:e,size:t=16,alphabet:r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:n="-"}={})=>{let a=Rs(r,t);if(e==null)return a;if(r.includes(n))throw new fn({argument:"separator",message:`The separator "${n}" must not be part of the alphabet "${r}".`});return s=>`${e}${n}${a(s)}`},Ge=et();function qs(e){return e==null?"unknown error":typeof e=="string"?e:e instanceof Error?e.message:JSON.stringify(e)}function rc(e){return Object.fromEntries(Object.entries(e).filter(([t,r])=>r!=null))}function Ur(e){return e instanceof Error&&(e.name==="AbortError"||e.name==="TimeoutError")}function Us({apiKey:e,environmentVariableName:t,apiKeyParameterName:r="apiKey",description:n}){if(typeof e=="string")return e;if(e!=null)throw new qr({message:`${n} API key must be a string.`});if(typeof process=="undefined")throw new qr({message:`${n} API key is missing. Pass it using the '${r}' parameter. Environment variables is not supported in this environment.`});if(e=process.env[t],e==null)throw new qr({message:`${n} API key is missing. Pass it using the '${r}' parameter or the ${t} environment variable.`});if(typeof e!="string")throw new qr({message:`${n} API key must be a string. The value of the ${t} environment variable is not a string.`});return e}var Fr=Symbol.for("vercel.ai.validator");function nc(e){return {[Fr]:true,validate:e}}function ac(e){return typeof e=="object"&&e!==null&&Fr in e&&e[Fr]===true&&"validate"in e}function sc(e){return ac(e)?e:oc(e)}function oc(e){return nc(t=>{let r=e.safeParse(t);return r.success?{success:true,value:r.data}:{success:false,error:r.error}})}function ic({value:e,schema:t}){let r=Ve({value:e,schema:t});if(!r.success)throw Je.wrap({value:e,cause:r.error});return r.value}function Ve({value:e,schema:t}){let r=sc(t);try{if(r.validate==null)return {success:!0,value:e};let n=r.validate(e);return n.success?n:{success:!1,error:Je.wrap({value:e,cause:n.error})}}catch(n){return {success:false,error:Je.wrap({value:e,cause:n})}}}function lc({text:e,schema:t}){try{let r=yn.default.parse(e);return t==null?r:ic({value:r,schema:t})}catch(r){throw tr.isInstance(r)||Je.isInstance(r)?r:new tr({text:e,cause:r})}}function tt({text:e,schema:t}){try{let r=yn.default.parse(e);if(t==null)return {success:!0,value:r,rawValue:r};let n=Ve({value:r,schema:t});return n.success?f(p({},n),{rawValue:r}):n}catch(r){return {success:false,error:tr.isInstance(r)?r:new tr({text:e,cause:r})}}}function Kn(e){try{return yn.default.parse(e),!0}catch(t){return  false}}function hr({provider:e,providerOptions:t,schema:r}){if((t==null?void 0:t[e])==null)return;let n=Ve({value:t[e],schema:r});if(!n.success)throw new fn({argument:"providerOptions",message:`invalid ${e} provider options`,cause:n.error});return n.value}var uc=()=>globalThis.fetch,je=l=>T(null,[l],function*({url:e,headers:t,body:r,failedResponseHandler:n,successfulResponseHandler:a,abortSignal:s,fetch:o}){return Ls({url:e,headers:p({"Content-Type":"application/json"},t),body:{content:JSON.stringify(r),values:r},failedResponseHandler:n,successfulResponseHandler:a,abortSignal:s,fetch:o})}),Fs=l=>T(null,[l],function*({url:e,headers:t,formData:r,failedResponseHandler:n,successfulResponseHandler:a,abortSignal:s,fetch:o}){return Ls({url:e,headers:t,body:{content:r,values:Object.fromEntries(r.entries())},failedResponseHandler:n,successfulResponseHandler:a,abortSignal:s,fetch:o})}),Ls=l=>T(null,[l],function*({url:e,headers:t={},body:r,successfulResponseHandler:n,failedResponseHandler:a,abortSignal:s,fetch:o=uc()}){try{let u=yield o(e,{method:"POST",headers:rc(t),body:r.content,signal:s}),c=Lr(u);if(!u.ok){let d;try{d=yield a({response:u,url:e,requestBodyValues:r.values});}catch(m){throw Ur(m)||Ne.isInstance(m)?m:new Ne({message:"Failed to process error response",cause:m,statusCode:u.status,url:e,responseHeaders:c,requestBodyValues:r.values})}throw d.value}try{return yield n({response:u,url:e,requestBodyValues:r.values})}catch(d){throw d instanceof Error&&(Ur(d)||Ne.isInstance(d))?d:new Ne({message:"Failed to process successful response",cause:d,statusCode:u.status,url:e,responseHeaders:c,requestBodyValues:r.values})}}catch(u){if(Ur(u))throw u;if(u instanceof TypeError&&u.message==="fetch failed"){let c=u.cause;if(c!=null)throw new Ne({message:`Cannot connect to API: ${c.message}`,cause:c,url:e,requestBodyValues:r.values,isRetryable:true})}throw u}});var Zs=({errorSchema:e,errorToMessage:t,isRetryable:r})=>o=>T(null,[o],function*({response:n,url:a,requestBodyValues:s}){let l=yield n.text(),u=Lr(n);if(l.trim()==="")return {responseHeaders:u,value:new Ne({message:n.statusText,url:a,requestBodyValues:s,statusCode:n.status,responseHeaders:u,responseBody:l,isRetryable:r==null?void 0:r(n)})};try{let c=lc({text:l,schema:e});return {responseHeaders:u,value:new Ne({message:t(c),url:a,requestBodyValues:s,statusCode:n.status,responseHeaders:u,responseBody:l,data:c,isRetryable:r==null?void 0:r(n,c)})}}catch(c){return {responseHeaders:u,value:new Ne({message:n.statusText,url:a,requestBodyValues:s,statusCode:n.status,responseHeaders:u,responseBody:l,isRetryable:r==null?void 0:r(n)})}}}),gr=e=>r=>T(null,[r],function*({response:t}){let n=Lr(t);if(t.body==null)throw new as({});return {responseHeaders:n,value:t.body.pipeThrough(new TextDecoderStream).pipeThrough(ec()).pipeThrough(new TransformStream({transform({data:a},s){a!=="[DONE]"&&s.enqueue(tt({text:a,schema:e}));}}))}});var He=e=>a=>T(null,[a],function*({response:t,url:r,requestBodyValues:n}){let s=yield t.text(),o=tt({text:s,schema:e}),l=Lr(t);if(!o.success)throw new Ne({message:"Invalid JSON response",cause:o.error,statusCode:t.status,responseHeaders:l,responseBody:s,url:r,requestBodyValues:n});return {responseHeaders:l,value:o.value,rawValue:o.rawValue}}),Js=()=>n=>T(null,[n],function*({response:e,url:t,requestBodyValues:r}){let a=Lr(e);if(!e.body)throw new Ne({message:"Response body is empty",url:t,requestBodyValues:r,statusCode:e.status,responseHeaders:a,responseBody:void 0});try{let s=yield e.arrayBuffer();return {responseHeaders:a,value:new Uint8Array(s)}}catch(s){throw new Ne({message:"Failed to read response as array buffer",url:t,requestBodyValues:r,statusCode:e.status,responseHeaders:a,responseBody:void 0,cause:s})}});var{btoa:cc,atob:pc}=globalThis;function Ot(e){let t=e.replace(/-/g,"+").replace(/_/g,"/"),r=pc(t);return Uint8Array.from(r,n=>n.codePointAt(0))}function wt(e){let t="";for(let r=0;r<e.length;r++)t+=String.fromCodePoint(e[r]);return cc(t)}function Vs(e){return e==null?void 0:e.replace(/\/$/,"")}var Bs=Symbol("Let zodToJsonSchema decide on which parser to use");var zs={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:true,rejectedAdditionalProperties:false,definitionPath:"definitions",target:"jsonSchema7",strictUnions:false,definitions:{},errorMessages:false,markdownDescription:false,patternStrategy:"escape",applyRegexFlags:false,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},Gs=e=>typeof e=="string"?f(p({},zs),{name:e}):p(p({},zs),e);var Hs=e=>{let t=Gs(e),r=t.name!==void 0?[...t.basePath,t.definitionPath,t.name]:t.basePath;return f(p({},t),{currentPath:r,propertyPath:void 0,seen:new Map(Object.entries(t.definitions).map(([n,a])=>[a._def,{def:a._def,path:[...t.basePath,t.definitionPath,n],jsonSchema:void 0}]))})};function Yn(e,t,r,n){n!=null&&n.errorMessages&&r&&(e.errorMessage=f(p({},e.errorMessage),{[t]:r}));}function H(e,t,r,n,a){e[t]=r,Yn(e,t,n,a);}function Ws(){return {}}function Ks(e,t){var n,a,s;let r={type:"array"};return (n=e.type)!=null&&n._def&&((s=(a=e.type)==null?void 0:a._def)==null?void 0:s.typeName)!==x.ZodAny&&(r.items=$(e.type._def,f(p({},t),{currentPath:[...t.currentPath,"items"]}))),e.minLength&&H(r,"minItems",e.minLength.value,e.minLength.message,t),e.maxLength&&H(r,"maxItems",e.maxLength.value,e.maxLength.message,t),e.exactLength&&(H(r,"minItems",e.exactLength.value,e.exactLength.message,t),H(r,"maxItems",e.exactLength.value,e.exactLength.message,t)),r}function Ys(e,t){let r={type:"integer",format:"int64"};if(!e.checks)return r;for(let n of e.checks)switch(n.kind){case "min":t.target==="jsonSchema7"?n.inclusive?H(r,"minimum",n.value,n.message,t):H(r,"exclusiveMinimum",n.value,n.message,t):(n.inclusive||(r.exclusiveMinimum=true),H(r,"minimum",n.value,n.message,t));break;case "max":t.target==="jsonSchema7"?n.inclusive?H(r,"maximum",n.value,n.message,t):H(r,"exclusiveMaximum",n.value,n.message,t):(n.inclusive||(r.exclusiveMaximum=true),H(r,"maximum",n.value,n.message,t));break;case "multipleOf":H(r,"multipleOf",n.value,n.message,t);break}return r}function Xs(){return {type:"boolean"}}function vn(e,t){return $(e.type._def,t)}var Qs=(e,t)=>$(e.innerType._def,t);function Xn(e,t,r){let n=r!=null?r:t.dateStrategy;if(Array.isArray(n))return {anyOf:n.map((a,s)=>Xn(e,t,a))};switch(n){case "string":case "format:date-time":return {type:"string",format:"date-time"};case "format:date":return {type:"string",format:"date"};case "integer":return dc(e,t)}}var dc=(e,t)=>{let r={type:"integer",format:"unix-time"};if(t.target==="openApi3")return r;for(let n of e.checks)switch(n.kind){case "min":H(r,"minimum",n.value,n.message,t);break;case "max":H(r,"maximum",n.value,n.message,t);break}return r};function eo(e,t){return f(p({},$(e.innerType._def,t)),{default:e.defaultValue()})}function to(e,t){return t.effectStrategy==="input"?$(e.schema._def,t):{}}function ro(e){return {type:"string",enum:Array.from(e.values)}}var mc=e=>"type"in e&&e.type==="string"?false:"allOf"in e;function no(e,t){let r=[$(e.left._def,f(p({},t),{currentPath:[...t.currentPath,"allOf","0"]})),$(e.right._def,f(p({},t),{currentPath:[...t.currentPath,"allOf","1"]}))].filter(s=>!!s),n=t.target==="jsonSchema2019-09"?{unevaluatedProperties:false}:void 0,a=[];return r.forEach(s=>{if(mc(s))a.push(...s.allOf),s.unevaluatedProperties===void 0&&(n=void 0);else {let l=s;if("additionalProperties"in s&&s.additionalProperties===false){let o=s,{additionalProperties:u}=o;l=Ce(o,["additionalProperties"]);}else n=void 0;a.push(l);}}),a.length?p({allOf:a},n):void 0}function ao(e,t){let r=typeof e.value;return r!=="bigint"&&r!=="number"&&r!=="boolean"&&r!=="string"?{type:Array.isArray(e.value)?"array":"object"}:t.target==="openApi3"?{type:r==="bigint"?"integer":r,enum:[e.value]}:{type:r==="bigint"?"integer":r,const:e.value}}var Qn,rt={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(Qn===void 0&&(Qn=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Qn),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function _n(e,t){let r={type:"string"};if(e.checks)for(let n of e.checks)switch(n.kind){case "min":H(r,"minLength",typeof r.minLength=="number"?Math.max(r.minLength,n.value):n.value,n.message,t);break;case "max":H(r,"maxLength",typeof r.maxLength=="number"?Math.min(r.maxLength,n.value):n.value,n.message,t);break;case "email":switch(t.emailStrategy){case "format:email":nt(r,"email",n.message,t);break;case "format:idn-email":nt(r,"idn-email",n.message,t);break;case "pattern:zod":Me(r,rt.email,n.message,t);break}break;case "url":nt(r,"uri",n.message,t);break;case "uuid":nt(r,"uuid",n.message,t);break;case "regex":Me(r,n.regex,n.message,t);break;case "cuid":Me(r,rt.cuid,n.message,t);break;case "cuid2":Me(r,rt.cuid2,n.message,t);break;case "startsWith":Me(r,RegExp(`^${ea(n.value,t)}`),n.message,t);break;case "endsWith":Me(r,RegExp(`${ea(n.value,t)}$`),n.message,t);break;case "datetime":nt(r,"date-time",n.message,t);break;case "date":nt(r,"date",n.message,t);break;case "time":nt(r,"time",n.message,t);break;case "duration":nt(r,"duration",n.message,t);break;case "length":H(r,"minLength",typeof r.minLength=="number"?Math.max(r.minLength,n.value):n.value,n.message,t),H(r,"maxLength",typeof r.maxLength=="number"?Math.min(r.maxLength,n.value):n.value,n.message,t);break;case "includes":{Me(r,RegExp(ea(n.value,t)),n.message,t);break}case "ip":{n.version!=="v6"&&nt(r,"ipv4",n.message,t),n.version!=="v4"&&nt(r,"ipv6",n.message,t);break}case "base64url":Me(r,rt.base64url,n.message,t);break;case "jwt":Me(r,rt.jwt,n.message,t);break;case "cidr":{n.version!=="v6"&&Me(r,rt.ipv4Cidr,n.message,t),n.version!=="v4"&&Me(r,rt.ipv6Cidr,n.message,t);break}case "emoji":Me(r,rt.emoji(),n.message,t);break;case "ulid":{Me(r,rt.ulid,n.message,t);break}case "base64":{switch(t.base64Strategy){case "format:binary":{nt(r,"binary",n.message,t);break}case "contentEncoding:base64":{H(r,"contentEncoding","base64",n.message,t);break}case "pattern:zod":{Me(r,rt.base64,n.message,t);break}}break}case "nanoid":Me(r,rt.nanoid,n.message,t);}return r}function ea(e,t){return t.patternStrategy==="escape"?hc(e):e}var fc=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function hc(e){let t="";for(let r=0;r<e.length;r++)fc.has(e[r])||(t+="\\"),t+=e[r];return t}function nt(e,t,r,n){var a;e.format||(a=e.anyOf)!=null&&a.some(s=>s.format)?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push(p({format:e.format},e.errorMessage&&n.errorMessages&&{errorMessage:{format:e.errorMessage.format}})),delete e.format,e.errorMessage&&(delete e.errorMessage.format,Object.keys(e.errorMessage).length===0&&delete e.errorMessage)),e.anyOf.push(p({format:t},r&&n.errorMessages&&{errorMessage:{format:r}}))):H(e,"format",t,r,n);}function Me(e,t,r,n){var a;e.pattern||(a=e.allOf)!=null&&a.some(s=>s.pattern)?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push(p({pattern:e.pattern},e.errorMessage&&n.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}})),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,Object.keys(e.errorMessage).length===0&&delete e.errorMessage)),e.allOf.push(p({pattern:so(t,n)},r&&n.errorMessages&&{errorMessage:{pattern:r}}))):H(e,"pattern",so(t,n),r,n);}function so(e,t){var u;if(!t.applyRegexFlags||!e.flags)return e.source;let r={i:e.flags.includes("i"),m:e.flags.includes("m"),s:e.flags.includes("s")},n=r.i?e.source.toLowerCase():e.source,a="",s=false,o=false,l=false;for(let c=0;c<n.length;c++){if(s){a+=n[c],s=false;continue}if(r.i){if(o){if(n[c].match(/[a-z]/)){l?(a+=n[c],a+=`${n[c-2]}-${n[c]}`.toUpperCase(),l=false):n[c+1]==="-"&&((u=n[c+2])!=null&&u.match(/[a-z]/))?(a+=n[c],l=true):a+=`${n[c]}${n[c].toUpperCase()}`;continue}}else if(n[c].match(/[a-z]/)){a+=`[${n[c]}${n[c].toUpperCase()}]`;continue}}if(r.m){if(n[c]==="^"){a+=`(^|(?<=[\r
]))`;continue}else if(n[c]==="$"){a+=`($|(?=[\r
]))`;continue}}if(r.s&&n[c]==="."){a+=o?`${n[c]}\r
`:`[${n[c]}\r
]`;continue}a+=n[c],n[c]==="\\"?s=true:o&&n[c]==="]"?o=false:!o&&n[c]==="["&&(o=true);}try{new RegExp(a);}catch(c){return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),e.source}return a}function bn(e,t){var n,a,s,o,u,c,d;if(t.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),t.target==="openApi3"&&((n=e.keyType)==null?void 0:n._def.typeName)===x.ZodEnum)return {type:"object",required:e.keyType._def.values,properties:e.keyType._def.values.reduce((h,_)=>{var S;return f(p({},h),{[_]:(S=$(e.valueType._def,f(p({},t),{currentPath:[...t.currentPath,"properties",_]})))!=null?S:{}})},{}),additionalProperties:t.rejectedAdditionalProperties};let r={type:"object",additionalProperties:(a=$(e.valueType._def,f(p({},t),{currentPath:[...t.currentPath,"additionalProperties"]})))!=null?a:t.allowedAdditionalProperties};if(t.target==="openApi3")return r;if(((s=e.keyType)==null?void 0:s._def.typeName)===x.ZodString&&((o=e.keyType._def.checks)!=null&&o.length)){let l=_n(e.keyType._def,t),{type:h}=l,_=Ce(l,["type"]);return f(p({},r),{propertyNames:_})}else {if(((u=e.keyType)==null?void 0:u._def.typeName)===x.ZodEnum)return f(p({},r),{propertyNames:{enum:e.keyType._def.values}});if(((c=e.keyType)==null?void 0:c._def.typeName)===x.ZodBranded&&e.keyType._def.type._def.typeName===x.ZodString&&((d=e.keyType._def.type._def.checks)!=null&&d.length)){let m=vn(e.keyType._def,t),{type:h}=m,_=Ce(m,["type"]);return f(p({},r),{propertyNames:_})}}return r}function oo(e,t){if(t.mapStrategy==="record")return bn(e,t);let r=$(e.keyType._def,f(p({},t),{currentPath:[...t.currentPath,"items","items","0"]}))||{},n=$(e.valueType._def,f(p({},t),{currentPath:[...t.currentPath,"items","items","1"]}))||{};return {type:"array",maxItems:125,items:{type:"array",items:[r,n],minItems:2,maxItems:2}}}function io(e){let t=e.values,n=Object.keys(e.values).filter(s=>typeof t[t[s]]!="number").map(s=>t[s]),a=Array.from(new Set(n.map(s=>typeof s)));return {type:a.length===1?a[0]==="string"?"string":"number":["string","number"],enum:n}}function lo(){return {not:{}}}function uo(e){return e.target==="openApi3"?{enum:["null"],nullable:true}:{type:"null"}}var Zr={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function po(e,t){if(t.target==="openApi3")return co(e,t);let r=e.options instanceof Map?Array.from(e.options.values()):e.options;if(r.every(n=>n._def.typeName in Zr&&(!n._def.checks||!n._def.checks.length))){let n=r.reduce((a,s)=>{let o=Zr[s._def.typeName];return o&&!a.includes(o)?[...a,o]:a},[]);return {type:n.length>1?n:n[0]}}else if(r.every(n=>n._def.typeName==="ZodLiteral"&&!n.description)){let n=r.reduce((a,s)=>{let o=typeof s._def.value;switch(o){case "string":case "number":case "boolean":return [...a,o];case "bigint":return [...a,"integer"];case "object":if(s._def.value===null)return [...a,"null"];case "symbol":case "undefined":case "function":default:return a}},[]);if(n.length===r.length){let a=n.filter((s,o,l)=>l.indexOf(s)===o);return {type:a.length>1?a:a[0],enum:r.reduce((s,o)=>s.includes(o._def.value)?s:[...s,o._def.value],[])}}}else if(r.every(n=>n._def.typeName==="ZodEnum"))return {type:"string",enum:r.reduce((n,a)=>[...n,...a._def.values.filter(s=>!n.includes(s))],[])};return co(e,t)}var co=(e,t)=>{let r=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((n,a)=>$(n._def,f(p({},t),{currentPath:[...t.currentPath,"anyOf",`${a}`]}))).filter(n=>!!n&&(!t.strictUnions||typeof n=="object"&&Object.keys(n).length>0));return r.length?{anyOf:r}:void 0};function mo(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return t.target==="openApi3"?{type:Zr[e.innerType._def.typeName],nullable:true}:{type:[Zr[e.innerType._def.typeName],"null"]};if(t.target==="openApi3"){let n=$(e.innerType._def,f(p({},t),{currentPath:[...t.currentPath]}));return n&&"$ref"in n?{allOf:[n],nullable:true}:n&&f(p({},n),{nullable:true})}let r=$(e.innerType._def,f(p({},t),{currentPath:[...t.currentPath,"anyOf","0"]}));return r&&{anyOf:[r,{type:"null"}]}}function fo(e,t){let r={type:"number"};if(!e.checks)return r;for(let n of e.checks)switch(n.kind){case "int":r.type="integer",Yn(r,"type",n.message,t);break;case "min":t.target==="jsonSchema7"?n.inclusive?H(r,"minimum",n.value,n.message,t):H(r,"exclusiveMinimum",n.value,n.message,t):(n.inclusive||(r.exclusiveMinimum=true),H(r,"minimum",n.value,n.message,t));break;case "max":t.target==="jsonSchema7"?n.inclusive?H(r,"maximum",n.value,n.message,t):H(r,"exclusiveMaximum",n.value,n.message,t):(n.inclusive||(r.exclusiveMaximum=true),H(r,"maximum",n.value,n.message,t));break;case "multipleOf":H(r,"multipleOf",n.value,n.message,t);break}return r}function ho(e,t){let r=t.target==="openAi",n={type:"object",properties:{}},a=[],s=e.shape();for(let l in s){let u=s[l];if(u===void 0||u._def===void 0)continue;let c=yc(u);c&&r&&(u instanceof qe&&(u=u._def.innerType),u.isNullable()||(u=u.nullable()),c=false);let d=$(u._def,f(p({},t),{currentPath:[...t.currentPath,"properties",l],propertyPath:[...t.currentPath,"properties",l]}));d!==void 0&&(n.properties[l]=d,c||a.push(l));}a.length&&(n.required=a);let o=gc(e,t);return o!==void 0&&(n.additionalProperties=o),n}function gc(e,t){if(e.catchall._def.typeName!=="ZodNever")return $(e.catchall._def,f(p({},t),{currentPath:[...t.currentPath,"additionalProperties"]}));switch(e.unknownKeys){case "passthrough":return t.allowedAdditionalProperties;case "strict":return t.rejectedAdditionalProperties;case "strip":return t.removeAdditionalStrategy==="strict"?t.allowedAdditionalProperties:t.rejectedAdditionalProperties}}function yc(e){try{return e.isOptional()}catch(t){return  true}}var go=(e,t)=>{var n;if(t.currentPath.toString()===((n=t.propertyPath)==null?void 0:n.toString()))return $(e.innerType._def,t);let r=$(e.innerType._def,f(p({},t),{currentPath:[...t.currentPath,"anyOf","1"]}));return r?{anyOf:[{not:{}},r]}:{}};var yo=(e,t)=>{if(t.pipeStrategy==="input")return $(e.in._def,t);if(t.pipeStrategy==="output")return $(e.out._def,t);let r=$(e.in._def,f(p({},t),{currentPath:[...t.currentPath,"allOf","0"]})),n=$(e.out._def,f(p({},t),{currentPath:[...t.currentPath,"allOf",r?"1":"0"]}));return {allOf:[r,n].filter(a=>a!==void 0)}};function vo(e,t){return $(e.type._def,t)}function _o(e,t){let n={type:"array",uniqueItems:true,items:$(e.valueType._def,f(p({},t),{currentPath:[...t.currentPath,"items"]}))};return e.minSize&&H(n,"minItems",e.minSize.value,e.minSize.message,t),e.maxSize&&H(n,"maxItems",e.maxSize.value,e.maxSize.message,t),n}function bo(e,t){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((r,n)=>$(r._def,f(p({},t),{currentPath:[...t.currentPath,"items",`${n}`]}))).reduce((r,n)=>n===void 0?r:[...r,n],[]),additionalItems:$(e.rest._def,f(p({},t),{currentPath:[...t.currentPath,"additionalItems"]}))}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((r,n)=>$(r._def,f(p({},t),{currentPath:[...t.currentPath,"items",`${n}`]}))).reduce((r,n)=>n===void 0?r:[...r,n],[])}}function wo(){return {not:{}}}function xo(){return {}}var So=(e,t)=>$(e.innerType._def,t);var To=(e,t,r)=>{switch(t){case x.ZodString:return _n(e,r);case x.ZodNumber:return fo(e,r);case x.ZodObject:return ho(e,r);case x.ZodBigInt:return Ys(e,r);case x.ZodBoolean:return Xs();case x.ZodDate:return Xn(e,r);case x.ZodUndefined:return wo();case x.ZodNull:return uo(r);case x.ZodArray:return Ks(e,r);case x.ZodUnion:case x.ZodDiscriminatedUnion:return po(e,r);case x.ZodIntersection:return no(e,r);case x.ZodTuple:return bo(e,r);case x.ZodRecord:return bn(e,r);case x.ZodLiteral:return ao(e,r);case x.ZodEnum:return ro(e);case x.ZodNativeEnum:return io(e);case x.ZodNullable:return mo(e,r);case x.ZodOptional:return go(e,r);case x.ZodMap:return oo(e,r);case x.ZodSet:return _o(e,r);case x.ZodLazy:return ()=>e.getter()._def;case x.ZodPromise:return vo(e,r);case x.ZodNaN:case x.ZodNever:return lo();case x.ZodEffects:return to(e,r);case x.ZodAny:return Ws();case x.ZodUnknown:return xo();case x.ZodDefault:return eo(e,r);case x.ZodBranded:return vn(e,r);case x.ZodReadonly:return So(e,r);case x.ZodCatch:return Qs(e,r);case x.ZodPipeline:return yo(e,r);case x.ZodFunction:case x.ZodVoid:case x.ZodSymbol:return;default:return (n=>{})()}};function $(e,t,r=false){var l;let n=t.seen.get(e);if(t.override){let u=(l=t.override)==null?void 0:l.call(t,e,t,n,r);if(u!==Bs)return u}if(n&&!r){let u=vc(n,t);if(u!==void 0)return u}let a={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,a);let s=To(e,e.typeName,t),o=typeof s=="function"?$(s(),t):s;if(o&&bc(e,t,o),t.postProcess){let u=t.postProcess(o,e,t);return a.jsonSchema=o,u}return a.jsonSchema=o,o}var vc=(e,t)=>{switch(t.$refStrategy){case "root":return {$ref:e.path.join("/")};case "relative":return {$ref:_c(t.currentPath,e.path)};case "none":case "seen":return e.path.length<t.currentPath.length&&e.path.every((r,n)=>t.currentPath[n]===r)?(console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),{}):t.$refStrategy==="seen"?{}:void 0}},_c=(e,t)=>{let r=0;for(;r<e.length&&r<t.length&&e[r]===t[r];r++);return [(e.length-r).toString(),...t.slice(r)].join("/")},bc=(e,t,r)=>(e.description&&(r.description=e.description,t.markdownDescription&&(r.markdownDescription=e.description)),r);var Io=(e,t)=>{var u;let r=Hs(t),n=typeof t=="object"&&t.definitions?Object.entries(t.definitions).reduce((c,[d,m])=>{var h;return f(p({},c),{[d]:(h=$(m._def,f(p({},r),{currentPath:[...r.basePath,r.definitionPath,d]}),true))!=null?h:{}})},{}):void 0,a=typeof t=="string"?t:(t==null?void 0:t.nameStrategy)==="title"||t==null?void 0:t.name,s=(u=$(e._def,a===void 0?r:f(p({},r),{currentPath:[...r.basePath,r.definitionPath,a]}),false))!=null?u:{},o=typeof t=="object"&&t.name!==void 0&&t.nameStrategy==="title"?t.name:void 0;o!==void 0&&(s.title=o);let l=a===void 0?n?f(p({},s),{[r.definitionPath]:n}):s:{$ref:[...r.$refStrategy==="relative"?[]:r.basePath,r.definitionPath,a].join("/"),[r.definitionPath]:f(p({},n),{[a]:s})};return r.target==="jsonSchema7"?l.$schema="http://json-schema.org/draft-07/schema#":(r.target==="jsonSchema2019-09"||r.target==="openAi")&&(l.$schema="https://json-schema.org/draft/2019-09/schema#"),r.target==="openAi"&&("anyOf"in l||"oneOf"in l||"allOf"in l||"type"in l&&Array.isArray(l.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),l};var ko=Io;var Jr={code:"0",name:"text",parse:e=>{if(typeof e!="string")throw new Error('"text" parts expect a string value.');return {type:"text",value:e}}},Vr={code:"3",name:"error",parse:e=>{if(typeof e!="string")throw new Error('"error" parts expect a string value.');return {type:"error",value:e}}},zr={code:"4",name:"assistant_message",parse:e=>{if(e==null||typeof e!="object"||!("id"in e)||!("role"in e)||!("content"in e)||typeof e.id!="string"||typeof e.role!="string"||e.role!=="assistant"||!Array.isArray(e.content)||!e.content.every(t=>t!=null&&typeof t=="object"&&"type"in t&&t.type==="text"&&"text"in t&&t.text!=null&&typeof t.text=="object"&&"value"in t.text&&typeof t.text.value=="string"))throw new Error('"assistant_message" parts expect an object with an "id", "role", and "content" property.');return {type:"assistant_message",value:e}}},Br={code:"5",name:"assistant_control_data",parse:e=>{if(e==null||typeof e!="object"||!("threadId"in e)||!("messageId"in e)||typeof e.threadId!="string"||typeof e.messageId!="string")throw new Error('"assistant_control_data" parts expect an object with a "threadId" and "messageId" property.');return {type:"assistant_control_data",value:{threadId:e.threadId,messageId:e.messageId}}}},Gr={code:"6",name:"data_message",parse:e=>{if(e==null||typeof e!="object"||!("role"in e)||!("data"in e)||typeof e.role!="string"||e.role!=="data")throw new Error('"data_message" parts expect an object with a "role" and "data" property.');return {type:"data_message",value:e}}},wc=[Jr,Vr,zr,Br,Gr];({[Jr.code]:Jr,[Vr.code]:Vr,[zr.code]:zr,[Br.code]:Br,[Gr.code]:Gr});({[Jr.name]:Jr.code,[Vr.name]:Vr.code,[zr.name]:zr.code,[Br.name]:Br.code,[Gr.name]:Gr.code});wc.map(e=>e.code);function xc(e){let t=["ROOT"],r=-1,n=null;function a(u,c,d){switch(u){case '"':{r=c,t.pop(),t.push(d),t.push("INSIDE_STRING");break}case "f":case "t":case "n":{r=c,n=c,t.pop(),t.push(d),t.push("INSIDE_LITERAL");break}case "-":{t.pop(),t.push(d),t.push("INSIDE_NUMBER");break}case "0":case "1":case "2":case "3":case "4":case "5":case "6":case "7":case "8":case "9":{r=c,t.pop(),t.push(d),t.push("INSIDE_NUMBER");break}case "{":{r=c,t.pop(),t.push(d),t.push("INSIDE_OBJECT_START");break}case "[":{r=c,t.pop(),t.push(d),t.push("INSIDE_ARRAY_START");break}}}function s(u,c){switch(u){case ",":{t.pop(),t.push("INSIDE_OBJECT_AFTER_COMMA");break}case "}":{r=c,t.pop();break}}}function o(u,c){switch(u){case ",":{t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break}case "]":{r=c,t.pop();break}}}for(let u=0;u<e.length;u++){let c=e[u];switch(t[t.length-1]){case "ROOT":a(c,u,"FINISH");break;case "INSIDE_OBJECT_START":{switch(c){case '"':{t.pop(),t.push("INSIDE_OBJECT_KEY");break}case "}":{r=u,t.pop();break}}break}case "INSIDE_OBJECT_AFTER_COMMA":{switch(c){case '"':{t.pop(),t.push("INSIDE_OBJECT_KEY");break}}break}case "INSIDE_OBJECT_KEY":{switch(c){case '"':{t.pop(),t.push("INSIDE_OBJECT_AFTER_KEY");break}}break}case "INSIDE_OBJECT_AFTER_KEY":{switch(c){case ":":{t.pop(),t.push("INSIDE_OBJECT_BEFORE_VALUE");break}}break}case "INSIDE_OBJECT_BEFORE_VALUE":{a(c,u,"INSIDE_OBJECT_AFTER_VALUE");break}case "INSIDE_OBJECT_AFTER_VALUE":{s(c,u);break}case "INSIDE_STRING":{switch(c){case '"':{t.pop(),r=u;break}case "\\":{t.push("INSIDE_STRING_ESCAPE");break}default:r=u;}break}case "INSIDE_ARRAY_START":{switch(c){case "]":{r=u,t.pop();break}default:{r=u,a(c,u,"INSIDE_ARRAY_AFTER_VALUE");break}}break}case "INSIDE_ARRAY_AFTER_VALUE":{switch(c){case ",":{t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break}case "]":{r=u,t.pop();break}default:{r=u;break}}break}case "INSIDE_ARRAY_AFTER_COMMA":{a(c,u,"INSIDE_ARRAY_AFTER_VALUE");break}case "INSIDE_STRING_ESCAPE":{t.pop(),r=u;break}case "INSIDE_NUMBER":{switch(c){case "0":case "1":case "2":case "3":case "4":case "5":case "6":case "7":case "8":case "9":{r=u;break}case "e":case "E":case "-":case ".":break;case ",":{t.pop(),t[t.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&o(c,u),t[t.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&s(c,u);break}case "}":{t.pop(),t[t.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&s(c,u);break}case "]":{t.pop(),t[t.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&o(c,u);break}default:{t.pop();break}}break}case "INSIDE_LITERAL":{let m=e.substring(n,u+1);!"false".startsWith(m)&&!"true".startsWith(m)&&!"null".startsWith(m)?(t.pop(),t[t.length-1]==="INSIDE_OBJECT_AFTER_VALUE"?s(c,u):t[t.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&o(c,u)):r=u;break}}}let l=e.slice(0,r+1);for(let u=t.length-1;u>=0;u--)switch(t[u]){case "INSIDE_STRING":{l+='"';break}case "INSIDE_OBJECT_KEY":case "INSIDE_OBJECT_AFTER_KEY":case "INSIDE_OBJECT_AFTER_COMMA":case "INSIDE_OBJECT_START":case "INSIDE_OBJECT_BEFORE_VALUE":case "INSIDE_OBJECT_AFTER_VALUE":{l+="}";break}case "INSIDE_ARRAY_START":case "INSIDE_ARRAY_AFTER_COMMA":case "INSIDE_ARRAY_AFTER_VALUE":{l+="]";break}case "INSIDE_LITERAL":{let d=e.substring(n,e.length);"true".startsWith(d)?l+="true".slice(d.length):"false".startsWith(d)?l+="false".slice(d.length):"null".startsWith(d)&&(l+="null".slice(d.length));}}return l}function wn(e){if(e===void 0)return {value:void 0,state:"undefined-input"};let t=tt({text:e});return t.success?{value:t.value,state:"successful-parse"}:(t=tt({text:xc(e)}),t.success?{value:t.value,state:"repaired-parse"}:{value:void 0,state:"failed-parse"})}var Sc={code:"0",name:"text",parse:e=>{if(typeof e!="string")throw new Error('"text" parts expect a string value.');return {type:"text",value:e}}},Tc={code:"2",name:"data",parse:e=>{if(!Array.isArray(e))throw new Error('"data" parts expect an array value.');return {type:"data",value:e}}},Ic={code:"3",name:"error",parse:e=>{if(typeof e!="string")throw new Error('"error" parts expect a string value.');return {type:"error",value:e}}},kc={code:"8",name:"message_annotations",parse:e=>{if(!Array.isArray(e))throw new Error('"message_annotations" parts expect an array value.');return {type:"message_annotations",value:e}}},Ec={code:"9",name:"tool_call",parse:e=>{if(e==null||typeof e!="object"||!("toolCallId"in e)||typeof e.toolCallId!="string"||!("toolName"in e)||typeof e.toolName!="string"||!("args"in e)||typeof e.args!="object")throw new Error('"tool_call" parts expect an object with a "toolCallId", "toolName", and "args" property.');return {type:"tool_call",value:e}}},Ac={code:"a",name:"tool_result",parse:e=>{if(e==null||typeof e!="object"||!("toolCallId"in e)||typeof e.toolCallId!="string"||!("result"in e))throw new Error('"tool_result" parts expect an object with a "toolCallId" and a "result" property.');return {type:"tool_result",value:e}}},Cc={code:"b",name:"tool_call_streaming_start",parse:e=>{if(e==null||typeof e!="object"||!("toolCallId"in e)||typeof e.toolCallId!="string"||!("toolName"in e)||typeof e.toolName!="string")throw new Error('"tool_call_streaming_start" parts expect an object with a "toolCallId" and "toolName" property.');return {type:"tool_call_streaming_start",value:e}}},Rc={code:"c",name:"tool_call_delta",parse:e=>{if(e==null||typeof e!="object"||!("toolCallId"in e)||typeof e.toolCallId!="string"||!("argsTextDelta"in e)||typeof e.argsTextDelta!="string")throw new Error('"tool_call_delta" parts expect an object with a "toolCallId" and "argsTextDelta" property.');return {type:"tool_call_delta",value:e}}},Pc={code:"d",name:"finish_message",parse:e=>{if(e==null||typeof e!="object"||!("finishReason"in e)||typeof e.finishReason!="string")throw new Error('"finish_message" parts expect an object with a "finishReason" property.');let t={finishReason:e.finishReason};return "usage"in e&&e.usage!=null&&typeof e.usage=="object"&&"promptTokens"in e.usage&&"completionTokens"in e.usage&&(t.usage={promptTokens:typeof e.usage.promptTokens=="number"?e.usage.promptTokens:Number.NaN,completionTokens:typeof e.usage.completionTokens=="number"?e.usage.completionTokens:Number.NaN}),{type:"finish_message",value:t}}},Oc={code:"e",name:"finish_step",parse:e=>{if(e==null||typeof e!="object"||!("finishReason"in e)||typeof e.finishReason!="string")throw new Error('"finish_step" parts expect an object with a "finishReason" property.');let t={finishReason:e.finishReason,isContinued:false};return "usage"in e&&e.usage!=null&&typeof e.usage=="object"&&"promptTokens"in e.usage&&"completionTokens"in e.usage&&(t.usage={promptTokens:typeof e.usage.promptTokens=="number"?e.usage.promptTokens:Number.NaN,completionTokens:typeof e.usage.completionTokens=="number"?e.usage.completionTokens:Number.NaN}),"isContinued"in e&&typeof e.isContinued=="boolean"&&(t.isContinued=e.isContinued),{type:"finish_step",value:t}}},Nc={code:"f",name:"start_step",parse:e=>{if(e==null||typeof e!="object"||!("messageId"in e)||typeof e.messageId!="string")throw new Error('"start_step" parts expect an object with an "id" property.');return {type:"start_step",value:{messageId:e.messageId}}}},jc={code:"g",name:"reasoning",parse:e=>{if(typeof e!="string")throw new Error('"reasoning" parts expect a string value.');return {type:"reasoning",value:e}}},Mc={code:"h",name:"source",parse:e=>{if(e==null||typeof e!="object")throw new Error('"source" parts expect a Source object.');return {type:"source",value:e}}},Dc={code:"i",name:"redacted_reasoning",parse:e=>{if(e==null||typeof e!="object"||!("data"in e)||typeof e.data!="string")throw new Error('"redacted_reasoning" parts expect an object with a "data" property.');return {type:"redacted_reasoning",value:{data:e.data}}}},$c={code:"j",name:"reasoning_signature",parse:e=>{if(e==null||typeof e!="object"||!("signature"in e)||typeof e.signature!="string")throw new Error('"reasoning_signature" parts expect an object with a "signature" property.');return {type:"reasoning_signature",value:{signature:e.signature}}}},qc={code:"k",name:"file",parse:e=>{if(e==null||typeof e!="object"||!("data"in e)||typeof e.data!="string"||!("mimeType"in e)||typeof e.mimeType!="string")throw new Error('"file" parts expect an object with a "data" and "mimeType" property.');return {type:"file",value:e}}},xn=[Sc,Tc,Ic,kc,Ec,Ac,Cc,Rc,Pc,Oc,Nc,jc,Mc,Dc,$c,qc];Object.fromEntries(xn.map(e=>[e.code,e]));Object.fromEntries(xn.map(e=>[e.name,e.code]));xn.map(e=>e.code);function Se(e,t){let r=xn.find(n=>n.name===e);if(!r)throw new Error(`Invalid stream part type: ${e}`);return `${r.code}:${JSON.stringify(t)}
`}function Hr(e,t){if(e===t)return  true;if(e==null||t==null)return  false;if(typeof e!="object"&&typeof t!="object")return e===t;if(e.constructor!==t.constructor)return  false;if(e instanceof Date&&t instanceof Date)return e.getTime()===t.getTime();if(Array.isArray(e)){if(e.length!==t.length)return  false;for(let a=0;a<e.length;a++)if(!Hr(e[a],t[a]))return  false;return  true}let r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return  false;for(let a of r)if(!n.includes(a)||!Hr(e[a],t[a]))return  false;return  true}function Uc(e,t){var r;let n=(r=void 0)!=null?r:false;return Fc(ko(e,{$refStrategy:n?"root":"none",target:"jsonSchema7"}),{validate:a=>{let s=e.safeParse(a);return s.success?{success:true,value:s.data}:{success:false,error:s.error}}})}var ta=Symbol.for("vercel.ai.schema");function Fc(e,{validate:t}={}){return {[ta]:true,_type:void 0,[Fr]:true,jsonSchema:e,validate:t}}function Lc(e){return typeof e=="object"&&e!==null&&ta in e&&e[ta]===true&&"jsonSchema"in e&&"validate"in e}function pt(e){return Lc(e)?e:Uc(e)}var Eo=typeof globalThis=="object"?globalThis:typeof self=="object"?self:typeof window=="object"?window:typeof global=="object"?global:{};var xt="1.9.0";var Ao=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;function Zc(e){var t=new Set([e]),r=new Set,n=e.match(Ao);if(!n)return function(){return  false};var a={major:+n[1],minor:+n[2],patch:+n[3],prerelease:n[4]};if(a.prerelease!=null)return function(u){return u===e};function s(l){return r.add(l),false}function o(l){return t.add(l),true}return function(u){if(t.has(u))return  true;if(r.has(u))return  false;var c=u.match(Ao);if(!c)return s(u);var d={major:+c[1],minor:+c[2],patch:+c[3],prerelease:c[4]};return d.prerelease!=null||a.major!==d.major?s(u):a.major===0?a.minor===d.minor&&a.patch<=d.patch?o(u):s(u):a.minor<=d.minor?o(u):s(u)}}var Co=Zc(xt);var Jc=xt.split(".")[0],Wr=Symbol.for("opentelemetry.js.api."+Jc),Kr=Eo;function yr(e,t,r,n){var a;n===void 0&&(n=false);var s=Kr[Wr]=(a=Kr[Wr])!==null&&a!==void 0?a:{version:xt};if(!n&&s[e]){var o=new Error("@opentelemetry/api: Attempted duplicate registration of API: "+e);return r.error(o.stack||o.message),false}if(s.version!==xt){var o=new Error("@opentelemetry/api: Registration of version v"+s.version+" for "+e+" does not match previously registered API v"+xt);return r.error(o.stack||o.message),false}return s[e]=t,r.debug("@opentelemetry/api: Registered a global for "+e+" v"+xt+"."),true}function St(e){var t,r,n=(t=Kr[Wr])===null||t===void 0?void 0:t.version;if(!(!n||!Co(n)))return (r=Kr[Wr])===null||r===void 0?void 0:r[e]}function vr(e,t){t.debug("@opentelemetry/api: Unregistering a global for "+e+" v"+xt+".");var r=Kr[Wr];r&&delete r[e];}var Vc=function(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),a,s=[],o;try{for(;(t===void 0||t-- >0)&&!(a=n.next()).done;)s.push(a.value);}catch(l){o={error:l};}finally{try{a&&!a.done&&(r=n.return)&&r.call(n);}finally{if(o)throw o.error}}return s},zc=function(e,t,r){if(arguments.length===2)for(var n=0,a=t.length,s;n<a;n++)(s||!(n in t))&&(s||(s=Array.prototype.slice.call(t,0,n)),s[n]=t[n]);return e.concat(s||Array.prototype.slice.call(t))},Ro=function(){function e(t){this._namespace=t.namespace||"DiagComponentLogger";}return e.prototype.debug=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return Yr("debug",this._namespace,t)},e.prototype.error=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return Yr("error",this._namespace,t)},e.prototype.info=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return Yr("info",this._namespace,t)},e.prototype.warn=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return Yr("warn",this._namespace,t)},e.prototype.verbose=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return Yr("verbose",this._namespace,t)},e}();function Yr(e,t,r){var n=St("diag");if(n)return r.unshift(t),n[e].apply(n,zc([],Vc(r),false))}var De;(function(e){e[e.NONE=0]="NONE",e[e.ERROR=30]="ERROR",e[e.WARN=50]="WARN",e[e.INFO=60]="INFO",e[e.DEBUG=70]="DEBUG",e[e.VERBOSE=80]="VERBOSE",e[e.ALL=9999]="ALL";})(De||(De={}));function Po(e,t){e<De.NONE?e=De.NONE:e>De.ALL&&(e=De.ALL),t=t||{};function r(n,a){var s=t[n];return typeof s=="function"&&e>=a?s.bind(t):function(){}}return {error:r("error",De.ERROR),warn:r("warn",De.WARN),info:r("info",De.INFO),debug:r("debug",De.DEBUG),verbose:r("verbose",De.VERBOSE)}}var Bc=function(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),a,s=[],o;try{for(;(t===void 0||t-- >0)&&!(a=n.next()).done;)s.push(a.value);}catch(l){o={error:l};}finally{try{a&&!a.done&&(r=n.return)&&r.call(n);}finally{if(o)throw o.error}}return s},Gc=function(e,t,r){if(arguments.length===2)for(var n=0,a=t.length,s;n<a;n++)(s||!(n in t))&&(s||(s=Array.prototype.slice.call(t,0,n)),s[n]=t[n]);return e.concat(s||Array.prototype.slice.call(t))},Hc="diag",_r=function(){function e(){function t(a){return function(){for(var s=[],o=0;o<arguments.length;o++)s[o]=arguments[o];var l=St("diag");if(l)return l[a].apply(l,Gc([],Bc(s),false))}}var r=this,n=function(a,s){var o,l,u;if(s===void 0&&(s={logLevel:De.INFO}),a===r){var c=new Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return r.error((o=c.stack)!==null&&o!==void 0?o:c.message),false}typeof s=="number"&&(s={logLevel:s});var d=St("diag"),m=Po((l=s.logLevel)!==null&&l!==void 0?l:De.INFO,a);if(d&&!s.suppressOverrideMessage){var h=(u=new Error().stack)!==null&&u!==void 0?u:"<failed to generate stacktrace>";d.warn("Current logger will be overwritten from "+h),m.warn("Current logger will overwrite one already registered from "+h);}return yr("diag",m,r,true)};r.setLogger=n,r.disable=function(){vr(Hc,r);},r.createComponentLogger=function(a){return new Ro(a)},r.verbose=t("verbose"),r.debug=t("debug"),r.info=t("info"),r.warn=t("warn"),r.error=t("error");}return e.instance=function(){return this._instance||(this._instance=new e),this._instance},e}();function Oo(e){return Symbol.for(e)}var Wc=function(){function e(t){var r=this;r._currentContext=t?new Map(t):new Map,r.getValue=function(n){return r._currentContext.get(n)},r.setValue=function(n,a){var s=new e(r._currentContext);return s._currentContext.set(n,a),s},r.deleteValue=function(n){var a=new e(r._currentContext);return a._currentContext.delete(n),a};}return e}(),No=new Wc;var Kc=function(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),a,s=[],o;try{for(;(t===void 0||t-- >0)&&!(a=n.next()).done;)s.push(a.value);}catch(l){o={error:l};}finally{try{a&&!a.done&&(r=n.return)&&r.call(n);}finally{if(o)throw o.error}}return s},Yc=function(e,t,r){if(arguments.length===2)for(var n=0,a=t.length,s;n<a;n++)(s||!(n in t))&&(s||(s=Array.prototype.slice.call(t,0,n)),s[n]=t[n]);return e.concat(s||Array.prototype.slice.call(t))},jo=function(){function e(){}return e.prototype.active=function(){return No},e.prototype.with=function(t,r,n){for(var a=[],s=3;s<arguments.length;s++)a[s-3]=arguments[s];return r.call.apply(r,Yc([n],Kc(a),false))},e.prototype.bind=function(t,r){return r},e.prototype.enable=function(){return this},e.prototype.disable=function(){return this},e}();var Xc=function(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),a,s=[],o;try{for(;(t===void 0||t-- >0)&&!(a=n.next()).done;)s.push(a.value);}catch(l){o={error:l};}finally{try{a&&!a.done&&(r=n.return)&&r.call(n);}finally{if(o)throw o.error}}return s},Qc=function(e,t,r){if(arguments.length===2)for(var n=0,a=t.length,s;n<a;n++)(s||!(n in t))&&(s||(s=Array.prototype.slice.call(t,0,n)),s[n]=t[n]);return e.concat(s||Array.prototype.slice.call(t))},ra="context",ep=new jo,Sn=function(){function e(){}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalContextManager=function(t){return yr(ra,t,_r.instance())},e.prototype.active=function(){return this._getContextManager().active()},e.prototype.with=function(t,r,n){for(var a,s=[],o=3;o<arguments.length;o++)s[o-3]=arguments[o];return (a=this._getContextManager()).with.apply(a,Qc([t,r,n],Xc(s),false))},e.prototype.bind=function(t,r){return this._getContextManager().bind(t,r)},e.prototype._getContextManager=function(){return St(ra)||ep},e.prototype.disable=function(){this._getContextManager().disable(),vr(ra,_r.instance());},e}();var Tn;(function(e){e[e.NONE=0]="NONE",e[e.SAMPLED=1]="SAMPLED";})(Tn||(Tn={}));var na="0000000000000000",aa="00000000000000000000000000000000",Mo={traceId:aa,spanId:na,traceFlags:Tn.NONE};var Nt=function(){function e(t){t===void 0&&(t=Mo),this._spanContext=t;}return e.prototype.spanContext=function(){return this._spanContext},e.prototype.setAttribute=function(t,r){return this},e.prototype.setAttributes=function(t){return this},e.prototype.addEvent=function(t,r){return this},e.prototype.addLink=function(t){return this},e.prototype.addLinks=function(t){return this},e.prototype.setStatus=function(t){return this},e.prototype.updateName=function(t){return this},e.prototype.end=function(t){},e.prototype.isRecording=function(){return  false},e.prototype.recordException=function(t,r){},e}();var sa=Oo("OpenTelemetry Context Key SPAN");function In(e){return e.getValue(sa)||void 0}function Do(){return In(Sn.getInstance().active())}function Xr(e,t){return e.setValue(sa,t)}function $o(e){return e.deleteValue(sa)}function qo(e,t){return Xr(e,new Nt(t))}function kn(e){var t;return (t=In(e))===null||t===void 0?void 0:t.spanContext()}var tp=/^([0-9a-f]{32})$/i,rp=/^[0-9a-f]{16}$/i;function np(e){return tp.test(e)&&e!==aa}function ap(e){return rp.test(e)&&e!==na}function En(e){return np(e.traceId)&&ap(e.spanId)}function Uo(e){return new Nt(e)}var oa=Sn.getInstance(),An=function(){function e(){}return e.prototype.startSpan=function(t,r,n){n===void 0&&(n=oa.active());var a=!!(r!=null&&r.root);if(a)return new Nt;var s=n&&kn(n);return sp(s)&&En(s)?new Nt(s):new Nt},e.prototype.startActiveSpan=function(t,r,n,a){var s,o,l;if(!(arguments.length<2)){arguments.length===2?l=r:arguments.length===3?(s=r,l=n):(s=r,o=n,l=a);var u=o!=null?o:oa.active(),c=this.startSpan(t,s,u),d=Xr(u,c);return oa.with(d,l,void 0,c)}},e}();function sp(e){return typeof e=="object"&&typeof e.spanId=="string"&&typeof e.traceId=="string"&&typeof e.traceFlags=="number"}var op=new An,Fo=function(){function e(t,r,n,a){this._provider=t,this.name=r,this.version=n,this.options=a;}return e.prototype.startSpan=function(t,r,n){return this._getTracer().startSpan(t,r,n)},e.prototype.startActiveSpan=function(t,r,n,a){var s=this._getTracer();return Reflect.apply(s.startActiveSpan,s,arguments)},e.prototype._getTracer=function(){if(this._delegate)return this._delegate;var t=this._provider.getDelegateTracer(this.name,this.version,this.options);return t?(this._delegate=t,this._delegate):op},e}();var Lo=function(){function e(){}return e.prototype.getTracer=function(t,r,n){return new An},e}();var ip=new Lo,ia=function(){function e(){}return e.prototype.getTracer=function(t,r,n){var a;return (a=this.getDelegateTracer(t,r,n))!==null&&a!==void 0?a:new Fo(this,t,r,n)},e.prototype.getDelegate=function(){var t;return (t=this._delegate)!==null&&t!==void 0?t:ip},e.prototype.setDelegate=function(t){this._delegate=t;},e.prototype.getDelegateTracer=function(t,r,n){var a;return (a=this._delegate)===null||a===void 0?void 0:a.getTracer(t,r,n)},e}();var br;(function(e){e[e.UNSET=0]="UNSET",e[e.OK=1]="OK",e[e.ERROR=2]="ERROR";})(br||(br={}));var la="trace",Zo=function(){function e(){this._proxyTracerProvider=new ia,this.wrapSpanContext=Uo,this.isSpanContextValid=En,this.deleteSpan=$o,this.getSpan=In,this.getActiveSpan=Do,this.getSpanContext=kn,this.setSpan=Xr,this.setSpanContext=qo;}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalTracerProvider=function(t){var r=yr(la,this._proxyTracerProvider,_r.instance());return r&&this._proxyTracerProvider.setDelegate(t),r},e.prototype.getTracerProvider=function(){return St(la)||this._proxyTracerProvider},e.prototype.getTracer=function(t,r){return this.getTracerProvider().getTracer(t,r)},e.prototype.disable=function(){vr(la,_r.instance()),this._proxyTracerProvider=new ia;},e}();var ua=Zo.getInstance();var lp=Object.defineProperty,_a=(e,t)=>{for(var r in t)lp(e,r,{get:t[r],enumerable:true});};function wr(e,{contentType:t,dataStreamVersion:r}){let n=new Headers(e!=null?e:{});return n.has("Content-Type")||n.set("Content-Type",t),r!==void 0&&n.set("X-Vercel-AI-Data-Stream",r),n}function ma(e,{contentType:t,dataStreamVersion:r}){let n={};if(e!=null)for(let[a,s]of Object.entries(e))n[a]=s;return n["Content-Type"]==null&&(n["Content-Type"]=t),r!==void 0&&(n["X-Vercel-AI-Data-Stream"]=r),n}function fa({response:e,status:t,statusText:r,headers:n,stream:a}){e.writeHead(t!=null?t:200,r,n);let s=a.getReader();T(null,null,function*(){try{for(;;){let{done:l,value:u}=yield s.read();if(l)break;e.write(u);}}catch(l){throw l}finally{e.end();}});}var Ko="AI_InvalidArgumentError",Yo=`vercel.ai.error.${Ko}`,up=Symbol.for(Yo),Xo,se=class extends N{constructor({parameter:e,value:t,message:r}){super({name:Ko,message:`Invalid argument for parameter ${e}: ${r}`}),this[Xo]=true,this.parameter=e,this.value=t;}static isInstance(e){return N.hasMarker(e,Yo)}};Xo=up;var Qo="AI_RetryError",ei=`vercel.ai.error.${Qo}`,cp=Symbol.for(ei),ti,Jo=class extends N{constructor({message:e,reason:t,errors:r}){super({name:Qo,message:e}),this[ti]=true,this.reason=t,this.errors=r,this.lastError=r[r.length-1];}static isInstance(e){return N.hasMarker(e,ei)}};ti=cp;var pp=({maxRetries:e=2,initialDelayInMs:t=2e3,backoffFactor:r=2}={})=>n=>T(null,null,function*(){return ri(n,{maxRetries:e,delayInMs:t,backoffFactor:r})});function ri(s,o){return T(this,arguments,function*(e,{maxRetries:t,delayInMs:r,backoffFactor:n},a=[]){try{return yield e()}catch(l){if(Ur(l)||t===0)throw l;let u=qs(l),c=[...a,l],d=c.length;if(d>t)throw new Jo({message:`Failed after ${d} attempts. Last error: ${u}`,reason:"maxRetriesExceeded",errors:c});if(l instanceof Error&&Ne.isInstance(l)&&l.isRetryable===true&&d<=t)return yield $s(r),ri(e,{maxRetries:t,delayInMs:n*r,backoffFactor:n},c);throw d===1?l:new Jo({message:`Failed after ${d} attempts with non-retryable error: '${u}'`,reason:"errorNotRetryable",errors:c})}})}function Pn({maxRetries:e}){if(e!=null){if(!Number.isInteger(e))throw new se({parameter:"maxRetries",value:e,message:"maxRetries must be an integer"});if(e<0)throw new se({parameter:"maxRetries",value:e,message:"maxRetries must be >= 0"})}let t=e!=null?e:2;return {maxRetries:t,retry:pp({maxRetries:t})}}function at({operationId:e,telemetry:t}){return {"operation.name":`${e}${(t==null?void 0:t.functionId)!=null?` ${t.functionId}`:""}`,"resource.name":t==null?void 0:t.functionId,"ai.operationId":e,"ai.telemetry.functionId":t==null?void 0:t.functionId}}function On({model:e,settings:t,telemetry:r,headers:n}){var a;return p(p(p({"ai.model.provider":e.provider,"ai.model.id":e.modelId},Object.entries(t).reduce((s,[o,l])=>(s[`ai.settings.${o}`]=l,s),{})),Object.entries((a=r==null?void 0:r.metadata)!=null?a:{}).reduce((s,[o,l])=>(s[`ai.telemetry.metadata.${o}`]=l,s),{})),Object.entries(n!=null?n:{}).reduce((s,[o,l])=>(l!==void 0&&(s[`ai.request.headers.${o}`]=l),s),{}))}var dp={startSpan(){return Cn},startActiveSpan(e,t,r,n){if(typeof t=="function")return t(Cn);if(typeof r=="function")return r(Cn);if(typeof n=="function")return n(Cn)}},Cn={spanContext(){return mp},setAttribute(){return this},setAttributes(){return this},addEvent(){return this},addLink(){return this},addLinks(){return this},setStatus(){return this},updateName(){return this},end(){return this},isRecording(){return  false},recordException(){return this}},mp={traceId:"",spanId:"",traceFlags:0};function Nn({isEnabled:e=false,tracer:t}={}){return e?t||ua.getTracer("ai"):dp}function st({name:e,tracer:t,attributes:r,fn:n,endWhenDone:a=true}){return t.startActiveSpan(e,{attributes:r},s=>T(null,null,function*(){try{let o=yield n(s);return a&&s.end(),o}catch(o){try{o instanceof Error?(s.recordException({name:o.name,message:o.message,stack:o.stack}),s.setStatus({code:br.ERROR,message:o.message})):s.setStatus({code:br.ERROR});}finally{s.end();}throw o}}))}function me({telemetry:e,attributes:t}){return (e==null?void 0:e.isEnabled)!==true?{}:Object.entries(t).reduce((r,[n,a])=>{if(a===void 0)return r;if(typeof a=="object"&&"input"in a&&typeof a.input=="function"){if((e==null?void 0:e.recordInputs)===false)return r;let s=a.input();return s===void 0?r:f(p({},r),{[n]:s})}if(typeof a=="object"&&"output"in a&&typeof a.output=="function"){if((e==null?void 0:e.recordOutputs)===false)return r;let s=a.output();return s===void 0?r:f(p({},r),{[n]:s})}return f(p({},r),{[n]:a})},{})}var ni=class{constructor({data:e,mimeType:t}){let r=e instanceof Uint8Array;this.base64Data=r?void 0:e,this.uint8ArrayData=r?e:void 0,this.mimeType=t;}get base64(){return this.base64Data==null&&(this.base64Data=wt(this.uint8ArrayData)),this.base64Data}get uint8Array(){return this.uint8ArrayData==null&&(this.uint8ArrayData=Ot(this.base64Data)),this.uint8ArrayData}},vp=class extends ni{constructor(e){super(e),this.type="file";}},_p=[{mimeType:"image/gif",bytesPrefix:[71,73,70],base64Prefix:"R0lG"},{mimeType:"image/png",bytesPrefix:[137,80,78,71],base64Prefix:"iVBORw"},{mimeType:"image/jpeg",bytesPrefix:[255,216],base64Prefix:"/9j/"},{mimeType:"image/webp",bytesPrefix:[82,73,70,70],base64Prefix:"UklGRg"},{mimeType:"image/bmp",bytesPrefix:[66,77],base64Prefix:"Qk"},{mimeType:"image/tiff",bytesPrefix:[73,73,42,0],base64Prefix:"SUkqAA"},{mimeType:"image/tiff",bytesPrefix:[77,77,0,42],base64Prefix:"TU0AKg"},{mimeType:"image/avif",bytesPrefix:[0,0,0,32,102,116,121,112,97,118,105,102],base64Prefix:"AAAAIGZ0eXBhdmlm"},{mimeType:"image/heic",bytesPrefix:[0,0,0,32,102,116,121,112,104,101,105,99],base64Prefix:"AAAAIGZ0eXBoZWlj"}];var bp=e=>{let t=typeof e=="string"?Ot(e):e,r=(t[6]&127)<<21|(t[7]&127)<<14|(t[8]&127)<<7|t[9]&127;return t.slice(r+10)};function wp(e){return typeof e=="string"&&e.startsWith("SUQz")||typeof e!="string"&&e.length>10&&e[0]===73&&e[1]===68&&e[2]===51?bp(e):e}function xp({data:e,signatures:t}){let r=wp(e);for(let n of t)if(typeof r=="string"?r.startsWith(n.base64Prefix):r.length>=n.bytesPrefix.length&&n.bytesPrefix.every((a,s)=>r[s]===a))return n.mimeType}var ai="AI_NoObjectGeneratedError",si=`vercel.ai.error.${ai}`,Sp=Symbol.for(si),oi,It=class extends N{constructor({message:e="No object generated.",cause:t,text:r,response:n,usage:a,finishReason:s}){super({name:ai,message:e,cause:t}),this[oi]=true,this.text=r,this.response=n,this.usage=a,this.finishReason=s;}static isInstance(e){return N.hasMarker(e,si)}};oi=Sp;var ii="AI_DownloadError",li=`vercel.ai.error.${ii}`,Tp=Symbol.for(li),ui,ca=class extends N{constructor({url:e,statusCode:t,statusText:r,cause:n,message:a=n==null?`Failed to download ${e}: ${t} ${r}`:`Failed to download ${e}: ${n}`}){super({name:ii,message:a,cause:n}),this[ui]=true,this.url=e,this.statusCode=t,this.statusText=r;}static isInstance(e){return N.hasMarker(e,li)}};ui=Tp;function Ip(t){return T(this,arguments,function*({url:e}){var r;let n=e.toString();try{let a=yield fetch(n);if(!a.ok)throw new ca({url:n,statusCode:a.status,statusText:a.statusText});return {data:new Uint8Array(yield a.arrayBuffer()),mimeType:(r=a.headers.get("content-type"))!=null?r:void 0}}catch(a){throw ca.isInstance(a)?a:new ca({url:n,cause:a})}})}var ci="AI_InvalidDataContentError",pi=`vercel.ai.error.${ci}`,kp=Symbol.for(pi),di,Vo=class extends N{constructor({content:e,cause:t,message:r=`Invalid data content. Expected a base64 string, Uint8Array, ArrayBuffer, or Buffer, but got ${typeof e}.`}){super({name:ci,message:r,cause:t}),this[di]=true,this.content=e;}static isInstance(e){return N.hasMarker(e,pi)}};di=kp;var mi=i.union([i.string(),i.instanceof(Uint8Array),i.instanceof(ArrayBuffer),i.custom(e=>{var t,r;return (r=(t=globalThis.Buffer)==null?void 0:t.isBuffer(e))!=null?r:false},{message:"Must be a Buffer"})]);function fi(e){return typeof e=="string"?e:e instanceof ArrayBuffer?wt(new Uint8Array(e)):wt(e)}function Rn(e){if(e instanceof Uint8Array)return e;if(typeof e=="string")try{return Ot(e)}catch(t){throw new Vo({message:"Invalid data content. Content string is not a base64-encoded media.",content:e,cause:t})}if(e instanceof ArrayBuffer)return new Uint8Array(e);throw new Vo({content:e})}function Ep(e){try{return new TextDecoder().decode(e)}catch(t){throw new Error("Error decoding Uint8Array to text")}}var hi="AI_InvalidMessageRoleError",gi=`vercel.ai.error.${hi}`,Ap=Symbol.for(gi),yi,Cp=class extends N{constructor({role:e,message:t=`Invalid message role: '${e}'. Must be one of: "system", "user", "assistant", "tool".`}){super({name:hi,message:t}),this[yi]=true,this.role=e;}static isInstance(e){return N.hasMarker(e,gi)}};yi=Ap;function Rp(e){try{let[t,r]=e.split(",");return {mimeType:t.split(";")[0].split(":")[1],base64Content:r}}catch(t){return {mimeType:void 0,base64Content:void 0}}}function xr(a){return T(this,arguments,function*({prompt:e,modelSupportsImageUrls:t=true,modelSupportsUrl:r=()=>false,downloadImplementation:n=Ip}){let s=yield Op(e.messages,n,t,r);return [...e.system!=null?[{role:"system",content:e.system}]:[],...e.messages.map(o=>Pp(o,s))]})}function Pp(e,t){var r,n,a,s,o,l;let u=e.role;switch(u){case "system":return {role:"system",content:e.content,providerMetadata:(r=e.providerOptions)!=null?r:e.experimental_providerMetadata};case "user":return typeof e.content=="string"?{role:"user",content:[{type:"text",text:e.content}],providerMetadata:(n=e.providerOptions)!=null?n:e.experimental_providerMetadata}:{role:"user",content:e.content.map(c=>Np(c,t)).filter(c=>c.type!=="text"||c.text!==""),providerMetadata:(a=e.providerOptions)!=null?a:e.experimental_providerMetadata};case "assistant":return typeof e.content=="string"?{role:"assistant",content:[{type:"text",text:e.content}],providerMetadata:(s=e.providerOptions)!=null?s:e.experimental_providerMetadata}:{role:"assistant",content:e.content.filter(c=>c.type!=="text"||c.text!=="").map(c=>{var d;let m=(d=c.providerOptions)!=null?d:c.experimental_providerMetadata;switch(c.type){case "file":return {type:"file",data:c.data instanceof URL?c.data:fi(c.data),filename:c.filename,mimeType:c.mimeType,providerMetadata:m};case "reasoning":return {type:"reasoning",text:c.text,signature:c.signature,providerMetadata:m};case "redacted-reasoning":return {type:"redacted-reasoning",data:c.data,providerMetadata:m};case "text":return {type:"text",text:c.text,providerMetadata:m};case "tool-call":return {type:"tool-call",toolCallId:c.toolCallId,toolName:c.toolName,args:c.args,providerMetadata:m}}}),providerMetadata:(o=e.providerOptions)!=null?o:e.experimental_providerMetadata};case "tool":return {role:"tool",content:e.content.map(c=>{var d;return {type:"tool-result",toolCallId:c.toolCallId,toolName:c.toolName,result:c.result,content:c.experimental_content,isError:c.isError,providerMetadata:(d=c.providerOptions)!=null?d:c.experimental_providerMetadata}}),providerMetadata:(l=e.providerOptions)!=null?l:e.experimental_providerMetadata};default:{let c=u;throw new Cp({role:c})}}}function Op(e,t,r,n){return T(this,null,function*(){let a=e.filter(o=>o.role==="user").map(o=>o.content).filter(o=>Array.isArray(o)).flat().filter(o=>o.type==="image"||o.type==="file").filter(o=>!(o.type==="image"&&r===true)).map(o=>o.type==="image"?o.image:o.data).map(o=>typeof o=="string"&&(o.startsWith("http:")||o.startsWith("https:"))?new URL(o):o).filter(o=>o instanceof URL).filter(o=>!n(o)),s=yield Promise.all(a.map(o=>T(null,null,function*(){return {url:o,data:yield t({url:o})}})));return Object.fromEntries(s.map(({url:o,data:l})=>[o.toString(),l]))})}function Np(e,t){var r,n,a,s;if(e.type==="text")return {type:"text",text:e.text,providerMetadata:(r=e.providerOptions)!=null?r:e.experimental_providerMetadata};let o=e.mimeType,l,u,c,d=e.type;switch(d){case "image":l=e.image;break;case "file":l=e.data;break;default:throw new Error(`Unsupported part type: ${d}`)}try{u=typeof l=="string"?new URL(l):l;}catch(m){u=l;}if(u instanceof URL)if(u.protocol==="data:"){let{mimeType:m,base64Content:h}=Rp(u.toString());if(m==null||h==null)throw new Error(`Invalid data URL format in part ${d}`);o=m,c=Rn(h);}else {let m=t[u.toString()];m?(c=m.data,o!=null||(o=m.mimeType)):c=u;}else c=Rn(u);switch(d){case "image":return c instanceof Uint8Array&&(o=(n=xp({data:c,signatures:_p}))!=null?n:o),{type:"image",image:c,mimeType:o,providerMetadata:(a=e.providerOptions)!=null?a:e.experimental_providerMetadata};case "file":{if(o==null)throw new Error("Mime type is missing for file part");return {type:"file",data:c instanceof Uint8Array?fi(c):c,filename:e.filename,mimeType:o,providerMetadata:(s=e.providerOptions)!=null?s:e.experimental_providerMetadata}}}}function Sr({maxTokens:e,temperature:t,topP:r,topK:n,presencePenalty:a,frequencyPenalty:s,stopSequences:o,seed:l}){if(e!=null){if(!Number.isInteger(e))throw new se({parameter:"maxTokens",value:e,message:"maxTokens must be an integer"});if(e<1)throw new se({parameter:"maxTokens",value:e,message:"maxTokens must be >= 1"})}if(t!=null&&typeof t!="number")throw new se({parameter:"temperature",value:t,message:"temperature must be a number"});if(r!=null&&typeof r!="number")throw new se({parameter:"topP",value:r,message:"topP must be a number"});if(n!=null&&typeof n!="number")throw new se({parameter:"topK",value:n,message:"topK must be a number"});if(a!=null&&typeof a!="number")throw new se({parameter:"presencePenalty",value:a,message:"presencePenalty must be a number"});if(s!=null&&typeof s!="number")throw new se({parameter:"frequencyPenalty",value:s,message:"frequencyPenalty must be a number"});if(l!=null&&!Number.isInteger(l))throw new se({parameter:"seed",value:l,message:"seed must be an integer"});return {maxTokens:e,temperature:t!=null?t:0,topP:r,topK:n,presencePenalty:a,frequencyPenalty:s,stopSequences:o!=null&&o.length>0?o:void 0,seed:l}}function zo(e){var t,r,n;let a=[];for(let s of e){let o;try{o=new URL(s.url);}catch(l){throw new Error(`Invalid URL: ${s.url}`)}switch(o.protocol){case "http:":case "https:":{if((t=s.contentType)!=null&&t.startsWith("image/"))a.push({type:"image",image:o});else {if(!s.contentType)throw new Error("If the attachment is not an image, it must specify a content type");a.push({type:"file",data:o,mimeType:s.contentType});}break}case "data:":{let l,u,c;try{[l,u]=s.url.split(","),c=l.split(";")[0].split(":")[1];}catch(d){throw new Error(`Error processing data URL: ${s.url}`)}if(c==null||u==null)throw new Error(`Invalid data URL format: ${s.url}`);if((r=s.contentType)!=null&&r.startsWith("image/"))a.push({type:"image",image:Rn(u)});else if((n=s.contentType)!=null&&n.startsWith("text/"))a.push({type:"text",text:Ep(Rn(u))});else {if(!s.contentType)throw new Error("If the attachment is not an image or text, it must specify a content type");a.push({type:"file",data:u,mimeType:s.contentType});}break}default:throw new Error(`Unsupported URL protocol: ${o.protocol}`)}}return a}var vi="AI_MessageConversionError",_i=`vercel.ai.error.${vi}`,jp=Symbol.for(_i),bi,pa=class extends N{constructor({originalMessage:e,message:t}){super({name:vi,message:t}),this[bi]=true,this.originalMessage=e;}static isInstance(e){return N.hasMarker(e,_i)}};bi=jp;function Mp(e,t){var r,n;let a=(r=t==null?void 0:t.tools)!=null?r:{},s=[];for(let l=0;l<e.length;l++){let u=e[l],c=l===e.length-1,{role:d,content:m,experimental_attachments:h}=u;switch(d){case "system":{s.push({role:"system",content:m});break}case "user":{if(u.parts==null)s.push({role:"user",content:h?[{type:"text",text:m},...zo(h)]:m});else {let _=u.parts.filter(S=>S.type==="text").map(S=>({type:"text",text:S.text}));s.push({role:"user",content:h?[..._,...zo(h)]:_});}break}case "assistant":{if(u.parts!=null){let I=function(){let v=[];for(let O of k)switch(O.type){case "file":case "text":{v.push(O);break}case "reasoning":{for(let A of O.details)switch(A.type){case "text":v.push({type:"reasoning",text:A.text,signature:A.signature});break;case "redacted":v.push({type:"redacted-reasoning",data:A.data});break}break}case "tool-invocation":v.push({type:"tool-call",toolCallId:O.toolInvocation.toolCallId,toolName:O.toolInvocation.toolName,args:O.toolInvocation.args});break;default:{let A=O;throw new Error(`Unsupported part: ${A}`)}}s.push({role:"assistant",content:v});let P=k.filter(O=>O.type==="tool-invocation").map(O=>O.toolInvocation);P.length>0&&s.push({role:"tool",content:P.map(O=>{if(!("result"in O))throw new pa({originalMessage:u,message:"ToolInvocation must have a result: "+JSON.stringify(O)});let{toolCallId:A,toolName:B,result:C}=O,M=a[B];return (M==null?void 0:M.experimental_toToolResultContent)!=null?{type:"tool-result",toolCallId:A,toolName:B,result:M.experimental_toToolResultContent(C),experimental_content:M.experimental_toToolResultContent(C)}:{type:"tool-result",toolCallId:A,toolName:B,result:C}})}),k=[],b=false,g++;};let g=0,b=false,k=[];for(let v of u.parts)switch(v.type){case "text":{b&&I(),k.push(v);break}case "file":case "reasoning":{k.push(v);break}case "tool-invocation":{((n=v.toolInvocation.step)!=null?n:0)!==g&&I(),k.push(v),b=true;break}}I();break}let _=u.toolInvocations;if(_==null||_.length===0){s.push({role:"assistant",content:m});break}let S=_.reduce((I,g)=>{var b;return Math.max(I,(b=g.step)!=null?b:0)},0);for(let I=0;I<=S;I++){let g=_.filter(b=>{var k;return ((k=b.step)!=null?k:0)===I});g.length!==0&&(s.push({role:"assistant",content:[...c&&m&&I===0?[{type:"text",text:m}]:[],...g.map(({toolCallId:b,toolName:k,args:v})=>({type:"tool-call",toolCallId:b,toolName:k,args:v}))]}),s.push({role:"tool",content:g.map(b=>{if(!("result"in b))throw new pa({originalMessage:u,message:"ToolInvocation must have a result: "+JSON.stringify(b)});let{toolCallId:k,toolName:v,result:P}=b,O=a[v];return (O==null?void 0:O.experimental_toToolResultContent)!=null?{type:"tool-result",toolCallId:k,toolName:v,result:O.experimental_toToolResultContent(P),experimental_content:O.experimental_toToolResultContent(P)}:{type:"tool-result",toolCallId:k,toolName:v,result:P}})}));}m&&!c&&s.push({role:"assistant",content:m});break}case "data":break;default:{let _=d;throw new pa({originalMessage:u,message:`Unsupported role: ${_}`})}}}return s}var ha=i.lazy(()=>i.union([i.null(),i.string(),i.number(),i.boolean(),i.record(i.string(),ha),i.array(ha)])),fe=i.record(i.string(),i.record(i.string(),ha)),Dp=i.array(i.union([i.object({type:i.literal("text"),text:i.string()}),i.object({type:i.literal("image"),data:i.string(),mimeType:i.string().optional()})])),wi=i.object({type:i.literal("text"),text:i.string(),providerOptions:fe.optional(),experimental_providerMetadata:fe.optional()}),$p=i.object({type:i.literal("image"),image:i.union([mi,i.instanceof(URL)]),mimeType:i.string().optional(),providerOptions:fe.optional(),experimental_providerMetadata:fe.optional()}),xi=i.object({type:i.literal("file"),data:i.union([mi,i.instanceof(URL)]),filename:i.string().optional(),mimeType:i.string(),providerOptions:fe.optional(),experimental_providerMetadata:fe.optional()}),qp=i.object({type:i.literal("reasoning"),text:i.string(),providerOptions:fe.optional(),experimental_providerMetadata:fe.optional()}),Up=i.object({type:i.literal("redacted-reasoning"),data:i.string(),providerOptions:fe.optional(),experimental_providerMetadata:fe.optional()}),Fp=i.object({type:i.literal("tool-call"),toolCallId:i.string(),toolName:i.string(),args:i.unknown(),providerOptions:fe.optional(),experimental_providerMetadata:fe.optional()}),Lp=i.object({type:i.literal("tool-result"),toolCallId:i.string(),toolName:i.string(),result:i.unknown(),content:Dp.optional(),isError:i.boolean().optional(),providerOptions:fe.optional(),experimental_providerMetadata:fe.optional()}),Zp=i.object({role:i.literal("system"),content:i.string(),providerOptions:fe.optional(),experimental_providerMetadata:fe.optional()}),Jp=i.object({role:i.literal("user"),content:i.union([i.string(),i.array(i.union([wi,$p,xi]))]),providerOptions:fe.optional(),experimental_providerMetadata:fe.optional()}),Vp=i.object({role:i.literal("assistant"),content:i.union([i.string(),i.array(i.union([wi,xi,qp,Up,Fp]))]),providerOptions:fe.optional(),experimental_providerMetadata:fe.optional()}),zp=i.object({role:i.literal("tool"),content:i.array(Lp),providerOptions:fe.optional(),experimental_providerMetadata:fe.optional()}),Bp=i.union([Zp,Jp,Vp,zp]);function Tr({prompt:e,tools:t}){if(e.prompt==null&&e.messages==null)throw new Qe({prompt:e,message:"prompt or messages must be defined"});if(e.prompt!=null&&e.messages!=null)throw new Qe({prompt:e,message:"prompt and messages cannot be defined at the same time"});if(e.system!=null&&typeof e.system!="string")throw new Qe({prompt:e,message:"system must be a string"});if(e.prompt!=null){if(typeof e.prompt!="string")throw new Qe({prompt:e,message:"prompt must be a string"});return {type:"prompt",system:e.system,messages:[{role:"user",content:e.prompt}]}}if(e.messages!=null){let n=Gp(e.messages)==="ui-messages"?Mp(e.messages,{tools:t}):e.messages;if(n.length===0)throw new Qe({prompt:e,message:"messages must not be empty"});let a=Ve({value:n,schema:i.array(Bp)});if(!a.success)throw new Qe({prompt:e,message:["message must be a CoreMessage or a UI message",`Validation error: ${a.error.message}`].join(`
`),cause:a.error});return {type:"messages",messages:n,system:e.system}}throw new Error("unreachable")}function Gp(e){if(!Array.isArray(e))throw new Qe({prompt:e,message:["messages must be an array of CoreMessage or UIMessage",`Received non-array value: ${JSON.stringify(e)}`].join(`
`),cause:e});if(e.length===0)return "messages";let t=e.map(Hp);if(t.some(n=>n==="has-ui-specific-parts"))return "ui-messages";let r=t.findIndex(n=>n!=="has-core-specific-parts"&&n!=="message");if(r===-1)return "messages";throw new Qe({prompt:e,message:["messages must be an array of CoreMessage or UIMessage",`Received message of type: "${t[r]}" at index ${r}`,`messages[${r}]: ${JSON.stringify(e[r])}`].join(`
`),cause:e})}function Hp(e){return typeof e=="object"&&e!==null&&(e.role==="function"||e.role==="data"||"toolInvocations"in e||"parts"in e||"experimental_attachments"in e)?"has-ui-specific-parts":typeof e=="object"&&e!==null&&"content"in e&&(Array.isArray(e.content)||"experimental_providerMetadata"in e||"providerOptions"in e)?"has-core-specific-parts":typeof e=="object"&&e!==null&&"role"in e&&"content"in e&&typeof e.content=="string"&&["system","user","assistant","tool"].includes(e.role)?"message":"other"}function Tt({promptTokens:e,completionTokens:t}){return {promptTokens:e,completionTokens:t,totalTokens:e+t}}function Si(e,t){return {promptTokens:e.promptTokens+t.promptTokens,completionTokens:e.completionTokens+t.completionTokens,totalTokens:e.totalTokens+t.totalTokens}}var Wp="JSON schema:",Kp="You MUST answer with a JSON object that matches the JSON schema above.",Yp="You MUST answer with JSON.";function Qr({prompt:e,schema:t,schemaPrefix:r=t!=null?Wp:void 0,schemaSuffix:n=t!=null?Kp:Yp}){return [e!=null&&e.length>0?e:void 0,e!=null&&e.length>0?"":void 0,r,t!=null?JSON.stringify(t):void 0,n].filter(a=>a!=null).join(`
`)}function rr(e){let t=e.pipeThrough(new TransformStream);return t[Symbol.asyncIterator]=()=>{let r=t.getReader();return {next(){return T(this,null,function*(){let{done:a,value:s}=yield r.read();return a?{done:true,value:void 0}:{done:false,value:s}})}}},t}var Xp={type:"no-schema",jsonSchema:void 0,validatePartialResult({value:e,textDelta:t}){return {success:true,value:{partial:e,textDelta:t}}},validateFinalResult(e,t){return e===void 0?{success:false,error:new It({message:"No object generated: response did not match schema.",text:t.text,response:t.response,usage:t.usage,finishReason:t.finishReason})}:{success:true,value:e}},createElementStream(){throw new ee({functionality:"element streams in no-schema mode"})}},Qp=e=>({type:"object",jsonSchema:e.jsonSchema,validatePartialResult({value:t,textDelta:r}){return {success:true,value:{partial:t,textDelta:r}}},validateFinalResult(t){return Ve({value:t,schema:e})},createElementStream(){throw new ee({functionality:"element streams in object mode"})}}),ed=e=>{let n=e.jsonSchema,{$schema:t}=n;return {type:"enum",jsonSchema:{$schema:"http://json-schema.org/draft-07/schema#",type:"object",properties:{elements:{type:"array",items:Ce(n,["$schema"])}},required:["elements"],additionalProperties:false},validatePartialResult({value:a,latestObject:s,isFirstDelta:o,isFinalDelta:l}){var u;if(!gn(a)||!Hn(a.elements))return {success:false,error:new Je({value:a,cause:"value must be an object that contains an array of elements"})};let c=a.elements,d=[];for(let _=0;_<c.length;_++){let S=c[_],I=Ve({value:S,schema:e});if(!(_===c.length-1&&!l)){if(!I.success)return I;d.push(I.value);}}let m=(u=s==null?void 0:s.length)!=null?u:0,h="";return o&&(h+="["),m>0&&(h+=","),h+=d.slice(m).map(_=>JSON.stringify(_)).join(","),l&&(h+="]"),{success:true,value:{partial:d,textDelta:h}}},validateFinalResult(a){if(!gn(a)||!Hn(a.elements))return {success:false,error:new Je({value:a,cause:"value must be an object that contains an array of elements"})};let s=a.elements;for(let o of s){let l=Ve({value:o,schema:e});if(!l.success)return l}return {success:true,value:s}},createElementStream(a){let s=0;return rr(a.pipeThrough(new TransformStream({transform(o,l){switch(o.type){case "object":{let u=o.object;for(;s<u.length;s++)l.enqueue(u[s]);break}case "text-delta":case "finish":case "error":break;default:{let u=o;throw new Error(`Unsupported chunk type: ${u}`)}}}})))}}},td=e=>({type:"enum",jsonSchema:{$schema:"http://json-schema.org/draft-07/schema#",type:"object",properties:{result:{type:"string",enum:e}},required:["result"],additionalProperties:false},validateFinalResult(t){if(!gn(t)||typeof t.result!="string")return {success:false,error:new Je({value:t,cause:'value must be an object that contains a string in the "result" property.'})};let r=t.result;return e.includes(r)?{success:true,value:r}:{success:false,error:new Je({value:t,cause:"value must be a string in the enum"})}},validatePartialResult(){throw new ee({functionality:"partial results in enum mode"})},createElementStream(){throw new ee({functionality:"element streams in enum mode"})}});function Ti({output:e,schema:t,enumValues:r}){switch(e){case "object":return Qp(pt(t));case "array":return ed(pt(t));case "enum":return td(r);case "no-schema":return Xp;default:{let n=e;throw new Error(`Unsupported output: ${n}`)}}}function Ii({output:e,mode:t,schema:r,schemaName:n,schemaDescription:a,enumValues:s}){if(e!=null&&e!=="object"&&e!=="array"&&e!=="enum"&&e!=="no-schema")throw new se({parameter:"output",value:e,message:"Invalid output type."});if(e==="no-schema"){if(t==="auto"||t==="tool")throw new se({parameter:"mode",value:t,message:'Mode must be "json" for no-schema output.'});if(r!=null)throw new se({parameter:"schema",value:r,message:"Schema is not supported for no-schema output."});if(a!=null)throw new se({parameter:"schemaDescription",value:a,message:"Schema description is not supported for no-schema output."});if(n!=null)throw new se({parameter:"schemaName",value:n,message:"Schema name is not supported for no-schema output."});if(s!=null)throw new se({parameter:"enumValues",value:s,message:"Enum values are not supported for no-schema output."})}if(e==="object"){if(r==null)throw new se({parameter:"schema",value:r,message:"Schema is required for object output."});if(s!=null)throw new se({parameter:"enumValues",value:s,message:"Enum values are not supported for object output."})}if(e==="array"){if(r==null)throw new se({parameter:"schema",value:r,message:"Element schema is required for array output."});if(s!=null)throw new se({parameter:"enumValues",value:s,message:"Enum values are not supported for array output."})}if(e==="enum"){if(r!=null)throw new se({parameter:"schema",value:r,message:"Schema is not supported for enum output."});if(a!=null)throw new se({parameter:"schemaDescription",value:a,message:"Schema description is not supported for enum output."});if(n!=null)throw new se({parameter:"schemaName",value:n,message:"Schema name is not supported for enum output."});if(s==null)throw new se({parameter:"enumValues",value:s,message:"Enum values are required for enum output."});for(let o of s)if(typeof o!="string")throw new se({parameter:"enumValues",value:o,message:"Enum values must be strings."})}}var rd=et({prefix:"aiobj",size:24});function ki(P){return T(this,null,function*(){var O=P,{model:e,enum:t,schema:r,schemaName:n,schemaDescription:a,mode:s,output:o="object",system:l,prompt:u,messages:c,maxRetries:d,abortSignal:m,headers:h,experimental_repairText:_,experimental_telemetry:S,experimental_providerMetadata:I,providerOptions:g=I,_internal:{generateId:b=rd,currentDate:k=()=>new Date}={}}=O,v=Ce(O,["model","enum","schema","schemaName","schemaDescription","mode","output","system","prompt","messages","maxRetries","abortSignal","headers","experimental_repairText","experimental_telemetry","experimental_providerMetadata","providerOptions","_internal"]);Ii({output:o,mode:s,schema:r,schemaName:n,schemaDescription:a,enumValues:t});let{maxRetries:A,retry:B}=Pn({maxRetries:d}),C=Ti({output:o,schema:r,enumValues:t});C.type==="no-schema"&&s===void 0&&(s="json");let M=On({model:e,telemetry:S,headers:h,settings:f(p({},v),{maxRetries:A})}),X=Nn(S);return st({name:"ai.generateObject",attributes:me({telemetry:S,attributes:f(p(p({},at({operationId:"ai.generateObject",telemetry:S})),M),{"ai.prompt":{input:()=>JSON.stringify({system:l,prompt:u,messages:c})},"ai.schema":C.jsonSchema!=null?{input:()=>JSON.stringify(C.jsonSchema)}:void 0,"ai.schema.name":n,"ai.schema.description":a,"ai.settings.output":C.type,"ai.settings.mode":s})}),tracer:X,fn:ue=>T(null,null,function*(){var we,ce,re,pe;(s==="auto"||s==null)&&(s=e.defaultObjectGenerationMode);let ye,ne,he,Q,oe,F,L,Pe,ke;switch(s){case "json":{let K=Tr({prompt:{system:C.jsonSchema==null?Qr({prompt:l}):e.supportsStructuredOutputs?l:Qr({prompt:l,schema:C.jsonSchema}),prompt:u,messages:c},tools:void 0}),Y=yield xr({prompt:K,modelSupportsImageUrls:e.supportsImageUrls,modelSupportsUrl:(we=e.supportsUrl)==null?void 0:we.bind(e)}),te=yield B(()=>st({name:"ai.generateObject.doGenerate",attributes:me({telemetry:S,attributes:f(p(p({},at({operationId:"ai.generateObject.doGenerate",telemetry:S})),M),{"ai.prompt.format":{input:()=>K.type},"ai.prompt.messages":{input:()=>JSON.stringify(Y)},"ai.settings.mode":s,"gen_ai.system":e.provider,"gen_ai.request.model":e.modelId,"gen_ai.request.frequency_penalty":v.frequencyPenalty,"gen_ai.request.max_tokens":v.maxTokens,"gen_ai.request.presence_penalty":v.presencePenalty,"gen_ai.request.temperature":v.temperature,"gen_ai.request.top_k":v.topK,"gen_ai.request.top_p":v.topP})}),tracer:X,fn:de=>T(null,null,function*(){var U,xe,Te,$e,z,D;let G=yield e.doGenerate(f(p({mode:{type:"object-json",schema:C.jsonSchema,name:n,description:a}},Sr(v)),{inputFormat:K.type,prompt:Y,providerMetadata:g,abortSignal:m,headers:h})),ae={id:(xe=(U=G.response)==null?void 0:U.id)!=null?xe:b(),timestamp:($e=(Te=G.response)==null?void 0:Te.timestamp)!=null?$e:k(),modelId:(D=(z=G.response)==null?void 0:z.modelId)!=null?D:e.modelId};if(G.text===void 0)throw new It({message:"No object generated: the model did not return a response.",response:ae,usage:Tt(G.usage),finishReason:G.finishReason});return de.setAttributes(me({telemetry:S,attributes:{"ai.response.finishReason":G.finishReason,"ai.response.object":{output:()=>G.text},"ai.response.id":ae.id,"ai.response.model":ae.modelId,"ai.response.timestamp":ae.timestamp.toISOString(),"ai.usage.promptTokens":G.usage.promptTokens,"ai.usage.completionTokens":G.usage.completionTokens,"gen_ai.response.finish_reasons":[G.finishReason],"gen_ai.response.id":ae.id,"gen_ai.response.model":ae.modelId,"gen_ai.usage.prompt_tokens":G.usage.promptTokens,"gen_ai.usage.completion_tokens":G.usage.completionTokens}})),f(p({},G),{objectText:G.text,responseData:ae})})}));ye=te.objectText,ne=te.finishReason,he=te.usage,Q=te.warnings,oe=te.rawResponse,Pe=te.logprobs,ke=te.providerMetadata,L=(ce=te.request)!=null?ce:{},F=te.responseData;break}case "tool":{let K=Tr({prompt:{system:l,prompt:u,messages:c},tools:void 0}),Y=yield xr({prompt:K,modelSupportsImageUrls:e.supportsImageUrls,modelSupportsUrl:(re=e.supportsUrl)==null?void 0:re.bind(e)}),te=K.type,de=yield B(()=>st({name:"ai.generateObject.doGenerate",attributes:me({telemetry:S,attributes:f(p(p({},at({operationId:"ai.generateObject.doGenerate",telemetry:S})),M),{"ai.prompt.format":{input:()=>te},"ai.prompt.messages":{input:()=>JSON.stringify(Y)},"ai.settings.mode":s,"gen_ai.system":e.provider,"gen_ai.request.model":e.modelId,"gen_ai.request.frequency_penalty":v.frequencyPenalty,"gen_ai.request.max_tokens":v.maxTokens,"gen_ai.request.presence_penalty":v.presencePenalty,"gen_ai.request.temperature":v.temperature,"gen_ai.request.top_k":v.topK,"gen_ai.request.top_p":v.topP})}),tracer:X,fn:U=>T(null,null,function*(){var xe,Te,$e,z,D,G,ae,_e;let y=yield e.doGenerate(f(p({mode:{type:"object-tool",tool:{type:"function",name:n!=null?n:"json",description:a!=null?a:"Respond with a JSON object.",parameters:C.jsonSchema}}},Sr(v)),{inputFormat:te,prompt:Y,providerMetadata:g,abortSignal:m,headers:h})),ie=(Te=(xe=y.toolCalls)==null?void 0:xe[0])==null?void 0:Te.args,le={id:(z=($e=y.response)==null?void 0:$e.id)!=null?z:b(),timestamp:(G=(D=y.response)==null?void 0:D.timestamp)!=null?G:k(),modelId:(_e=(ae=y.response)==null?void 0:ae.modelId)!=null?_e:e.modelId};if(ie===void 0)throw new It({message:"No object generated: the tool was not called.",response:le,usage:Tt(y.usage),finishReason:y.finishReason});return U.setAttributes(me({telemetry:S,attributes:{"ai.response.finishReason":y.finishReason,"ai.response.object":{output:()=>ie},"ai.response.id":le.id,"ai.response.model":le.modelId,"ai.response.timestamp":le.timestamp.toISOString(),"ai.usage.promptTokens":y.usage.promptTokens,"ai.usage.completionTokens":y.usage.completionTokens,"gen_ai.response.finish_reasons":[y.finishReason],"gen_ai.response.id":le.id,"gen_ai.response.model":le.modelId,"gen_ai.usage.input_tokens":y.usage.promptTokens,"gen_ai.usage.output_tokens":y.usage.completionTokens}})),f(p({},y),{objectText:ie,responseData:le})})}));ye=de.objectText,ne=de.finishReason,he=de.usage,Q=de.warnings,oe=de.rawResponse,Pe=de.logprobs,ke=de.providerMetadata,L=(pe=de.request)!=null?pe:{},F=de.responseData;break}case void 0:throw new Error("Model does not have a default object generation mode.");default:{let K=s;throw new Error(`Unsupported mode: ${K}`)}}function ze(K){let Y=tt({text:K});if(!Y.success)throw new It({message:"No object generated: could not parse the response.",cause:Y.error,text:K,response:F,usage:Tt(he),finishReason:ne});let te=C.validateFinalResult(Y.value,{text:K,response:F,usage:Tt(he)});if(!te.success)throw new It({message:"No object generated: response did not match schema.",cause:te.error,text:K,response:F,usage:Tt(he),finishReason:ne});return te.value}let ve;try{ve=ze(ye);}catch(K){if(_!=null&&It.isInstance(K)&&(tr.isInstance(K.cause)||Je.isInstance(K.cause))){let Y=yield _({text:ye,error:K.cause});if(Y===null)throw K;ve=ze(Y);}else throw K}return ue.setAttributes(me({telemetry:S,attributes:{"ai.response.finishReason":ne,"ai.response.object":{output:()=>JSON.stringify(ve)},"ai.usage.promptTokens":he.promptTokens,"ai.usage.completionTokens":he.completionTokens}})),new nd({object:ve,finishReason:ne,usage:Tt(he),warnings:Q,request:L,response:f(p({},F),{headers:oe==null?void 0:oe.headers,body:oe==null?void 0:oe.body}),logprobs:Pe,providerMetadata:ke})})})})}var nd=class{constructor(e){this.object=e.object,this.finishReason=e.finishReason,this.usage=e.usage,this.warnings=e.warnings,this.providerMetadata=e.providerMetadata,this.experimental_providerMetadata=e.providerMetadata,this.response=e.response,this.request=e.request,this.logprobs=e.logprobs;}toJsonResponse(e){var t;return new Response(JSON.stringify(this.object),{status:(t=e==null?void 0:e.status)!=null?t:200,headers:wr(e==null?void 0:e.headers,{contentType:"application/json; charset=utf-8"})})}},be=class{constructor(){this.status={type:"pending"},this._resolve=void 0,this._reject=void 0;}get value(){return this.promise?this.promise:(this.promise=new Promise((e,t)=>{this.status.type==="resolved"?e(this.status.value):this.status.type==="rejected"&&t(this.status.error),this._resolve=e,this._reject=t;}),this.promise)}resolve(e){var t;this.status={type:"resolved",value:e},this.promise&&((t=this._resolve)==null||t.call(this,e));}reject(e){var t;this.status={type:"rejected",error:e},this.promise&&((t=this._reject)==null||t.call(this,e));}};function Bo(){let e,t;return {promise:new Promise((n,a)=>{e=n,t=a;}),resolve:e,reject:t}}function Ei(){let e=[],t=null,r=false,n=Bo(),a=()=>T(null,null,function*(){if(r&&e.length===0){t==null||t.close();return}if(e.length===0)return n=Bo(),yield n.promise,a();try{let{value:o,done:l}=yield e[0].read();l?(e.shift(),e.length>0?yield a():r&&(t==null||t.close())):t==null||t.enqueue(o);}catch(o){t==null||t.error(o),e.shift(),r&&e.length===0&&(t==null||t.close());}});return {stream:new ReadableStream({start(o){t=o;},pull:a,cancel(){return T(this,null,function*(){for(let o of e)yield o.cancel();e=[],r=true;})}}),addStream:o=>{if(r)throw new Error("Cannot add inner stream: outer stream is closed");e.push(o.getReader()),n.resolve();},close:()=>{r=true,n.resolve(),e.length===0&&(t==null||t.close());},terminate:()=>{r=true,n.resolve(),e.forEach(o=>o.cancel()),e=[],t==null||t.close();}}}function Ai(){var e,t;return (t=(e=globalThis==null?void 0:globalThis.performance)==null?void 0:e.now())!=null?t:Date.now()}var ad=et({prefix:"aiobj",size:24});function Ci(O){var A=O,{model:e,schema:t,schemaName:r,schemaDescription:n,mode:a,output:s="object",system:o,prompt:l,messages:u,maxRetries:c,abortSignal:d,headers:m,experimental_telemetry:h,experimental_providerMetadata:_,providerOptions:S=_,onError:I,onFinish:g,_internal:{generateId:b=ad,currentDate:k=()=>new Date,now:v=Ai}={}}=A,P=Ce(A,["model","schema","schemaName","schemaDescription","mode","output","system","prompt","messages","maxRetries","abortSignal","headers","experimental_telemetry","experimental_providerMetadata","providerOptions","onError","onFinish","_internal"]);Ii({output:s,mode:a,schema:t,schemaName:r,schemaDescription:n});let B=Ti({output:s,schema:t});return B.type==="no-schema"&&a===void 0&&(a="json"),new sd({model:e,telemetry:h,headers:m,settings:P,maxRetries:c,abortSignal:d,outputStrategy:B,system:o,prompt:l,messages:u,schemaName:r,schemaDescription:n,providerOptions:S,mode:a,onError:I,onFinish:g,generateId:b,currentDate:k,now:v})}var sd=class{constructor({model:e,headers:t,telemetry:r,settings:n,maxRetries:a,abortSignal:s,outputStrategy:o,system:l,prompt:u,messages:c,schemaName:d,schemaDescription:m,providerOptions:h,mode:_,onError:S,onFinish:I,generateId:g,currentDate:b,now:k}){this.objectPromise=new be,this.usagePromise=new be,this.providerMetadataPromise=new be,this.warningsPromise=new be,this.requestPromise=new be,this.responsePromise=new be;let{maxRetries:v,retry:P}=Pn({maxRetries:a}),O=On({model:e,telemetry:r,headers:t,settings:f(p({},n),{maxRetries:v})}),A=Nn(r),B=this,C=Ei(),M=new TransformStream({transform(X,ue){ue.enqueue(X),X.type==="error"&&(S==null||S({error:X.error}));}});this.baseStream=C.stream.pipeThrough(M),st({name:"ai.streamObject",attributes:me({telemetry:r,attributes:f(p(p({},at({operationId:"ai.streamObject",telemetry:r})),O),{"ai.prompt":{input:()=>JSON.stringify({system:l,prompt:u,messages:c})},"ai.schema":o.jsonSchema!=null?{input:()=>JSON.stringify(o.jsonSchema)}:void 0,"ai.schema.name":d,"ai.schema.description":m,"ai.settings.output":o.type,"ai.settings.mode":_})}),tracer:A,endWhenDone:!1,fn:X=>T(this,null,function*(){var ue,we;(_==="auto"||_==null)&&(_=e.defaultObjectGenerationMode);let ce,re;switch(_){case "json":{let z=Tr({prompt:{system:o.jsonSchema==null?Qr({prompt:l}):e.supportsStructuredOutputs?l:Qr({prompt:l,schema:o.jsonSchema}),prompt:u,messages:c},tools:void 0});ce=f(p({mode:{type:"object-json",schema:o.jsonSchema,name:d,description:m}},Sr(n)),{inputFormat:z.type,prompt:yield xr({prompt:z,modelSupportsImageUrls:e.supportsImageUrls,modelSupportsUrl:(ue=e.supportsUrl)==null?void 0:ue.bind(e)}),providerMetadata:h,abortSignal:s,headers:t}),re={transform:(D,G)=>{switch(D.type){case "text-delta":G.enqueue(D.textDelta);break;case "response-metadata":case "finish":case "error":G.enqueue(D);break}}};break}case "tool":{let z=Tr({prompt:{system:l,prompt:u,messages:c},tools:void 0});ce=f(p({mode:{type:"object-tool",tool:{type:"function",name:d!=null?d:"json",description:m!=null?m:"Respond with a JSON object.",parameters:o.jsonSchema}}},Sr(n)),{inputFormat:z.type,prompt:yield xr({prompt:z,modelSupportsImageUrls:e.supportsImageUrls,modelSupportsUrl:(we=e.supportsUrl)==null?void 0:we.bind(e)}),providerMetadata:h,abortSignal:s,headers:t}),re={transform(D,G){switch(D.type){case "tool-call-delta":G.enqueue(D.argsTextDelta);break;case "response-metadata":case "finish":case "error":G.enqueue(D);break}}};break}case void 0:throw new Error("Model does not have a default object generation mode.");default:{let z=_;throw new Error(`Unsupported mode: ${z}`)}}let{result:{stream:pe,warnings:ye,rawResponse:ne,request:he},doStreamSpan:Q,startTimestampMs:oe}=yield P(()=>st({name:"ai.streamObject.doStream",attributes:me({telemetry:r,attributes:f(p(p({},at({operationId:"ai.streamObject.doStream",telemetry:r})),O),{"ai.prompt.format":{input:()=>ce.inputFormat},"ai.prompt.messages":{input:()=>JSON.stringify(ce.prompt)},"ai.settings.mode":_,"gen_ai.system":e.provider,"gen_ai.request.model":e.modelId,"gen_ai.request.frequency_penalty":n.frequencyPenalty,"gen_ai.request.max_tokens":n.maxTokens,"gen_ai.request.presence_penalty":n.presencePenalty,"gen_ai.request.temperature":n.temperature,"gen_ai.request.top_k":n.topK,"gen_ai.request.top_p":n.topP})}),tracer:A,endWhenDone:!1,fn:z=>T(this,null,function*(){return {startTimestampMs:k(),doStreamSpan:z,result:yield e.doStream(ce)}})}));B.requestPromise.resolve(he!=null?he:{});let F,L,Pe,ke,ze,ve="",K="",Y={id:g(),timestamp:b(),modelId:e.modelId},te,de,U=!0,xe=!0,Te=pe.pipeThrough(new TransformStream(re)).pipeThrough(new TransformStream({transform(z,D){return T(this,null,function*(){var G,ae,_e;if(U){let y=k()-oe;U=!1,Q.addEvent("ai.stream.firstChunk",{"ai.stream.msToFirstChunk":y}),Q.setAttributes({"ai.stream.msToFirstChunk":y});}if(typeof z=="string"){ve+=z,K+=z;let{value:y,state:ie}=wn(ve);if(y!==void 0&&!Hr(te,y)){let le=o.validatePartialResult({value:y,textDelta:K,latestObject:de,isFirstDelta:xe,isFinalDelta:ie==="successful-parse"});le.success&&!Hr(de,le.value.partial)&&(te=y,de=le.value.partial,D.enqueue({type:"object",object:de}),D.enqueue({type:"text-delta",textDelta:le.value.textDelta}),K="",xe=!1);}return}switch(z.type){case "response-metadata":{Y={id:(G=z.id)!=null?G:Y.id,timestamp:(ae=z.timestamp)!=null?ae:Y.timestamp,modelId:(_e=z.modelId)!=null?_e:Y.modelId};break}case "finish":{K!==""&&D.enqueue({type:"text-delta",textDelta:K}),L=z.finishReason,F=Tt(z.usage),Pe=z.providerMetadata,D.enqueue(f(p({},z),{usage:F,response:Y})),B.usagePromise.resolve(F),B.providerMetadataPromise.resolve(Pe),B.responsePromise.resolve(f(p({},Y),{headers:ne==null?void 0:ne.headers}));let y=o.validateFinalResult(te,{text:ve,response:Y,usage:F});y.success?(ke=y.value,B.objectPromise.resolve(ke)):(ze=new It({message:"No object generated: response did not match schema.",cause:y.error,text:ve,response:Y,usage:F,finishReason:L}),B.objectPromise.reject(ze));break}default:{D.enqueue(z);break}}})},flush(z){return T(this,null,function*(){try{let D=F!=null?F:{promptTokens:NaN,completionTokens:NaN,totalTokens:NaN};Q.setAttributes(me({telemetry:r,attributes:{"ai.response.finishReason":L,"ai.response.object":{output:()=>JSON.stringify(ke)},"ai.response.id":Y.id,"ai.response.model":Y.modelId,"ai.response.timestamp":Y.timestamp.toISOString(),"ai.usage.promptTokens":D.promptTokens,"ai.usage.completionTokens":D.completionTokens,"gen_ai.response.finish_reasons":[L],"gen_ai.response.id":Y.id,"gen_ai.response.model":Y.modelId,"gen_ai.usage.input_tokens":D.promptTokens,"gen_ai.usage.output_tokens":D.completionTokens}})),Q.end(),X.setAttributes(me({telemetry:r,attributes:{"ai.usage.promptTokens":D.promptTokens,"ai.usage.completionTokens":D.completionTokens,"ai.response.object":{output:()=>JSON.stringify(ke)}}})),yield I==null?void 0:I({usage:D,object:ke,error:ze,response:f(p({},Y),{headers:ne==null?void 0:ne.headers}),warnings:ye,providerMetadata:Pe,experimental_providerMetadata:Pe});}catch(D){z.enqueue({type:"error",error:D});}finally{X.end();}})}}));C.addStream(Te);})}).catch(X=>{C.addStream(new ReadableStream({start(ue){ue.enqueue({type:"error",error:X}),ue.close();}}));}).finally(()=>{C.close();}),this.outputStrategy=o;}get object(){return this.objectPromise.value}get usage(){return this.usagePromise.value}get experimental_providerMetadata(){return this.providerMetadataPromise.value}get providerMetadata(){return this.providerMetadataPromise.value}get warnings(){return this.warningsPromise.value}get request(){return this.requestPromise.value}get response(){return this.responsePromise.value}get partialObjectStream(){return rr(this.baseStream.pipeThrough(new TransformStream({transform(e,t){switch(e.type){case "object":t.enqueue(e.object);break;case "text-delta":case "finish":case "error":break;default:{let r=e;throw new Error(`Unsupported chunk type: ${r}`)}}}})))}get elementStream(){return this.outputStrategy.createElementStream(this.baseStream)}get textStream(){return rr(this.baseStream.pipeThrough(new TransformStream({transform(e,t){switch(e.type){case "text-delta":t.enqueue(e.textDelta);break;case "object":case "finish":case "error":break;default:{let r=e;throw new Error(`Unsupported chunk type: ${r}`)}}}})))}get fullStream(){return rr(this.baseStream)}pipeTextStreamToResponse(e,t){fa({response:e,status:t==null?void 0:t.status,statusText:t==null?void 0:t.statusText,headers:ma(t==null?void 0:t.headers,{contentType:"text/plain; charset=utf-8"}),stream:this.textStream.pipeThrough(new TextEncoderStream)});}toTextStreamResponse(e){var t;return new Response(this.textStream.pipeThrough(new TextEncoderStream),{status:(t=e==null?void 0:e.status)!=null?t:200,headers:wr(e==null?void 0:e.headers,{contentType:"text/plain; charset=utf-8"})})}},Ri="AI_NoOutputSpecifiedError",Pi=`vercel.ai.error.${Ri}`,od=Symbol.for(Pi),Oi,Ni=class extends N{constructor({message:e="No output specified."}={}){super({name:Ri,message:e}),this[Oi]=true;}static isInstance(e){return N.hasMarker(e,Pi)}};Oi=od;var ji="AI_ToolExecutionError",Mi=`vercel.ai.error.${ji}`,id=Symbol.for(Mi),Di,$i=class extends N{constructor({toolArgs:e,toolName:t,toolCallId:r,cause:n,message:a=`Error executing tool ${t}: ${Pt(n)}`}){super({name:ji,message:a,cause:n}),this[Di]=true,this.toolArgs=e,this.toolName=t,this.toolCallId=r;}static isInstance(e){return N.hasMarker(e,Mi)}};Di=id;function ld(e){return e!=null&&Object.keys(e).length>0}function qi({tools:e,toolChoice:t,activeTools:r}){return ld(e)?{tools:(r!=null?Object.entries(e).filter(([a])=>r.includes(a)):Object.entries(e)).map(([a,s])=>{let o=s.type;switch(o){case void 0:case "function":return {type:"function",name:a,description:s.description,parameters:pt(s.parameters).jsonSchema};case "provider-defined":return {type:"provider-defined",name:a,id:s.id,args:s.args};default:{let l=o;throw new Error(`Unsupported tool type: ${l}`)}}}),toolChoice:t==null?{type:"auto"}:typeof t=="string"?{type:t}:{type:"tool",toolName:t.toolName}}:{tools:void 0,toolChoice:void 0}}var ud=/^([\s\S]*?)(\s+)(\S*)$/;function Ui(e){let t=e.match(ud);return t?{prefix:t[1],whitespace:t[2],suffix:t[3]}:void 0}function cd(e){let t=Ui(e);return t?t.prefix+t.whitespace:e}var Fi="AI_InvalidToolArgumentsError",Li=`vercel.ai.error.${Fi}`,pd=Symbol.for(Li),Zi,Ji=class extends N{constructor({toolArgs:e,toolName:t,cause:r,message:n=`Invalid arguments for tool ${t}: ${Pt(r)}`}){super({name:Fi,message:n,cause:r}),this[Zi]=true,this.toolArgs=e,this.toolName=t;}static isInstance(e){return N.hasMarker(e,Li)}};Zi=pd;var Vi="AI_NoSuchToolError",zi=`vercel.ai.error.${Vi}`,dd=Symbol.for(zi),Bi,ga=class extends N{constructor({toolName:e,availableTools:t=void 0,message:r=`Model tried to call unavailable tool '${e}'. ${t===void 0?"No tools are available.":`Available tools: ${t.join(", ")}.`}`}){super({name:Vi,message:r}),this[Bi]=true,this.toolName=e,this.availableTools=t;}static isInstance(e){return N.hasMarker(e,zi)}};Bi=dd;var Gi="AI_ToolCallRepairError",Hi=`vercel.ai.error.${Gi}`,md=Symbol.for(Hi),Wi,fd=class extends N{constructor({cause:e,originalError:t,message:r=`Error repairing tool call: ${Pt(e)}`}){super({name:Gi,message:r,cause:e}),this[Wi]=true,this.originalError=t;}static isInstance(e){return N.hasMarker(e,Hi)}};Wi=md;function Ki(s){return T(this,arguments,function*({toolCall:e,tools:t,repairToolCall:r,system:n,messages:a}){if(t==null)throw new ga({toolName:e.toolName});try{return yield Go({toolCall:e,tools:t})}catch(o){if(r==null||!(ga.isInstance(o)||Ji.isInstance(o)))throw o;let l=null;try{l=yield r({toolCall:e,tools:t,parameterSchema:({toolName:u})=>pt(t[u].parameters).jsonSchema,system:n,messages:a,error:o});}catch(u){throw new fd({cause:u,originalError:o})}if(l==null)throw o;return yield Go({toolCall:l,tools:t})}})}function Go(r){return T(this,arguments,function*({toolCall:e,tools:t}){let n=e.toolName,a=t[n];if(a==null)throw new ga({toolName:e.toolName,availableTools:Object.keys(t)});let s=pt(a.parameters),o=e.args.trim()===""?Ve({value:{},schema:s}):tt({text:e.args,schema:s});if(o.success===false)throw new Ji({toolName:n,toolArgs:e.args,cause:o.error});return {type:"tool-call",toolCallId:e.toolCallId,toolName:n,args:o.value}})}function ya(e){let t=e.filter(r=>r.type==="text").map(r=>r.text).join("");return t.length>0?t:void 0}function va({text:e="",files:t,reasoning:r,tools:n,toolCalls:a,toolResults:s,messageId:o,generateMessageId:l}){let u=[],c=[];return r.length>0&&c.push(...r.map(d=>d.type==="text"?f(p({},d),{type:"reasoning"}):f(p({},d),{type:"redacted-reasoning"}))),t.length>0&&c.push(...t.map(d=>({type:"file",data:d.base64,mimeType:d.mimeType}))),e.length>0&&c.push({type:"text",text:e}),a.length>0&&c.push(...a),c.length>0&&u.push({role:"assistant",content:c,id:o}),s.length>0&&u.push({role:"tool",id:l(),content:s.map(d=>{let m=n[d.toolName];return (m==null?void 0:m.experimental_toToolResultContent)!=null?{type:"tool-result",toolCallId:d.toolCallId,toolName:d.toolName,result:m.experimental_toToolResultContent(d.result),experimental_content:m.experimental_toToolResultContent(d.result)}:{type:"tool-result",toolCallId:d.toolCallId,toolName:d.toolName,result:d.result}})}),u}var hd=et({prefix:"aitxt",size:24}),gd=et({prefix:"msg",size:24});function Yi(B){return T(this,null,function*(){var C=B,{model:e,tools:t,toolChoice:r,system:n,prompt:a,messages:s,maxRetries:o,abortSignal:l,headers:u,maxSteps:c=1,experimental_generateMessageId:d=gd,experimental_output:m,experimental_continueSteps:h=false,experimental_telemetry:_,experimental_providerMetadata:S,providerOptions:I=S,experimental_activeTools:g,experimental_prepareStep:b,experimental_repairToolCall:k,_internal:{generateId:v=hd,currentDate:P=()=>new Date}={},onStepFinish:O}=C,A=Ce(C,["model","tools","toolChoice","system","prompt","messages","maxRetries","abortSignal","headers","maxSteps","experimental_generateMessageId","experimental_output","experimental_continueSteps","experimental_telemetry","experimental_providerMetadata","providerOptions","experimental_activeTools","experimental_prepareStep","experimental_repairToolCall","_internal","onStepFinish"]);var M;if(c<1)throw new se({parameter:"maxSteps",value:c,message:"maxSteps must be at least 1"});let{maxRetries:X,retry:ue}=Pn({maxRetries:o}),we=On({model:e,telemetry:_,headers:u,settings:f(p({},A),{maxRetries:X})}),ce=Tr({prompt:{system:(M=m==null?void 0:m.injectIntoSystemPrompt({system:n,model:e}))!=null?M:n,prompt:a,messages:s},tools:t}),re=Nn(_);return st({name:"ai.generateText",attributes:me({telemetry:_,attributes:f(p(p({},at({operationId:"ai.generateText",telemetry:_})),we),{"ai.model.provider":e.provider,"ai.model.id":e.modelId,"ai.prompt":{input:()=>JSON.stringify({system:n,prompt:a,messages:s})},"ai.settings.maxSteps":c})}),tracer:re,fn:pe=>T(null,null,function*(){var ye,ne,he,Q,oe,F,L,Pe,ke,ze,ve,K,Y,te;let de=Sr(A),U,xe=[],Te=[],$e=[],z=0,D=[],G="",ae=[],_e=[],y={completionTokens:0,promptTokens:0,totalTokens:0},ie="initial";do{let le=z===0?ce.type:"messages",Ee=[...ce.messages,...D],We=yield b==null?void 0:b({model:e,steps:_e,maxSteps:c,stepNumber:z}),$n=(ye=We==null?void 0:We.toolChoice)!=null?ye:r,nr=(ne=We==null?void 0:We.experimental_activeTools)!=null?ne:g,mt=(he=We==null?void 0:We.model)!=null?he:e,Ir=yield xr({prompt:{type:le,system:ce.system,messages:Ee},modelSupportsImageUrls:mt.supportsImageUrls,modelSupportsUrl:(Q=mt.supportsUrl)==null?void 0:Q.bind(mt)}),kt=p({type:"regular"},qi({tools:t,toolChoice:$n,activeTools:nr}));U=yield ue(()=>st({name:"ai.generateText.doGenerate",attributes:me({telemetry:_,attributes:f(p(p({},at({operationId:"ai.generateText.doGenerate",telemetry:_})),we),{"ai.model.provider":mt.provider,"ai.model.id":mt.modelId,"ai.prompt.format":{input:()=>le},"ai.prompt.messages":{input:()=>JSON.stringify(Ir)},"ai.prompt.tools":{input:()=>{var Fe;return (Fe=kt.tools)==null?void 0:Fe.map(Ke=>JSON.stringify(Ke))}},"ai.prompt.toolChoice":{input:()=>kt.toolChoice!=null?JSON.stringify(kt.toolChoice):void 0},"gen_ai.system":mt.provider,"gen_ai.request.model":mt.modelId,"gen_ai.request.frequency_penalty":A.frequencyPenalty,"gen_ai.request.max_tokens":A.maxTokens,"gen_ai.request.presence_penalty":A.presencePenalty,"gen_ai.request.stop_sequences":A.stopSequences,"gen_ai.request.temperature":A.temperature,"gen_ai.request.top_k":A.topK,"gen_ai.request.top_p":A.topP})}),tracer:re,fn:Fe=>T(null,null,function*(){var Ke,Er,rn,Ar,ot,ar;let Ae=yield mt.doGenerate(f(p({mode:kt},de),{inputFormat:le,responseFormat:m==null?void 0:m.responseFormat({model:e}),prompt:Ir,providerMetadata:I,abortSignal:l,headers:u})),gt={id:(Er=(Ke=Ae.response)==null?void 0:Ke.id)!=null?Er:v(),timestamp:(Ar=(rn=Ae.response)==null?void 0:rn.timestamp)!=null?Ar:P(),modelId:(ar=(ot=Ae.response)==null?void 0:ot.modelId)!=null?ar:mt.modelId};return Fe.setAttributes(me({telemetry:_,attributes:{"ai.response.finishReason":Ae.finishReason,"ai.response.text":{output:()=>Ae.text},"ai.response.toolCalls":{output:()=>JSON.stringify(Ae.toolCalls)},"ai.response.id":gt.id,"ai.response.model":gt.modelId,"ai.response.timestamp":gt.timestamp.toISOString(),"ai.usage.promptTokens":Ae.usage.promptTokens,"ai.usage.completionTokens":Ae.usage.completionTokens,"gen_ai.response.finish_reasons":[Ae.finishReason],"gen_ai.response.id":gt.id,"gen_ai.response.model":gt.modelId,"gen_ai.usage.input_tokens":Ae.usage.promptTokens,"gen_ai.usage.output_tokens":Ae.usage.completionTokens}})),f(p({},Ae),{response:gt})})})),xe=yield Promise.all(((oe=U.toolCalls)!=null?oe:[]).map(Fe=>Ki({toolCall:Fe,tools:t,repairToolCall:k,system:n,messages:Ee}))),Te=t==null?[]:yield yd({toolCalls:xe,tools:t,tracer:re,telemetry:_,messages:Ee,abortSignal:l});let kr=Tt(U.usage);y=Si(y,kr);let ft="done";++z<c&&(h&&U.finishReason==="length"&&xe.length===0?ft="continue":xe.length>0&&Te.length===xe.length&&(ft="tool-result"));let jt=(F=U.text)!=null?F:"",tn=ie==="continue"&&G.trimEnd()!==G?jt.trimStart():jt,ht=ft==="continue"?cd(tn):tn;if(G=ft==="continue"||ie==="continue"?G+ht:ht,$e=Ho(U.reasoning),ae.push(...(L=U.sources)!=null?L:[]),ie==="continue"){let Fe=D[D.length-1];typeof Fe.content=="string"?Fe.content+=ht:Fe.content.push({text:ht,type:"text"});}else D.push(...va({text:G,files:da(U.files),reasoning:Ho(U.reasoning),tools:t!=null?t:{},toolCalls:xe,toolResults:Te,messageId:d(),generateMessageId:d}));let Mt={stepType:ie,text:ht,reasoning:ya($e),reasoningDetails:$e,files:da(U.files),sources:(Pe=U.sources)!=null?Pe:[],toolCalls:xe,toolResults:Te,finishReason:U.finishReason,usage:kr,warnings:U.warnings,logprobs:U.logprobs,request:(ke=U.request)!=null?ke:{},response:f(p({},U.response),{headers:(ze=U.rawResponse)==null?void 0:ze.headers,body:(ve=U.rawResponse)==null?void 0:ve.body,messages:structuredClone(D)}),providerMetadata:U.providerMetadata,experimental_providerMetadata:U.providerMetadata,isContinued:ft==="continue"};_e.push(Mt),yield O==null?void 0:O(Mt),ie=ft;}while(ie!=="done");return pe.setAttributes(me({telemetry:_,attributes:{"ai.response.finishReason":U.finishReason,"ai.response.text":{output:()=>U.text},"ai.response.toolCalls":{output:()=>JSON.stringify(U.toolCalls)},"ai.usage.promptTokens":U.usage.promptTokens,"ai.usage.completionTokens":U.usage.completionTokens}})),new vd({text:G,files:da(U.files),reasoning:ya($e),reasoningDetails:$e,sources:ae,outputResolver:()=>{if(m==null)throw new Ni;return m.parseOutput({text:G},{response:U.response,usage:y,finishReason:U.finishReason})},toolCalls:xe,toolResults:Te,finishReason:U.finishReason,usage:y,warnings:U.warnings,request:(K=U.request)!=null?K:{},response:f(p({},U.response),{headers:(Y=U.rawResponse)==null?void 0:Y.headers,body:(te=U.rawResponse)==null?void 0:te.body,messages:D}),logprobs:U.logprobs,steps:_e,providerMetadata:U.providerMetadata})})})})}function yd(o){return T(this,arguments,function*({toolCalls:e,tools:t,tracer:r,telemetry:n,messages:a,abortSignal:s}){return (yield Promise.all(e.map(m=>T(null,[m],function*({toolCallId:u,toolName:c,args:d}){let h=t[c];if((h==null?void 0:h.execute)==null)return;let _=yield st({name:"ai.toolCall",attributes:me({telemetry:n,attributes:f(p({},at({operationId:"ai.toolCall",telemetry:n})),{"ai.toolCall.name":c,"ai.toolCall.id":u,"ai.toolCall.args":{output:()=>JSON.stringify(d)}})}),tracer:r,fn:S=>T(null,null,function*(){try{let I=yield h.execute(d,{toolCallId:u,messages:a,abortSignal:s});try{S.setAttributes(me({telemetry:n,attributes:{"ai.toolCall.result":{output:()=>JSON.stringify(I)}}}));}catch(g){}return I}catch(I){throw new $i({toolCallId:u,toolName:c,toolArgs:d,cause:I})}})});return {type:"tool-result",toolCallId:u,toolName:c,args:d,result:_}})))).filter(u=>u!=null)})}var vd=class{constructor(e){this.text=e.text,this.files=e.files,this.reasoning=e.reasoning,this.reasoningDetails=e.reasoningDetails,this.toolCalls=e.toolCalls,this.toolResults=e.toolResults,this.finishReason=e.finishReason,this.usage=e.usage,this.warnings=e.warnings,this.request=e.request,this.response=e.response,this.steps=e.steps,this.experimental_providerMetadata=e.providerMetadata,this.providerMetadata=e.providerMetadata,this.logprobs=e.logprobs,this.outputResolver=e.outputResolver,this.sources=e.sources;}get experimental_output(){return this.outputResolver()}};function Ho(e){return e==null?[]:typeof e=="string"?[{type:"text",text:e}]:e}function da(e){var t;return (t=e==null?void 0:e.map(r=>new ni(r)))!=null?t:[]}var _d={};_a(_d,{object:()=>Ed,text:()=>kd});var Xi="AI_InvalidStreamPartError",Qi=`vercel.ai.error.${Xi}`,bd=Symbol.for(Qi),el,wd=class extends N{constructor({chunk:e,message:t}){super({name:Xi,message:t}),this[el]=true,this.chunk=e;}static isInstance(e){return N.hasMarker(e,Qi)}};el=bd;var kd=()=>({type:"text",responseFormat:()=>({type:"text"}),injectIntoSystemPrompt({system:e}){return e},parsePartial({text:e}){return {partial:e}},parseOutput({text:e}){return e}}),Ed=({schema:e})=>{let t=pt(e);return {type:"object",responseFormat:({model:r})=>({type:"json",schema:r.supportsStructuredOutputs?t.jsonSchema:void 0}),injectIntoSystemPrompt({system:r,model:n}){return n.supportsStructuredOutputs?r:Qr({prompt:r,schema:t.jsonSchema})},parsePartial({text:r}){let n=wn(r);switch(n.state){case "failed-parse":case "undefined-input":return;case "repaired-parse":case "successful-parse":return {partial:n.value};default:{let a=n.state;throw new Error(`Unsupported parse state: ${a}`)}}},parseOutput({text:r},n){let a=tt({text:r});if(!a.success)throw new It({message:"No object generated: could not parse the response.",cause:a.error,text:r,response:n.response,usage:n.usage,finishReason:n.finishReason});let s=Ve({value:a.value,schema:t});if(!s.success)throw new It({message:"No object generated: response did not match schema.",cause:s.error,text:r,response:n.response,usage:n.usage,finishReason:n.finishReason});return s.value}}};function Ad(e){return e===void 0?[]:Array.isArray(e)?e:[e]}function Cd(r){return T(this,arguments,function*({stream:e,onError:t}){let n=e.getReader();try{for(;;){let{done:a}=yield n.read();if(a)break}}catch(a){t==null||t(a);}finally{n.releaseLock();}})}function ba(e,t){let r=e.getReader(),n=t.getReader(),a,s,o=false,l=false;function u(m){return T(this,null,function*(){try{a==null&&(a=r.read());let h=yield a;a=void 0,h.done?m.close():m.enqueue(h.value);}catch(h){m.error(h);}})}function c(m){return T(this,null,function*(){try{s==null&&(s=n.read());let h=yield s;s=void 0,h.done?m.close():m.enqueue(h.value);}catch(h){m.error(h);}})}return new ReadableStream({pull(m){return T(this,null,function*(){try{if(o){yield c(m);return}if(l){yield u(m);return}a==null&&(a=r.read()),s==null&&(s=n.read());let{result:h,reader:_}=yield Promise.race([a.then(S=>({result:S,reader:r})),s.then(S=>({result:S,reader:n}))]);h.done||m.enqueue(h.value),_===r?(a=void 0,h.done&&(yield c(m),o=!0)):(s=void 0,h.done&&(l=!0,yield u(m)));}catch(h){m.error(h);}})},cancel(){r.cancel(),n.cancel();}})}function Rd({tools:e,generatorStream:t,toolCallStreaming:r,tracer:n,telemetry:a,system:s,messages:o,abortSignal:l,repairToolCall:u}){let c=null,d=new ReadableStream({start(v){c=v;}}),m={},h=new Set,_=false,S;function I(){_&&h.size===0&&(S!=null&&c.enqueue(S),c.close());}let g=new TransformStream({transform(v,P){return T(this,null,function*(){let O=v.type;switch(O){case "text-delta":case "reasoning":case "reasoning-signature":case "redacted-reasoning":case "source":case "response-metadata":case "error":{P.enqueue(v);break}case "file":{P.enqueue(new vp({data:v.data,mimeType:v.mimeType}));break}case "tool-call-delta":{r&&(m[v.toolCallId]||(P.enqueue({type:"tool-call-streaming-start",toolCallId:v.toolCallId,toolName:v.toolName}),m[v.toolCallId]=true),P.enqueue({type:"tool-call-delta",toolCallId:v.toolCallId,toolName:v.toolName,argsTextDelta:v.argsTextDelta}));break}case "tool-call":{try{let A=yield Ki({toolCall:v,tools:e,repairToolCall:u,system:s,messages:o});P.enqueue(A);let B=e[A.toolName];if(B.execute!=null){let C=Ge();h.add(C),st({name:"ai.toolCall",attributes:me({telemetry:a,attributes:f(p({},at({operationId:"ai.toolCall",telemetry:a})),{"ai.toolCall.name":A.toolName,"ai.toolCall.id":A.toolCallId,"ai.toolCall.args":{output:()=>JSON.stringify(A.args)}})}),tracer:n,fn:M=>T(null,null,function*(){return B.execute(A.args,{toolCallId:A.toolCallId,messages:o,abortSignal:l}).then(X=>{c.enqueue(f(p({},A),{type:"tool-result",result:X})),h.delete(C),I();try{M.setAttributes(me({telemetry:a,attributes:{"ai.toolCall.result":{output:()=>JSON.stringify(X)}}}));}catch(ue){}},X=>{c.enqueue({type:"error",error:new $i({toolCallId:A.toolCallId,toolName:A.toolName,toolArgs:A.args,cause:X})}),h.delete(C),I();})})});}}catch(A){c.enqueue({type:"error",error:A});}break}case "finish":{S={type:"finish",finishReason:v.finishReason,logprobs:v.logprobs,usage:Tt(v.usage),experimental_providerMetadata:v.providerMetadata};break}default:{let A=O;throw new Error(`Unhandled chunk type: ${A}`)}}})},flush(){_=true,I();}});return new ReadableStream({start(v){return T(this,null,function*(){return Promise.all([t.pipeThrough(g).pipeTo(new WritableStream({write(P){v.enqueue(P);},close(){}})),d.pipeTo(new WritableStream({write(P){v.enqueue(P);},close(){v.close();}}))])})}})}var Pd=et({prefix:"aitxt",size:24}),Od=et({prefix:"msg",size:24});function tl(ce){var re=ce,{model:e,tools:t,toolChoice:r,system:n,prompt:a,messages:s,maxRetries:o,abortSignal:l,headers:u,maxSteps:c=1,experimental_generateMessageId:d=Od,experimental_output:m,experimental_continueSteps:h=false,experimental_telemetry:_,experimental_providerMetadata:S,providerOptions:I=S,experimental_toolCallStreaming:g=false,toolCallStreaming:b=g,experimental_activeTools:k,experimental_repairToolCall:v,experimental_transform:P,onChunk:O,onError:A,onFinish:B,onStepFinish:C,_internal:{now:M=Ai,generateId:X=Pd,currentDate:ue=()=>new Date}={}}=re,we=Ce(re,["model","tools","toolChoice","system","prompt","messages","maxRetries","abortSignal","headers","maxSteps","experimental_generateMessageId","experimental_output","experimental_continueSteps","experimental_telemetry","experimental_providerMetadata","providerOptions","experimental_toolCallStreaming","toolCallStreaming","experimental_activeTools","experimental_repairToolCall","experimental_transform","onChunk","onError","onFinish","onStepFinish","_internal"]);return new jd({model:e,telemetry:_,headers:u,settings:we,maxRetries:o,abortSignal:l,system:n,prompt:a,messages:s,tools:t,toolChoice:r,toolCallStreaming:b,transforms:Ad(P),activeTools:k,repairToolCall:v,maxSteps:c,output:m,continueSteps:h,providerOptions:I,onChunk:O,onError:A,onFinish:B,onStepFinish:C,now:M,currentDate:ue,generateId:X,generateMessageId:d})}function Nd(e){if(!e)return new TransformStream({transform(s,o){o.enqueue({part:s,partialOutput:void 0});}});let t="",r="",n="";function a({controller:s,partialOutput:o=void 0}){s.enqueue({part:{type:"text-delta",textDelta:r},partialOutput:o}),r="";}return new TransformStream({transform(s,o){if(s.type==="step-finish"&&a({controller:o}),s.type!=="text-delta"){o.enqueue({part:s,partialOutput:void 0});return}t+=s.textDelta,r+=s.textDelta;let l=e.parsePartial({text:t});if(l!=null){let u=JSON.stringify(l.partial);u!==n&&(a({controller:o,partialOutput:l.partial}),n=u);}},flush(s){r.length>0&&a({controller:s});}})}var jd=class{constructor({model:e,telemetry:t,headers:r,settings:n,maxRetries:a,abortSignal:s,system:o,prompt:l,messages:u,tools:c,toolChoice:d,toolCallStreaming:m,transforms:h,activeTools:_,repairToolCall:S,maxSteps:I,output:g,continueSteps:b,providerOptions:k,now:v,currentDate:P,generateId:O,generateMessageId:A,onChunk:B,onError:C,onFinish:M,onStepFinish:X}){this.warningsPromise=new be,this.usagePromise=new be,this.finishReasonPromise=new be,this.providerMetadataPromise=new be,this.textPromise=new be,this.reasoningPromise=new be,this.reasoningDetailsPromise=new be,this.sourcesPromise=new be,this.filesPromise=new be,this.toolCallsPromise=new be,this.toolResultsPromise=new be,this.requestPromise=new be,this.responsePromise=new be,this.stepsPromise=new be;var ue;if(I<1)throw new se({parameter:"maxSteps",value:I,message:"maxSteps must be at least 1"});this.output=g;let we="",ce="",re="",pe=[],ye=[],ne,he=[],Q=[],oe={id:O(),timestamp:P(),modelId:e.modelId,messages:[]},F=[],L=[],Pe,ke,ze="initial",ve=[],K,Y=new TransformStream({transform(ae,_e){return T(this,null,function*(){_e.enqueue(ae);let{part:y}=ae;if((y.type==="text-delta"||y.type==="reasoning"||y.type==="source"||y.type==="tool-call"||y.type==="tool-result"||y.type==="tool-call-streaming-start"||y.type==="tool-call-delta")&&(yield B==null?void 0:B({chunk:y})),y.type==="error"&&(yield C==null?void 0:C({error:y.error})),y.type==="text-delta"&&(we+=y.textDelta,ce+=y.textDelta,re+=y.textDelta),y.type==="reasoning"&&(ne==null?(ne={type:"text",text:y.textDelta},pe.push(ne)):ne.text+=y.textDelta),y.type==="reasoning-signature"){if(ne==null)throw new N({name:"InvalidStreamPart",message:"reasoning-signature without reasoning"});ne.signature=y.signature,ne=void 0;}if(y.type==="redacted-reasoning"&&pe.push({type:"redacted",data:y.data}),y.type==="file"&&ye.push(y),y.type==="source"&&(Q.push(y.source),he.push(y.source)),y.type==="tool-call"&&F.push(y),y.type==="tool-result"&&L.push(y),y.type==="step-finish"){let ie=va({text:ce,files:ye,reasoning:pe,tools:c!=null?c:{},toolCalls:F,toolResults:L,messageId:y.messageId,generateMessageId:A}),le=ve.length,Ee="done";le+1<I&&(b&&y.finishReason==="length"&&F.length===0?Ee="continue":F.length>0&&L.length===F.length&&(Ee="tool-result"));let We={stepType:ze,text:we,reasoning:ya(pe),reasoningDetails:pe,files:ye,sources:he,toolCalls:F,toolResults:L,finishReason:y.finishReason,usage:y.usage,warnings:y.warnings,logprobs:y.logprobs,request:y.request,response:f(p({},y.response),{messages:[...oe.messages,...ie]}),providerMetadata:y.experimental_providerMetadata,experimental_providerMetadata:y.experimental_providerMetadata,isContinued:y.isContinued};yield X==null?void 0:X(We),ve.push(We),F=[],L=[],we="",he=[],pe=[],ye=[],ne=void 0,Ee!=="done"&&(ze=Ee),Ee!=="continue"&&(oe.messages.push(...ie),ce="");}y.type==="finish"&&(oe.id=y.response.id,oe.timestamp=y.response.timestamp,oe.modelId=y.response.modelId,oe.headers=y.response.headers,ke=y.usage,Pe=y.finishReason);})},flush(ae){return T(this,null,function*(){var _e;try{if(ve.length===0)return;let y=ve[ve.length-1];D.warningsPromise.resolve(y.warnings),D.requestPromise.resolve(y.request),D.responsePromise.resolve(y.response),D.toolCallsPromise.resolve(y.toolCalls),D.toolResultsPromise.resolve(y.toolResults),D.providerMetadataPromise.resolve(y.experimental_providerMetadata),D.reasoningPromise.resolve(y.reasoning),D.reasoningDetailsPromise.resolve(y.reasoningDetails);let ie=Pe!=null?Pe:"unknown",le=ke!=null?ke:{completionTokens:NaN,promptTokens:NaN,totalTokens:NaN};D.finishReasonPromise.resolve(ie),D.usagePromise.resolve(le),D.textPromise.resolve(re),D.sourcesPromise.resolve(Q),D.filesPromise.resolve(y.files),D.stepsPromise.resolve(ve),yield M==null?void 0:M({finishReason:ie,logprobs:void 0,usage:le,text:re,reasoning:y.reasoning,reasoningDetails:y.reasoningDetails,files:y.files,sources:y.sources,toolCalls:y.toolCalls,toolResults:y.toolResults,request:(_e=y.request)!=null?_e:{},response:y.response,warnings:y.warnings,providerMetadata:y.providerMetadata,experimental_providerMetadata:y.experimental_providerMetadata,steps:ve}),K.setAttributes(me({telemetry:t,attributes:{"ai.response.finishReason":ie,"ai.response.text":{output:()=>re},"ai.response.toolCalls":{output:()=>{var Ee;return (Ee=y.toolCalls)!=null&&Ee.length?JSON.stringify(y.toolCalls):void 0}},"ai.usage.promptTokens":le.promptTokens,"ai.usage.completionTokens":le.completionTokens}}));}catch(y){ae.error(y);}finally{K.end();}})}}),te=Ei();this.addStream=te.addStream,this.closeStream=te.close;let de=te.stream;for(let ae of h)de=de.pipeThrough(ae({tools:c,stopStream(){te.terminate();}}));this.baseStream=de.pipeThrough(Nd(g)).pipeThrough(Y);let{maxRetries:U,retry:xe}=Pn({maxRetries:a}),Te=Nn(t),$e=On({model:e,telemetry:t,headers:r,settings:f(p({},n),{maxRetries:U})}),z=Tr({prompt:{system:(ue=g==null?void 0:g.injectIntoSystemPrompt({system:o,model:e}))!=null?ue:o,prompt:l,messages:u},tools:c}),D=this;st({name:"ai.streamText",attributes:me({telemetry:t,attributes:f(p(p({},at({operationId:"ai.streamText",telemetry:t})),$e),{"ai.prompt":{input:()=>JSON.stringify({system:o,prompt:l,messages:u})},"ai.settings.maxSteps":I})}),tracer:Te,endWhenDone:!1,fn:ae=>T(this,null,function*(){K=ae;function _e(mt){return T(this,arguments,function*({currentStep:y,responseMessages:ie,usage:le,stepType:Ee,previousStepText:We,hasLeadingWhitespace:$n,messageId:nr}){var Ir;let kt=ie.length===0?z.type:"messages",kr=[...z.messages,...ie],ft=yield xr({prompt:{type:kt,system:z.system,messages:kr},modelSupportsImageUrls:e.supportsImageUrls,modelSupportsUrl:(Ir=e.supportsUrl)==null?void 0:Ir.bind(e)}),jt=p({type:"regular"},qi({tools:c,toolChoice:d,activeTools:_})),{result:{stream:tn,warnings:ht,rawResponse:Mt,request:Fe},doStreamSpan:Ke,startTimestampMs:Er}=yield xe(()=>st({name:"ai.streamText.doStream",attributes:me({telemetry:t,attributes:f(p(p({},at({operationId:"ai.streamText.doStream",telemetry:t})),$e),{"ai.prompt.format":{input:()=>kt},"ai.prompt.messages":{input:()=>JSON.stringify(ft)},"ai.prompt.tools":{input:()=>{var V;return (V=jt.tools)==null?void 0:V.map(ge=>JSON.stringify(ge))}},"ai.prompt.toolChoice":{input:()=>jt.toolChoice!=null?JSON.stringify(jt.toolChoice):void 0},"gen_ai.system":e.provider,"gen_ai.request.model":e.modelId,"gen_ai.request.frequency_penalty":n.frequencyPenalty,"gen_ai.request.max_tokens":n.maxTokens,"gen_ai.request.presence_penalty":n.presencePenalty,"gen_ai.request.stop_sequences":n.stopSequences,"gen_ai.request.temperature":n.temperature,"gen_ai.request.top_k":n.topK,"gen_ai.request.top_p":n.topP})}),tracer:Te,endWhenDone:!1,fn:V=>T(null,null,function*(){return {startTimestampMs:v(),doStreamSpan:V,result:yield e.doStream(f(p({mode:jt},Sr(n)),{inputFormat:kt,responseFormat:g==null?void 0:g.responseFormat({model:e}),prompt:ft,providerMetadata:k,abortSignal:s,headers:r}))}})})),rn=Rd({tools:c,generatorStream:tn,toolCallStreaming:m,tracer:Te,telemetry:t,system:o,messages:kr,repairToolCall:S,abortSignal:s}),Ar=Fe!=null?Fe:{},ot=[],ar=[],Ae=[],gt=[],Dt,$t="unknown",Et={promptTokens:0,completionTokens:0,totalTokens:0},Cr,Ea=!0,Rr="",Aa=Ee==="continue"?We:"",qn,Ye={id:O(),timestamp:P(),modelId:e.modelId},sr="",Ca=!1,Ra=!0,Pa=!1;function Un(it){return T(this,arguments,function*({controller:V,chunk:ge}){V.enqueue(ge),Rr+=ge.textDelta,Aa+=ge.textDelta,Ca=!0,Pa=ge.textDelta.trimEnd()!==ge.textDelta;})}D.addStream(rn.pipeThrough(new TransformStream({transform(V,ge){return T(this,null,function*(){var it,Pr,qt;if(Ea){let lt=v()-Er;Ea=!1,Ke.addEvent("ai.stream.firstChunk",{"ai.response.msToFirstChunk":lt}),Ke.setAttributes({"ai.response.msToFirstChunk":lt}),ge.enqueue({type:"step-start",messageId:nr,request:Ar,warnings:ht!=null?ht:[]});}if(V.type==="text-delta"&&V.textDelta.length===0)return;let Oa=V.type;switch(Oa){case "text-delta":{if(b){let lt=Ra&&$n?V.textDelta.trimStart():V.textDelta;if(lt.length===0)break;Ra=!1,sr+=lt;let nn=Ui(sr);nn!=null&&(sr=nn.suffix,yield Un({controller:ge,chunk:{type:"text-delta",textDelta:nn.prefix+nn.whitespace}}));}else yield Un({controller:ge,chunk:V});break}case "reasoning":{ge.enqueue(V),Dt==null?(Dt={type:"text",text:V.textDelta},Ae.push(Dt)):Dt.text+=V.textDelta;break}case "reasoning-signature":{if(ge.enqueue(V),Dt==null)throw new wd({chunk:V,message:"reasoning-signature without reasoning"});Dt.signature=V.signature,Dt=void 0;break}case "redacted-reasoning":{ge.enqueue(V),Ae.push({type:"redacted",data:V.data});break}case "tool-call":{ge.enqueue(V),ot.push(V);break}case "tool-result":{ge.enqueue(V),ar.push(V);break}case "response-metadata":{Ye={id:(it=V.id)!=null?it:Ye.id,timestamp:(Pr=V.timestamp)!=null?Pr:Ye.timestamp,modelId:(qt=V.modelId)!=null?qt:Ye.modelId};break}case "finish":{Et=V.usage,$t=V.finishReason,Cr=V.experimental_providerMetadata,qn=V.logprobs;let lt=v()-Er;Ke.addEvent("ai.stream.finish"),Ke.setAttributes({"ai.response.msToFinish":lt,"ai.response.avgCompletionTokensPerSecond":1e3*Et.completionTokens/lt});break}case "file":{gt.push(V),ge.enqueue(V);break}case "source":case "tool-call-streaming-start":case "tool-call-delta":{ge.enqueue(V);break}case "error":{ge.enqueue(V),$t="error";break}default:{let lt=Oa;throw new Error(`Unknown chunk type: ${lt}`)}}})},flush(V){return T(this,null,function*(){let ge=ot.length>0?JSON.stringify(ot):void 0,it="done";y+1<I&&(b&&$t==="length"&&ot.length===0?it="continue":ot.length>0&&ar.length===ot.length&&(it="tool-result")),b&&sr.length>0&&(it!=="continue"||Ee==="continue"&&!Ca)&&(yield Un({controller:V,chunk:{type:"text-delta",textDelta:sr}}),sr="");try{Ke.setAttributes(me({telemetry:t,attributes:{"ai.response.finishReason":$t,"ai.response.text":{output:()=>Rr},"ai.response.toolCalls":{output:()=>ge},"ai.response.id":Ye.id,"ai.response.model":Ye.modelId,"ai.response.timestamp":Ye.timestamp.toISOString(),"ai.usage.promptTokens":Et.promptTokens,"ai.usage.completionTokens":Et.completionTokens,"gen_ai.response.finish_reasons":[$t],"gen_ai.response.id":Ye.id,"gen_ai.response.model":Ye.modelId,"gen_ai.usage.input_tokens":Et.promptTokens,"gen_ai.usage.output_tokens":Et.completionTokens}}));}catch(qt){}finally{Ke.end();}V.enqueue({type:"step-finish",finishReason:$t,usage:Et,providerMetadata:Cr,experimental_providerMetadata:Cr,logprobs:qn,request:Ar,response:f(p({},Ye),{headers:Mt==null?void 0:Mt.headers}),warnings:ht,isContinued:it==="continue",messageId:nr});let Pr=Si(le,Et);if(it==="done")V.enqueue({type:"finish",finishReason:$t,usage:Pr,providerMetadata:Cr,experimental_providerMetadata:Cr,logprobs:qn,response:f(p({},Ye),{headers:Mt==null?void 0:Mt.headers})}),D.closeStream();else {if(Ee==="continue"){let qt=ie[ie.length-1];typeof qt.content=="string"?qt.content+=Rr:qt.content.push({text:Rr,type:"text"});}else ie.push(...va({text:Rr,files:gt,reasoning:Ae,tools:c!=null?c:{},toolCalls:ot,toolResults:ar,messageId:nr,generateMessageId:A}));yield _e({currentStep:y+1,responseMessages:ie,usage:Pr,stepType:it,previousStepText:Aa,hasLeadingWhitespace:Pa,messageId:it==="continue"?nr:A()});}})}})));})}yield _e({currentStep:0,responseMessages:[],usage:{promptTokens:0,completionTokens:0,totalTokens:0},previousStepText:"",stepType:"initial",hasLeadingWhitespace:!1,messageId:A()});})}).catch(ae=>{D.addStream(new ReadableStream({start(_e){_e.enqueue({type:"error",error:ae}),_e.close();}})),D.closeStream();});}get warnings(){return this.warningsPromise.value}get usage(){return this.usagePromise.value}get finishReason(){return this.finishReasonPromise.value}get experimental_providerMetadata(){return this.providerMetadataPromise.value}get providerMetadata(){return this.providerMetadataPromise.value}get text(){return this.textPromise.value}get reasoning(){return this.reasoningPromise.value}get reasoningDetails(){return this.reasoningDetailsPromise.value}get sources(){return this.sourcesPromise.value}get files(){return this.filesPromise.value}get toolCalls(){return this.toolCallsPromise.value}get toolResults(){return this.toolResultsPromise.value}get request(){return this.requestPromise.value}get response(){return this.responsePromise.value}get steps(){return this.stepsPromise.value}teeStream(){let[e,t]=this.baseStream.tee();return this.baseStream=t,e}get textStream(){return rr(this.teeStream().pipeThrough(new TransformStream({transform({part:e},t){e.type==="text-delta"&&t.enqueue(e.textDelta);}})))}get fullStream(){return rr(this.teeStream().pipeThrough(new TransformStream({transform({part:e},t){t.enqueue(e);}})))}consumeStream(e){return T(this,null,function*(){var t;try{yield Cd({stream:this.fullStream,onError:e==null?void 0:e.onError});}catch(r){(t=e==null?void 0:e.onError)==null||t.call(e,r);}})}get experimental_partialOutputStream(){if(this.output==null)throw new Ni;return rr(this.teeStream().pipeThrough(new TransformStream({transform({partialOutput:e},t){e!=null&&t.enqueue(e);}})))}toDataStreamInternal({getErrorMessage:e=()=>"An error occurred.",sendUsage:t=true,sendReasoning:r=false,sendSources:n=false,experimental_sendFinish:a=true}){return this.fullStream.pipeThrough(new TransformStream({transform:(s,o)=>T(this,null,function*(){let l=s.type;switch(l){case "text-delta":{o.enqueue(Se("text",s.textDelta));break}case "reasoning":{r&&o.enqueue(Se("reasoning",s.textDelta));break}case "redacted-reasoning":{r&&o.enqueue(Se("redacted_reasoning",{data:s.data}));break}case "reasoning-signature":{r&&o.enqueue(Se("reasoning_signature",{signature:s.signature}));break}case "file":{o.enqueue(Se("file",{mimeType:s.mimeType,data:s.base64}));break}case "source":{n&&o.enqueue(Se("source",s.source));break}case "tool-call-streaming-start":{o.enqueue(Se("tool_call_streaming_start",{toolCallId:s.toolCallId,toolName:s.toolName}));break}case "tool-call-delta":{o.enqueue(Se("tool_call_delta",{toolCallId:s.toolCallId,argsTextDelta:s.argsTextDelta}));break}case "tool-call":{o.enqueue(Se("tool_call",{toolCallId:s.toolCallId,toolName:s.toolName,args:s.args}));break}case "tool-result":{o.enqueue(Se("tool_result",{toolCallId:s.toolCallId,result:s.result}));break}case "error":{o.enqueue(Se("error",e(s.error)));break}case "step-start":{o.enqueue(Se("start_step",{messageId:s.messageId}));break}case "step-finish":{o.enqueue(Se("finish_step",{finishReason:s.finishReason,usage:t?{promptTokens:s.usage.promptTokens,completionTokens:s.usage.completionTokens}:void 0,isContinued:s.isContinued}));break}case "finish":{a&&o.enqueue(Se("finish_message",{finishReason:s.finishReason,usage:t?{promptTokens:s.usage.promptTokens,completionTokens:s.usage.completionTokens}:void 0}));break}default:{let u=l;throw new Error(`Unknown chunk type: ${u}`)}}})}))}pipeDataStreamToResponse(e,{status:t,statusText:r,headers:n,data:a,getErrorMessage:s,sendUsage:o,sendReasoning:l,sendSources:u,experimental_sendFinish:c}={}){fa({response:e,status:t,statusText:r,headers:ma(n,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"}),stream:this.toDataStream({data:a,getErrorMessage:s,sendUsage:o,sendReasoning:l,sendSources:u,experimental_sendFinish:c})});}pipeTextStreamToResponse(e,t){fa({response:e,status:t==null?void 0:t.status,statusText:t==null?void 0:t.statusText,headers:ma(t==null?void 0:t.headers,{contentType:"text/plain; charset=utf-8"}),stream:this.textStream.pipeThrough(new TextEncoderStream)});}toDataStream(e){let t=this.toDataStreamInternal({getErrorMessage:e==null?void 0:e.getErrorMessage,sendUsage:e==null?void 0:e.sendUsage,sendReasoning:e==null?void 0:e.sendReasoning,sendSources:e==null?void 0:e.sendSources,experimental_sendFinish:e==null?void 0:e.experimental_sendFinish}).pipeThrough(new TextEncoderStream);return e!=null&&e.data?ba(e==null?void 0:e.data.stream,t):t}mergeIntoDataStream(e,t){e.merge(this.toDataStreamInternal({getErrorMessage:e.onError,sendUsage:t==null?void 0:t.sendUsage,sendReasoning:t==null?void 0:t.sendReasoning,sendSources:t==null?void 0:t.sendSources,experimental_sendFinish:t==null?void 0:t.experimental_sendFinish}));}toDataStreamResponse({headers:e,status:t,statusText:r,data:n,getErrorMessage:a,sendUsage:s,sendReasoning:o,sendSources:l,experimental_sendFinish:u}={}){return new Response(this.toDataStream({data:n,getErrorMessage:a,sendUsage:s,sendReasoning:o,sendSources:l,experimental_sendFinish:u}),{status:t,statusText:r,headers:wr(e,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}toTextStreamResponse(e){var t;return new Response(this.textStream.pipeThrough(new TextEncoderStream),{status:(t=e==null?void 0:e.status)!=null?t:200,headers:wr(e==null?void 0:e.headers,{contentType:"text/plain; charset=utf-8"})})}};var Ud=i.object({name:i.string(),version:i.string()}).passthrough(),wa=i.object({_meta:i.optional(i.object({}).passthrough())}).passthrough(),en=wa,Fd=i.object({method:i.string(),params:i.optional(wa)}),Ld=i.object({experimental:i.optional(i.object({}).passthrough()),logging:i.optional(i.object({}).passthrough()),prompts:i.optional(i.object({listChanged:i.optional(i.boolean())}).passthrough()),resources:i.optional(i.object({subscribe:i.optional(i.boolean()),listChanged:i.optional(i.boolean())}).passthrough()),tools:i.optional(i.object({listChanged:i.optional(i.boolean())}).passthrough())}).passthrough();en.extend({protocolVersion:i.string(),capabilities:Ld,serverInfo:Ud,instructions:i.optional(i.string())});var Zd=en.extend({nextCursor:i.optional(i.string())}),Jd=i.object({name:i.string(),description:i.optional(i.string()),inputSchema:i.object({type:i.literal("object"),properties:i.optional(i.object({}).passthrough())}).passthrough()}).passthrough();Zd.extend({tools:i.array(Jd)});var Vd=i.object({type:i.literal("text"),text:i.string()}).passthrough(),zd=i.object({type:i.literal("image"),data:i.string().base64(),mimeType:i.string()}).passthrough(),rl=i.object({uri:i.string(),mimeType:i.optional(i.string())}).passthrough(),Bd=rl.extend({text:i.string()}),Gd=rl.extend({blob:i.string().base64()}),Hd=i.object({type:i.literal("resource"),resource:i.union([Bd,Gd])}).passthrough();en.extend({content:i.array(i.union([Vd,zd,Hd])),isError:i.boolean().default(false).optional()}).or(en.extend({toolResult:i.unknown()}));var jn="2.0",Wd=i.object({jsonrpc:i.literal(jn),id:i.union([i.string(),i.number().int()])}).merge(Fd).strict(),Kd=i.object({jsonrpc:i.literal(jn),id:i.union([i.string(),i.number().int()]),result:en}).strict(),Yd=i.object({jsonrpc:i.literal(jn),id:i.union([i.string(),i.number().int()]),error:i.object({code:i.number().int(),message:i.string(),data:i.optional(i.unknown())})}).strict(),Xd=i.object({jsonrpc:i.literal(jn)}).merge(i.object({method:i.string(),params:i.optional(wa)})).strict();i.union([Wd,Xd,Kd,Yd]);var Qd={};_a(Qd,{mergeIntoDataStream:()=>rm,toDataStream:()=>em,toDataStreamResponse:()=>tm});function nl(e={}){let t=new TextEncoder,r="";return new TransformStream({start(){return T(this,null,function*(){e.onStart&&(yield e.onStart());})},transform(a,s){return T(this,null,function*(){s.enqueue(t.encode(a)),r+=a,e.onToken&&(yield e.onToken(a)),e.onText&&typeof a=="string"&&(yield e.onText(a));})},flush(){return T(this,null,function*(){e.onCompletion&&(yield e.onCompletion(r)),e.onFinal&&(yield e.onFinal(r));})}})}function xa(e,t){return e.pipeThrough(new TransformStream({transform:(r,n)=>T(null,null,function*(){var a;if(typeof r=="string"){n.enqueue(r);return}if("event"in r){r.event==="on_chat_model_stream"&&Wo((a=r.data)==null?void 0:a.chunk,n);return}Wo(r,n);})})).pipeThrough(nl(t)).pipeThrough(new TextDecoderStream).pipeThrough(new TransformStream({transform:(r,n)=>T(null,null,function*(){n.enqueue(Se("text",r));})}))}function em(e,t){return xa(e,t).pipeThrough(new TextEncoderStream)}function tm(e,t){var r;let n=xa(e,t==null?void 0:t.callbacks).pipeThrough(new TextEncoderStream),a=t==null?void 0:t.data,s=t==null?void 0:t.init,o=a?ba(a.stream,n):n;return new Response(o,{status:(r=s==null?void 0:s.status)!=null?r:200,statusText:s==null?void 0:s.statusText,headers:wr(s==null?void 0:s.headers,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}function rm(e,t){t.dataStream.merge(xa(e,t.callbacks));}function Wo(e,t){if(typeof e.content=="string")t.enqueue(e.content);else {let r=e.content;for(let n of r)n.type==="text"&&t.enqueue(n.text);}}var nm={};_a(nm,{mergeIntoDataStream:()=>om,toDataStream:()=>am,toDataStreamResponse:()=>sm});function Sa(e,t){let r=im();return Ds(e[Symbol.asyncIterator]()).pipeThrough(new TransformStream({transform(a,s){return T(this,null,function*(){s.enqueue(r(a.delta));})}})).pipeThrough(nl(t)).pipeThrough(new TextDecoderStream).pipeThrough(new TransformStream({transform:(a,s)=>T(null,null,function*(){s.enqueue(Se("text",a));})}))}function am(e,t){return Sa(e,t).pipeThrough(new TextEncoderStream)}function sm(e,t={}){var r;let{init:n,data:a,callbacks:s}=t,o=Sa(e,s).pipeThrough(new TextEncoderStream),l=a?ba(a.stream,o):o;return new Response(l,{status:(r=n==null?void 0:n.status)!=null?r:200,statusText:n==null?void 0:n.statusText,headers:wr(n==null?void 0:n.headers,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}function om(e,t){t.dataStream.merge(Sa(e,t.callbacks));}function im(){let e=true;return t=>(e&&(t=t.trimStart(),t&&(e=false)),t)}function lm({prompt:e,useLegacyFunctionCalling:t=false,systemMessageMode:r="system"}){let n=[],a=[];for(let{role:s,content:o}of e)switch(s){case "system":{switch(r){case "system":{n.push({role:"system",content:o});break}case "developer":{n.push({role:"developer",content:o});break}case "remove":{a.push({type:"other",message:"system messages are removed for this model"});break}default:{let l=r;throw new Error(`Unsupported system message mode: ${l}`)}}break}case "user":{if(o.length===1&&o[0].type==="text"){n.push({role:"user",content:o[0].text});break}n.push({role:"user",content:o.map((l,u)=>{var c,d,m,h;switch(l.type){case "text":return {type:"text",text:l.text};case "image":return {type:"image_url",image_url:{url:l.image instanceof URL?l.image.toString():`data:${(c=l.mimeType)!=null?c:"image/jpeg"};base64,${wt(l.image)}`,detail:(m=(d=l.providerMetadata)==null?void 0:d.openai)==null?void 0:m.imageDetail}};case "file":{if(l.data instanceof URL)throw new ee({functionality:"'File content parts with URL data' functionality not supported."});switch(l.mimeType){case "audio/wav":return {type:"input_audio",input_audio:{data:l.data,format:"wav"}};case "audio/mp3":case "audio/mpeg":return {type:"input_audio",input_audio:{data:l.data,format:"mp3"}};case "application/pdf":return {type:"file",file:{filename:(h=l.filename)!=null?h:`part-${u}.pdf`,file_data:`data:application/pdf;base64,${l.data}`}};default:throw new ee({functionality:`File content part type ${l.mimeType} in user messages`})}}}})});break}case "assistant":{let l="",u=[];for(let c of o)switch(c.type){case "text":{l+=c.text;break}case "tool-call":{u.push({id:c.toolCallId,type:"function",function:{name:c.toolName,arguments:JSON.stringify(c.args)}});break}}if(t){if(u.length>1)throw new ee({functionality:"useLegacyFunctionCalling with multiple tool calls in one message"});n.push({role:"assistant",content:l,function_call:u.length>0?u[0].function:void 0});}else n.push({role:"assistant",content:l,tool_calls:u.length>0?u:void 0});break}case "tool":{for(let l of o)t?n.push({role:"function",name:l.toolName,content:JSON.stringify(l.result)}):n.push({role:"tool",tool_call_id:l.toolCallId,content:JSON.stringify(l.result)});break}default:{let l=s;throw new Error(`Unsupported role: ${l}`)}}return {messages:n,warnings:a}}function al(e){var t,r;return (r=(t=e==null?void 0:e.content)==null?void 0:t.map(({token:n,logprob:a,top_logprobs:s})=>({token:n,logprob:a,topLogprobs:s?s.map(({token:o,logprob:l})=>({token:o,logprob:l})):[]})))!=null?r:void 0}function Mn(e){switch(e){case "stop":return "stop";case "length":return "length";case "content_filter":return "content-filter";case "function_call":case "tool_calls":return "tool-calls";default:return "unknown"}}var Ia=i.object({error:i.object({message:i.string(),type:i.string().nullish(),param:i.any().nullish(),code:i.union([i.string(),i.number()]).nullish()})}),dt=Zs({errorSchema:Ia,errorToMessage:e=>e.error.message});function Dn({id:e,model:t,created:r}){return {id:e!=null?e:void 0,modelId:t!=null?t:void 0,timestamp:r!=null?new Date(r*1e3):void 0}}function um({mode:e,useLegacyFunctionCalling:t=false,structuredOutputs:r}){var n;let a=(n=e.tools)!=null&&n.length?e.tools:void 0,s=[];if(a==null)return {tools:void 0,tool_choice:void 0,toolWarnings:s};let o=e.toolChoice;if(t){let c=[];for(let m of a)m.type==="provider-defined"?s.push({type:"unsupported-tool",tool:m}):c.push({name:m.name,description:m.description,parameters:m.parameters});if(o==null)return {functions:c,function_call:void 0,toolWarnings:s};switch(o.type){case "auto":case "none":case void 0:return {functions:c,function_call:void 0,toolWarnings:s};case "required":throw new ee({functionality:"useLegacyFunctionCalling and toolChoice: required"});default:return {functions:c,function_call:{name:o.toolName},toolWarnings:s}}}let l=[];for(let c of a)c.type==="provider-defined"?s.push({type:"unsupported-tool",tool:c}):l.push({type:"function",function:{name:c.name,description:c.description,parameters:c.parameters,strict:r?true:void 0}});if(o==null)return {tools:l,tool_choice:void 0,toolWarnings:s};let u=o.type;switch(u){case "auto":case "none":case "required":return {tools:l,tool_choice:u,toolWarnings:s};case "tool":return {tools:l,tool_choice:{type:"function",function:{name:o.toolName}},toolWarnings:s};default:{let c=u;throw new ee({functionality:`Unsupported tool choice type: ${c}`})}}}var cm=class{constructor(e,t,r){this.specificationVersion="v1",this.modelId=e,this.settings=t,this.config=r;}get supportsStructuredOutputs(){var e;return (e=this.settings.structuredOutputs)!=null?e:Ta(this.modelId)}get defaultObjectGenerationMode(){return mm(this.modelId)?"tool":this.supportsStructuredOutputs?"json":"tool"}get provider(){return this.config.provider}get supportsImageUrls(){return !this.settings.downloadImages}getArgs({mode:e,prompt:t,maxTokens:r,temperature:n,topP:a,topK:s,frequencyPenalty:o,presencePenalty:l,stopSequences:u,responseFormat:c,seed:d,providerMetadata:m}){var h,_,S,I,g,b,k,v;let P=e.type,O=[];s!=null&&O.push({type:"unsupported-setting",setting:"topK"}),(c==null?void 0:c.type)==="json"&&c.schema!=null&&!this.supportsStructuredOutputs&&O.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format schema is only supported with structuredOutputs"});let A=this.settings.useLegacyFunctionCalling;if(A&&this.settings.parallelToolCalls===true)throw new ee({functionality:"useLegacyFunctionCalling with parallelToolCalls"});if(A&&this.supportsStructuredOutputs)throw new ee({functionality:"structuredOutputs with useLegacyFunctionCalling"});let{messages:B,warnings:C}=lm({prompt:t,useLegacyFunctionCalling:A,systemMessageMode:fm(this.modelId)});O.push(...C);let M={model:this.modelId,logit_bias:this.settings.logitBias,logprobs:this.settings.logprobs===true||typeof this.settings.logprobs=="number"?true:void 0,top_logprobs:typeof this.settings.logprobs=="number"?this.settings.logprobs:typeof this.settings.logprobs=="boolean"&&this.settings.logprobs?0:void 0,user:this.settings.user,parallel_tool_calls:this.settings.parallelToolCalls,max_tokens:r,temperature:n,top_p:a,frequency_penalty:o,presence_penalty:l,response_format:(c==null?void 0:c.type)==="json"?this.supportsStructuredOutputs&&c.schema!=null?{type:"json_schema",json_schema:{schema:c.schema,strict:true,name:(h=c.name)!=null?h:"response",description:c.description}}:{type:"json_object"}:void 0,stop:u,seed:d,max_completion_tokens:(_=m==null?void 0:m.openai)==null?void 0:_.maxCompletionTokens,store:(S=m==null?void 0:m.openai)==null?void 0:S.store,metadata:(I=m==null?void 0:m.openai)==null?void 0:I.metadata,prediction:(g=m==null?void 0:m.openai)==null?void 0:g.prediction,reasoning_effort:(k=(b=m==null?void 0:m.openai)==null?void 0:b.reasoningEffort)!=null?k:this.settings.reasoningEffort,messages:B};switch(Ta(this.modelId)?(M.temperature!=null&&(M.temperature=void 0,O.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported for reasoning models"})),M.top_p!=null&&(M.top_p=void 0,O.push({type:"unsupported-setting",setting:"topP",details:"topP is not supported for reasoning models"})),M.frequency_penalty!=null&&(M.frequency_penalty=void 0,O.push({type:"unsupported-setting",setting:"frequencyPenalty",details:"frequencyPenalty is not supported for reasoning models"})),M.presence_penalty!=null&&(M.presence_penalty=void 0,O.push({type:"unsupported-setting",setting:"presencePenalty",details:"presencePenalty is not supported for reasoning models"})),M.logit_bias!=null&&(M.logit_bias=void 0,O.push({type:"other",message:"logitBias is not supported for reasoning models"})),M.logprobs!=null&&(M.logprobs=void 0,O.push({type:"other",message:"logprobs is not supported for reasoning models"})),M.top_logprobs!=null&&(M.top_logprobs=void 0,O.push({type:"other",message:"topLogprobs is not supported for reasoning models"})),M.max_tokens!=null&&(M.max_completion_tokens==null&&(M.max_completion_tokens=M.max_tokens),M.max_tokens=void 0)):(this.modelId.startsWith("gpt-4o-search-preview")||this.modelId.startsWith("gpt-4o-mini-search-preview"))&&M.temperature!=null&&(M.temperature=void 0,O.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported for the search preview models and has been removed."})),P){case "regular":{let{tools:X,tool_choice:ue,functions:we,function_call:ce,toolWarnings:re}=um({mode:e,useLegacyFunctionCalling:A,structuredOutputs:this.supportsStructuredOutputs});return {args:f(p({},M),{tools:X,tool_choice:ue,functions:we,function_call:ce}),warnings:[...O,...re]}}case "object-json":return {args:f(p({},M),{response_format:this.supportsStructuredOutputs&&e.schema!=null?{type:"json_schema",json_schema:{schema:e.schema,strict:true,name:(v=e.name)!=null?v:"response",description:e.description}}:{type:"json_object"}}),warnings:O};case "object-tool":return {args:A?f(p({},M),{function_call:{name:e.tool.name},functions:[{name:e.tool.name,description:e.tool.description,parameters:e.tool.parameters}]}):f(p({},M),{tool_choice:{type:"function",function:{name:e.tool.name}},tools:[{type:"function",function:{name:e.tool.name,description:e.tool.description,parameters:e.tool.parameters,strict:this.supportsStructuredOutputs?true:void 0}}]}),warnings:O};default:{let X=P;throw new Error(`Unsupported type: ${X}`)}}}doGenerate(e){return T(this,null,function*(){var t,r,n,a,s,o,l,u;let{args:c,warnings:d}=this.getArgs(e),{responseHeaders:m,value:h,rawValue:_}=yield je({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:Ie(this.config.headers(),e.headers),body:c,failedResponseHandler:dt,successfulResponseHandler:He(pm),abortSignal:e.abortSignal,fetch:this.config.fetch}),P=c,{messages:S}=P,I=Ce(P,["messages"]),g=h.choices[0],b=(t=h.usage)==null?void 0:t.completion_tokens_details,k=(r=h.usage)==null?void 0:r.prompt_tokens_details,v={openai:{}};return (b==null?void 0:b.reasoning_tokens)!=null&&(v.openai.reasoningTokens=b==null?void 0:b.reasoning_tokens),(b==null?void 0:b.accepted_prediction_tokens)!=null&&(v.openai.acceptedPredictionTokens=b==null?void 0:b.accepted_prediction_tokens),(b==null?void 0:b.rejected_prediction_tokens)!=null&&(v.openai.rejectedPredictionTokens=b==null?void 0:b.rejected_prediction_tokens),(k==null?void 0:k.cached_tokens)!=null&&(v.openai.cachedPromptTokens=k==null?void 0:k.cached_tokens),{text:(n=g.message.content)!=null?n:void 0,toolCalls:this.settings.useLegacyFunctionCalling&&g.message.function_call?[{toolCallType:"function",toolCallId:Ge(),toolName:g.message.function_call.name,args:g.message.function_call.arguments}]:(a=g.message.tool_calls)==null?void 0:a.map(O=>{var A;return {toolCallType:"function",toolCallId:(A=O.id)!=null?A:Ge(),toolName:O.function.name,args:O.function.arguments}}),finishReason:Mn(g.finish_reason),usage:{promptTokens:(o=(s=h.usage)==null?void 0:s.prompt_tokens)!=null?o:NaN,completionTokens:(u=(l=h.usage)==null?void 0:l.completion_tokens)!=null?u:NaN},rawCall:{rawPrompt:S,rawSettings:I},rawResponse:{headers:m,body:_},request:{body:JSON.stringify(c)},response:Dn(h),warnings:d,logprobs:al(g.logprobs),providerMetadata:v}})}doStream(e){return T(this,null,function*(){if(this.settings.simulateStreaming){let g=yield this.doGenerate(e);return {stream:new ReadableStream({start(k){if(k.enqueue(p({type:"response-metadata"},g.response)),g.text&&k.enqueue({type:"text-delta",textDelta:g.text}),g.toolCalls)for(let v of g.toolCalls)k.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:v.toolCallId,toolName:v.toolName,argsTextDelta:v.args}),k.enqueue(p({type:"tool-call"},v));k.enqueue({type:"finish",finishReason:g.finishReason,usage:g.usage,logprobs:g.logprobs,providerMetadata:g.providerMetadata}),k.close();}}),rawCall:g.rawCall,rawResponse:g.rawResponse,warnings:g.warnings}}let{args:t,warnings:r}=this.getArgs(e),n=f(p({},t),{stream:true,stream_options:this.config.compatibility==="strict"?{include_usage:true}:void 0}),{responseHeaders:a,value:s}=yield je({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:Ie(this.config.headers(),e.headers),body:n,failedResponseHandler:dt,successfulResponseHandler:gr(dm),abortSignal:e.abortSignal,fetch:this.config.fetch}),I=t,{messages:o}=I,l=Ce(I,["messages"]),u=[],c="unknown",d={promptTokens:void 0,completionTokens:void 0},m,h=true,{useLegacyFunctionCalling:_}=this.settings,S={openai:{}};return {stream:s.pipeThrough(new TransformStream({transform(g,b){var k,v,P,O,A,B,C,M,X,ue,we,ce;if(!g.success){c="error",b.enqueue({type:"error",error:g.error});return}let re=g.value;if("error"in re){c="error",b.enqueue({type:"error",error:re.error});return}if(h&&(h=false,b.enqueue(p({type:"response-metadata"},Dn(re)))),re.usage!=null){let{prompt_tokens:Q,completion_tokens:oe,prompt_tokens_details:F,completion_tokens_details:L}=re.usage;d={promptTokens:Q!=null?Q:void 0,completionTokens:oe!=null?oe:void 0},(L==null?void 0:L.reasoning_tokens)!=null&&(S.openai.reasoningTokens=L==null?void 0:L.reasoning_tokens),(L==null?void 0:L.accepted_prediction_tokens)!=null&&(S.openai.acceptedPredictionTokens=L==null?void 0:L.accepted_prediction_tokens),(L==null?void 0:L.rejected_prediction_tokens)!=null&&(S.openai.rejectedPredictionTokens=L==null?void 0:L.rejected_prediction_tokens),(F==null?void 0:F.cached_tokens)!=null&&(S.openai.cachedPromptTokens=F==null?void 0:F.cached_tokens);}let pe=re.choices[0];if((pe==null?void 0:pe.finish_reason)!=null&&(c=Mn(pe.finish_reason)),(pe==null?void 0:pe.delta)==null)return;let ye=pe.delta;ye.content!=null&&b.enqueue({type:"text-delta",textDelta:ye.content});let ne=al(pe==null?void 0:pe.logprobs);ne!=null&&ne.length&&(m===void 0&&(m=[]),m.push(...ne));let he=_&&ye.function_call!=null?[{type:"function",id:Ge(),function:ye.function_call,index:0}]:ye.tool_calls;if(he!=null)for(let Q of he){let oe=Q.index;if(u[oe]==null){if(Q.type!=="function")throw new hn({data:Q,message:"Expected 'function' type."});if(Q.id==null)throw new hn({data:Q,message:"Expected 'id' to be a string."});if(((k=Q.function)==null?void 0:k.name)==null)throw new hn({data:Q,message:"Expected 'function.name' to be a string."});u[oe]={id:Q.id,type:"function",function:{name:Q.function.name,arguments:(v=Q.function.arguments)!=null?v:""},hasFinished:false};let L=u[oe];((P=L.function)==null?void 0:P.name)!=null&&((O=L.function)==null?void 0:O.arguments)!=null&&(L.function.arguments.length>0&&b.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:L.id,toolName:L.function.name,argsTextDelta:L.function.arguments}),Kn(L.function.arguments)&&(b.enqueue({type:"tool-call",toolCallType:"function",toolCallId:(A=L.id)!=null?A:Ge(),toolName:L.function.name,args:L.function.arguments}),L.hasFinished=true));continue}let F=u[oe];F.hasFinished||(((B=Q.function)==null?void 0:B.arguments)!=null&&(F.function.arguments+=(M=(C=Q.function)==null?void 0:C.arguments)!=null?M:""),b.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:F.id,toolName:F.function.name,argsTextDelta:(X=Q.function.arguments)!=null?X:""}),((ue=F.function)==null?void 0:ue.name)!=null&&((we=F.function)==null?void 0:we.arguments)!=null&&Kn(F.function.arguments)&&(b.enqueue({type:"tool-call",toolCallType:"function",toolCallId:(ce=F.id)!=null?ce:Ge(),toolName:F.function.name,args:F.function.arguments}),F.hasFinished=true));}},flush(g){var b,k;g.enqueue(p({type:"finish",finishReason:c,logprobs:m,usage:{promptTokens:(b=d.promptTokens)!=null?b:NaN,completionTokens:(k=d.completionTokens)!=null?k:NaN}},S!=null?{providerMetadata:S}:{}));}})),rawCall:{rawPrompt:o,rawSettings:l},rawResponse:{headers:a},request:{body:JSON.stringify(n)},warnings:r}})}},ll=i.object({prompt_tokens:i.number().nullish(),completion_tokens:i.number().nullish(),prompt_tokens_details:i.object({cached_tokens:i.number().nullish()}).nullish(),completion_tokens_details:i.object({reasoning_tokens:i.number().nullish(),accepted_prediction_tokens:i.number().nullish(),rejected_prediction_tokens:i.number().nullish()}).nullish()}).nullish(),pm=i.object({id:i.string().nullish(),created:i.number().nullish(),model:i.string().nullish(),choices:i.array(i.object({message:i.object({role:i.literal("assistant").nullish(),content:i.string().nullish(),function_call:i.object({arguments:i.string(),name:i.string()}).nullish(),tool_calls:i.array(i.object({id:i.string().nullish(),type:i.literal("function"),function:i.object({name:i.string(),arguments:i.string()})})).nullish()}),index:i.number(),logprobs:i.object({content:i.array(i.object({token:i.string(),logprob:i.number(),top_logprobs:i.array(i.object({token:i.string(),logprob:i.number()}))})).nullable()}).nullish(),finish_reason:i.string().nullish()})),usage:ll}),dm=i.union([i.object({id:i.string().nullish(),created:i.number().nullish(),model:i.string().nullish(),choices:i.array(i.object({delta:i.object({role:i.enum(["assistant"]).nullish(),content:i.string().nullish(),function_call:i.object({name:i.string().optional(),arguments:i.string().optional()}).nullish(),tool_calls:i.array(i.object({index:i.number(),id:i.string().nullish(),type:i.literal("function").nullish(),function:i.object({name:i.string().nullish(),arguments:i.string().nullish()})})).nullish()}).nullish(),logprobs:i.object({content:i.array(i.object({token:i.string(),logprob:i.number(),top_logprobs:i.array(i.object({token:i.string(),logprob:i.number()}))})).nullable()}).nullish(),finish_reason:i.string().nullish(),index:i.number()})),usage:ll}),Ia]);function Ta(e){return e.startsWith("o")}function mm(e){return e.startsWith("gpt-4o-audio-preview")}function fm(e){var t,r;return Ta(e)?(r=(t=hm[e])==null?void 0:t.systemMessageMode)!=null?r:"developer":"system"}var hm={"o1-mini":{systemMessageMode:"remove"},"o1-mini-2024-09-12":{systemMessageMode:"remove"},"o1-preview":{systemMessageMode:"remove"},"o1-preview-2024-09-12":{systemMessageMode:"remove"},o3:{systemMessageMode:"developer"},"o3-2025-04-16":{systemMessageMode:"developer"},"o3-mini":{systemMessageMode:"developer"},"o3-mini-2025-01-31":{systemMessageMode:"developer"},"o4-mini":{systemMessageMode:"developer"},"o4-mini-2025-04-16":{systemMessageMode:"developer"}};function gm({prompt:e,inputFormat:t,user:r="user",assistant:n="assistant"}){if(t==="prompt"&&e.length===1&&e[0].role==="user"&&e[0].content.length===1&&e[0].content[0].type==="text")return {prompt:e[0].content[0].text};let a="";e[0].role==="system"&&(a+=`${e[0].content}

`,e=e.slice(1));for(let{role:s,content:o}of e)switch(s){case "system":throw new Qe({message:"Unexpected system message in prompt: ${content}",prompt:e});case "user":{let l=o.map(u=>{switch(u.type){case "text":return u.text;case "image":throw new ee({functionality:"images"})}}).join("");a+=`${r}:
${l}

`;break}case "assistant":{let l=o.map(u=>{switch(u.type){case "text":return u.text;case "tool-call":throw new ee({functionality:"tool-call messages"})}}).join("");a+=`${n}:
${l}

`;break}case "tool":throw new ee({functionality:"tool messages"});default:{let l=s;throw new Error(`Unsupported role: ${l}`)}}return a+=`${n}:
`,{prompt:a,stopSequences:[`
${r}:`]}}function sl(e){return e==null?void 0:e.tokens.map((t,r)=>({token:t,logprob:e.token_logprobs[r],topLogprobs:e.top_logprobs?Object.entries(e.top_logprobs[r]).map(([n,a])=>({token:n,logprob:a})):[]}))}var ym=class{constructor(e,t,r){this.specificationVersion="v1",this.defaultObjectGenerationMode=void 0,this.modelId=e,this.settings=t,this.config=r;}get provider(){return this.config.provider}getArgs({mode:e,inputFormat:t,prompt:r,maxTokens:n,temperature:a,topP:s,topK:o,frequencyPenalty:l,presencePenalty:u,stopSequences:c,responseFormat:d,seed:m}){var h;let _=e.type,S=[];o!=null&&S.push({type:"unsupported-setting",setting:"topK"}),d!=null&&d.type!=="text"&&S.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format is not supported."});let{prompt:I,stopSequences:g}=gm({prompt:r,inputFormat:t}),b=[...g!=null?g:[],...c!=null?c:[]],k={model:this.modelId,echo:this.settings.echo,logit_bias:this.settings.logitBias,logprobs:typeof this.settings.logprobs=="number"?this.settings.logprobs:typeof this.settings.logprobs=="boolean"&&this.settings.logprobs?0:void 0,suffix:this.settings.suffix,user:this.settings.user,max_tokens:n,temperature:a,top_p:s,frequency_penalty:l,presence_penalty:u,seed:m,prompt:I,stop:b.length>0?b:void 0};switch(_){case "regular":{if((h=e.tools)!=null&&h.length)throw new ee({functionality:"tools"});if(e.toolChoice)throw new ee({functionality:"toolChoice"});return {args:k,warnings:S}}case "object-json":throw new ee({functionality:"object-json mode"});case "object-tool":throw new ee({functionality:"object-tool mode"});default:{let v=_;throw new Error(`Unsupported type: ${v}`)}}}doGenerate(e){return T(this,null,function*(){let{args:t,warnings:r}=this.getArgs(e),{responseHeaders:n,value:a,rawValue:s}=yield je({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:Ie(this.config.headers(),e.headers),body:t,failedResponseHandler:dt,successfulResponseHandler:He(vm),abortSignal:e.abortSignal,fetch:this.config.fetch}),c=t,{prompt:o}=c,l=Ce(c,["prompt"]),u=a.choices[0];return {text:u.text,usage:{promptTokens:a.usage.prompt_tokens,completionTokens:a.usage.completion_tokens},finishReason:Mn(u.finish_reason),logprobs:sl(u.logprobs),rawCall:{rawPrompt:o,rawSettings:l},rawResponse:{headers:n,body:s},response:Dn(a),warnings:r,request:{body:JSON.stringify(t)}}})}doStream(e){return T(this,null,function*(){let{args:t,warnings:r}=this.getArgs(e),n=f(p({},t),{stream:true,stream_options:this.config.compatibility==="strict"?{include_usage:true}:void 0}),{responseHeaders:a,value:s}=yield je({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:Ie(this.config.headers(),e.headers),body:n,failedResponseHandler:dt,successfulResponseHandler:gr(_m),abortSignal:e.abortSignal,fetch:this.config.fetch}),h=t,{prompt:o}=h,l=Ce(h,["prompt"]),u="unknown",c={promptTokens:Number.NaN,completionTokens:Number.NaN},d,m=true;return {stream:s.pipeThrough(new TransformStream({transform(_,S){if(!_.success){u="error",S.enqueue({type:"error",error:_.error});return}let I=_.value;if("error"in I){u="error",S.enqueue({type:"error",error:I.error});return}m&&(m=false,S.enqueue(p({type:"response-metadata"},Dn(I)))),I.usage!=null&&(c={promptTokens:I.usage.prompt_tokens,completionTokens:I.usage.completion_tokens});let g=I.choices[0];(g==null?void 0:g.finish_reason)!=null&&(u=Mn(g.finish_reason)),(g==null?void 0:g.text)!=null&&S.enqueue({type:"text-delta",textDelta:g.text});let b=sl(g==null?void 0:g.logprobs);b!=null&&b.length&&(d===void 0&&(d=[]),d.push(...b));},flush(_){_.enqueue({type:"finish",finishReason:u,logprobs:d,usage:c});}})),rawCall:{rawPrompt:o,rawSettings:l},rawResponse:{headers:a},warnings:r,request:{body:JSON.stringify(n)}}})}},vm=i.object({id:i.string().nullish(),created:i.number().nullish(),model:i.string().nullish(),choices:i.array(i.object({text:i.string(),finish_reason:i.string(),logprobs:i.object({tokens:i.array(i.string()),token_logprobs:i.array(i.number()),top_logprobs:i.array(i.record(i.string(),i.number())).nullable()}).nullish()})),usage:i.object({prompt_tokens:i.number(),completion_tokens:i.number()})}),_m=i.union([i.object({id:i.string().nullish(),created:i.number().nullish(),model:i.string().nullish(),choices:i.array(i.object({text:i.string(),finish_reason:i.string().nullish(),index:i.number(),logprobs:i.object({tokens:i.array(i.string()),token_logprobs:i.array(i.number()),top_logprobs:i.array(i.record(i.string(),i.number())).nullable()}).nullish()})),usage:i.object({prompt_tokens:i.number(),completion_tokens:i.number()}).nullish()}),Ia]),bm=class{constructor(e,t,r){this.specificationVersion="v1",this.modelId=e,this.settings=t,this.config=r;}get provider(){return this.config.provider}get maxEmbeddingsPerCall(){var e;return (e=this.settings.maxEmbeddingsPerCall)!=null?e:2048}get supportsParallelCalls(){var e;return (e=this.settings.supportsParallelCalls)!=null?e:true}doEmbed(n){return T(this,arguments,function*({values:e,headers:t,abortSignal:r}){if(e.length>this.maxEmbeddingsPerCall)throw new Ss({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:e});let{responseHeaders:a,value:s}=yield je({url:this.config.url({path:"/embeddings",modelId:this.modelId}),headers:Ie(this.config.headers(),t),body:{model:this.modelId,input:e,encoding_format:"float",dimensions:this.settings.dimensions,user:this.settings.user},failedResponseHandler:dt,successfulResponseHandler:He(wm),abortSignal:r,fetch:this.config.fetch});return {embeddings:s.data.map(o=>o.embedding),usage:s.usage?{tokens:s.usage.prompt_tokens}:void 0,rawResponse:{headers:a}}})}},wm=i.object({data:i.array(i.object({embedding:i.array(i.number())})),usage:i.object({prompt_tokens:i.number()}).nullish()}),xm={"dall-e-3":1,"dall-e-2":10,"gpt-image-1":10},Sm=new Set(["gpt-image-1"]),Tm=class{constructor(e,t,r){this.modelId=e,this.settings=t,this.config=r,this.specificationVersion="v1";}get maxImagesPerCall(){var e,t;return (t=(e=this.settings.maxImagesPerCall)!=null?e:xm[this.modelId])!=null?t:1}get provider(){return this.config.provider}doGenerate(u){return T(this,arguments,function*({prompt:e,n:t,size:r,aspectRatio:n,seed:a,providerOptions:s,headers:o,abortSignal:l}){var c,d,m,h;let _=[];n!=null&&_.push({type:"unsupported-setting",setting:"aspectRatio",details:"This model does not support aspect ratio. Use `size` instead."}),a!=null&&_.push({type:"unsupported-setting",setting:"seed"});let S=(m=(d=(c=this.config._internal)==null?void 0:c.currentDate)==null?void 0:d.call(c))!=null?m:new Date,{value:I,responseHeaders:g}=yield je({url:this.config.url({path:"/images/generations",modelId:this.modelId}),headers:Ie(this.config.headers(),o),body:p(p({model:this.modelId,prompt:e,n:t,size:r},(h=s.openai)!=null?h:{}),Sm.has(this.modelId)?{}:{response_format:"b64_json"}),failedResponseHandler:dt,successfulResponseHandler:He(Im),abortSignal:l,fetch:this.config.fetch});return {images:I.data.map(b=>b.b64_json),warnings:_,response:{timestamp:S,modelId:this.modelId,headers:g}}})}},Im=i.object({data:i.array(i.object({b64_json:i.string()}))}),km=i.object({include:i.array(i.string()).nullish(),language:i.string().nullish(),prompt:i.string().nullish(),temperature:i.number().min(0).max(1).nullish().default(0),timestampGranularities:i.array(i.enum(["word","segment"])).nullish().default(["segment"])}),ol={afrikaans:"af",arabic:"ar",armenian:"hy",azerbaijani:"az",belarusian:"be",bosnian:"bs",bulgarian:"bg",catalan:"ca",chinese:"zh",croatian:"hr",czech:"cs",danish:"da",dutch:"nl",english:"en",estonian:"et",finnish:"fi",french:"fr",galician:"gl",german:"de",greek:"el",hebrew:"he",hindi:"hi",hungarian:"hu",icelandic:"is",indonesian:"id",italian:"it",japanese:"ja",kannada:"kn",kazakh:"kk",korean:"ko",latvian:"lv",lithuanian:"lt",macedonian:"mk",malay:"ms",marathi:"mr",maori:"mi",nepali:"ne",norwegian:"no",persian:"fa",polish:"pl",portuguese:"pt",romanian:"ro",russian:"ru",serbian:"sr",slovak:"sk",slovenian:"sl",spanish:"es",swahili:"sw",swedish:"sv",tagalog:"tl",tamil:"ta",thai:"th",turkish:"tr",ukrainian:"uk",urdu:"ur",vietnamese:"vi",welsh:"cy"},Em=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v1";}get provider(){return this.config.provider}getArgs({audio:e,mediaType:t,providerOptions:r}){var n,a,s,o,l;let u=[],c=hr({provider:"openai",providerOptions:r,schema:km}),d=new FormData,m=e instanceof Uint8Array?new Blob([e]):new Blob([Ot(e)]);if(d.append("model",this.modelId),d.append("file",new File([m],"audio",{type:t})),c){let h={include:(n=c.include)!=null?n:void 0,language:(a=c.language)!=null?a:void 0,prompt:(s=c.prompt)!=null?s:void 0,temperature:(o=c.temperature)!=null?o:void 0,timestamp_granularities:(l=c.timestampGranularities)!=null?l:void 0};for(let _ in h){let S=h[_];S!==void 0&&d.append(_,String(S));}}return {formData:d,warnings:u}}doGenerate(e){return T(this,null,function*(){var t,r,n,a,s,o;let l=(n=(r=(t=this.config._internal)==null?void 0:t.currentDate)==null?void 0:r.call(t))!=null?n:new Date,{formData:u,warnings:c}=this.getArgs(e),{value:d,responseHeaders:m,rawValue:h}=yield Fs({url:this.config.url({path:"/audio/transcriptions",modelId:this.modelId}),headers:Ie(this.config.headers(),e.headers),formData:u,failedResponseHandler:dt,successfulResponseHandler:He(Am),abortSignal:e.abortSignal,fetch:this.config.fetch}),_=d.language!=null&&d.language in ol?ol[d.language]:void 0;return {text:d.text,segments:(s=(a=d.words)==null?void 0:a.map(S=>({text:S.word,startSecond:S.start,endSecond:S.end})))!=null?s:[],language:_,durationInSeconds:(o=d.duration)!=null?o:void 0,warnings:c,response:{timestamp:l,modelId:this.modelId,headers:m,body:h}}})}},Am=i.object({text:i.string(),language:i.string().nullish(),duration:i.number().nullish(),words:i.array(i.object({word:i.string(),start:i.number(),end:i.number()})).nullish()});function Cm({prompt:e,systemMessageMode:t}){let r=[],n=[];for(let{role:a,content:s}of e)switch(a){case "system":{switch(t){case "system":{r.push({role:"system",content:s});break}case "developer":{r.push({role:"developer",content:s});break}case "remove":{n.push({type:"other",message:"system messages are removed for this model"});break}default:{let o=t;throw new Error(`Unsupported system message mode: ${o}`)}}break}case "user":{r.push({role:"user",content:s.map((o,l)=>{var u,c,d,m;switch(o.type){case "text":return {type:"input_text",text:o.text};case "image":return {type:"input_image",image_url:o.image instanceof URL?o.image.toString():`data:${(u=o.mimeType)!=null?u:"image/jpeg"};base64,${wt(o.image)}`,detail:(d=(c=o.providerMetadata)==null?void 0:c.openai)==null?void 0:d.imageDetail};case "file":{if(o.data instanceof URL)throw new ee({functionality:"File URLs in user messages"});switch(o.mimeType){case "application/pdf":return {type:"input_file",filename:(m=o.filename)!=null?m:`part-${l}.pdf`,file_data:`data:application/pdf;base64,${o.data}`};default:throw new ee({functionality:"Only PDF files are supported in user messages"})}}}})});break}case "assistant":{for(let o of s)switch(o.type){case "text":{r.push({role:"assistant",content:[{type:"output_text",text:o.text}]});break}case "tool-call":{r.push({type:"function_call",call_id:o.toolCallId,name:o.toolName,arguments:JSON.stringify(o.args)});break}}break}case "tool":{for(let o of s)r.push({type:"function_call_output",call_id:o.toolCallId,output:JSON.stringify(o.result)});break}default:{let o=a;throw new Error(`Unsupported role: ${o}`)}}return {messages:r,warnings:n}}function il({finishReason:e,hasToolCalls:t}){switch(e){case void 0:case null:return t?"tool-calls":"stop";case "max_output_tokens":return "length";case "content_filter":return "content-filter";default:return t?"tool-calls":"unknown"}}function Rm({mode:e,strict:t}){var r;let n=(r=e.tools)!=null&&r.length?e.tools:void 0,a=[];if(n==null)return {tools:void 0,tool_choice:void 0,toolWarnings:a};let s=e.toolChoice,o=[];for(let u of n)switch(u.type){case "function":o.push({type:"function",name:u.name,description:u.description,parameters:u.parameters,strict:t?true:void 0});break;case "provider-defined":switch(u.id){case "openai.web_search_preview":o.push({type:"web_search_preview",search_context_size:u.args.searchContextSize,user_location:u.args.userLocation});break;default:a.push({type:"unsupported-tool",tool:u});break}break;default:a.push({type:"unsupported-tool",tool:u});break}if(s==null)return {tools:o,tool_choice:void 0,toolWarnings:a};let l=s.type;switch(l){case "auto":case "none":case "required":return {tools:o,tool_choice:l,toolWarnings:a};case "tool":return s.toolName==="web_search_preview"?{tools:o,tool_choice:{type:"web_search_preview"},toolWarnings:a}:{tools:o,tool_choice:{type:"function",name:s.toolName},toolWarnings:a};default:{let u=l;throw new ee({functionality:`Unsupported tool choice type: ${u}`})}}}var Pm=class{constructor(e,t){this.specificationVersion="v1",this.defaultObjectGenerationMode="json",this.supportsStructuredOutputs=true,this.modelId=e,this.config=t;}get provider(){return this.config.provider}getArgs({mode:e,maxTokens:t,temperature:r,stopSequences:n,topP:a,topK:s,presencePenalty:o,frequencyPenalty:l,seed:u,prompt:c,providerMetadata:d,responseFormat:m}){var h,_,S;let I=[],g=Wm(this.modelId),b=e.type;s!=null&&I.push({type:"unsupported-setting",setting:"topK"}),u!=null&&I.push({type:"unsupported-setting",setting:"seed"}),o!=null&&I.push({type:"unsupported-setting",setting:"presencePenalty"}),l!=null&&I.push({type:"unsupported-setting",setting:"frequencyPenalty"}),n!=null&&I.push({type:"unsupported-setting",setting:"stopSequences"});let{messages:k,warnings:v}=Cm({prompt:c,systemMessageMode:g.systemMessageMode});I.push(...v);let P=hr({provider:"openai",providerOptions:d,schema:Km}),O=(h=P==null?void 0:P.strictSchemas)!=null?h:true,A=p(p(f(p({model:this.modelId,input:k,temperature:r,top_p:a,max_output_tokens:t},(m==null?void 0:m.type)==="json"&&{text:{format:m.schema!=null?{type:"json_schema",strict:O,name:(_=m.name)!=null?_:"response",description:m.description,schema:m.schema}:{type:"json_object"}}}),{metadata:P==null?void 0:P.metadata,parallel_tool_calls:P==null?void 0:P.parallelToolCalls,previous_response_id:P==null?void 0:P.previousResponseId,store:P==null?void 0:P.store,user:P==null?void 0:P.user,instructions:P==null?void 0:P.instructions}),g.isReasoningModel&&((P==null?void 0:P.reasoningEffort)!=null||(P==null?void 0:P.reasoningSummary)!=null)&&{reasoning:p(p({},(P==null?void 0:P.reasoningEffort)!=null&&{effort:P.reasoningEffort}),(P==null?void 0:P.reasoningSummary)!=null&&{summary:P.reasoningSummary})}),g.requiredAutoTruncation&&{truncation:"auto"});switch(g.isReasoningModel&&(A.temperature!=null&&(A.temperature=void 0,I.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported for reasoning models"})),A.top_p!=null&&(A.top_p=void 0,I.push({type:"unsupported-setting",setting:"topP",details:"topP is not supported for reasoning models"}))),b){case "regular":{let{tools:B,tool_choice:C,toolWarnings:M}=Rm({mode:e,strict:O});return {args:f(p({},A),{tools:B,tool_choice:C}),warnings:[...I,...M]}}case "object-json":return {args:f(p({},A),{text:{format:e.schema!=null?{type:"json_schema",strict:O,name:(S=e.name)!=null?S:"response",description:e.description,schema:e.schema}:{type:"json_object"}}}),warnings:I};case "object-tool":return {args:f(p({},A),{tool_choice:{type:"function",name:e.tool.name},tools:[{type:"function",name:e.tool.name,description:e.tool.description,parameters:e.tool.parameters,strict:O}]}),warnings:I};default:{let B=b;throw new Error(`Unsupported type: ${B}`)}}}doGenerate(e){return T(this,null,function*(){var t,r,n,a,s,o,l;let{args:u,warnings:c}=this.getArgs(e),{responseHeaders:d,value:m,rawValue:h}=yield je({url:this.config.url({path:"/responses",modelId:this.modelId}),headers:Ie(this.config.headers(),e.headers),body:u,failedResponseHandler:dt,successfulResponseHandler:He(i.object({id:i.string(),created_at:i.number(),model:i.string(),output:i.array(i.discriminatedUnion("type",[i.object({type:i.literal("message"),role:i.literal("assistant"),content:i.array(i.object({type:i.literal("output_text"),text:i.string(),annotations:i.array(i.object({type:i.literal("url_citation"),start_index:i.number(),end_index:i.number(),url:i.string(),title:i.string()}))}))}),i.object({type:i.literal("function_call"),call_id:i.string(),name:i.string(),arguments:i.string()}),i.object({type:i.literal("web_search_call")}),i.object({type:i.literal("computer_call")}),i.object({type:i.literal("reasoning"),summary:i.array(i.object({type:i.literal("summary_text"),text:i.string()}))})])),incomplete_details:i.object({reason:i.string()}).nullable(),usage:ul})),abortSignal:e.abortSignal,fetch:this.config.fetch}),_=m.output.filter(g=>g.type==="message").flatMap(g=>g.content).filter(g=>g.type==="output_text"),S=m.output.filter(g=>g.type==="function_call").map(g=>({toolCallType:"function",toolCallId:g.call_id,toolName:g.name,args:g.arguments})),I=(r=(t=m.output.find(g=>g.type==="reasoning"))==null?void 0:t.summary)!=null?r:null;return {text:_.map(g=>g.text).join(`
`),sources:_.flatMap(g=>g.annotations.map(b=>{var k,v,P;return {sourceType:"url",id:(P=(v=(k=this.config).generateId)==null?void 0:v.call(k))!=null?P:Ge(),url:b.url,title:b.title}})),finishReason:il({finishReason:(n=m.incomplete_details)==null?void 0:n.reason,hasToolCalls:S.length>0}),toolCalls:S.length>0?S:void 0,reasoning:I?I.map(g=>({type:"text",text:g.text})):void 0,usage:{promptTokens:m.usage.input_tokens,completionTokens:m.usage.output_tokens},rawCall:{rawPrompt:void 0,rawSettings:{}},rawResponse:{headers:d,body:h},request:{body:JSON.stringify(u)},response:{id:m.id,timestamp:new Date(m.created_at*1e3),modelId:m.model},providerMetadata:{openai:{responseId:m.id,cachedPromptTokens:(s=(a=m.usage.input_tokens_details)==null?void 0:a.cached_tokens)!=null?s:null,reasoningTokens:(l=(o=m.usage.output_tokens_details)==null?void 0:o.reasoning_tokens)!=null?l:null}},warnings:c}})}doStream(e){return T(this,null,function*(){let{args:t,warnings:r}=this.getArgs(e),{responseHeaders:n,value:a}=yield je({url:this.config.url({path:"/responses",modelId:this.modelId}),headers:Ie(this.config.headers(),e.headers),body:f(p({},t),{stream:true}),failedResponseHandler:dt,successfulResponseHandler:gr(Fm),abortSignal:e.abortSignal,fetch:this.config.fetch}),s=this,o="unknown",l=NaN,u=NaN,c=null,d=null,m=null,h={},_=false;return {stream:a.pipeThrough(new TransformStream({transform(S,I){var g,b,k,v,P,O,A,B;if(!S.success){o="error",I.enqueue({type:"error",error:S.error});return}let C=S.value;if(Bm(C))C.item.type==="function_call"&&(h[C.output_index]={toolName:C.item.name,toolCallId:C.item.call_id},I.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:C.item.call_id,toolName:C.item.name,argsTextDelta:C.item.arguments}));else if(zm(C)){let M=h[C.output_index];M!=null&&I.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:M.toolCallId,toolName:M.toolName,argsTextDelta:C.delta});}else Vm(C)?(m=C.response.id,I.enqueue({type:"response-metadata",id:C.response.id,timestamp:new Date(C.response.created_at*1e3),modelId:C.response.model})):Lm(C)?I.enqueue({type:"text-delta",textDelta:C.delta}):Hm(C)?I.enqueue({type:"reasoning",textDelta:C.delta}):Zm(C)&&C.item.type==="function_call"?(h[C.output_index]=void 0,_=true,I.enqueue({type:"tool-call",toolCallType:"function",toolCallId:C.item.call_id,toolName:C.item.name,args:C.item.arguments})):Jm(C)?(o=il({finishReason:(g=C.response.incomplete_details)==null?void 0:g.reason,hasToolCalls:_}),l=C.response.usage.input_tokens,u=C.response.usage.output_tokens,c=(k=(b=C.response.usage.input_tokens_details)==null?void 0:b.cached_tokens)!=null?k:c,d=(P=(v=C.response.usage.output_tokens_details)==null?void 0:v.reasoning_tokens)!=null?P:d):Gm(C)&&I.enqueue({type:"source",source:{sourceType:"url",id:(B=(A=(O=s.config).generateId)==null?void 0:A.call(O))!=null?B:Ge(),url:C.annotation.url,title:C.annotation.title}});},flush(S){S.enqueue(p({type:"finish",finishReason:o,usage:{promptTokens:l,completionTokens:u}},(c!=null||d!=null)&&{providerMetadata:{openai:{responseId:m,cachedPromptTokens:c,reasoningTokens:d}}}));}})),rawCall:{rawPrompt:void 0,rawSettings:{}},rawResponse:{headers:n},request:{body:JSON.stringify(t)},warnings:r}})}},ul=i.object({input_tokens:i.number(),input_tokens_details:i.object({cached_tokens:i.number().nullish()}).nullish(),output_tokens:i.number(),output_tokens_details:i.object({reasoning_tokens:i.number().nullish()}).nullish()}),Om=i.object({type:i.literal("response.output_text.delta"),delta:i.string()}),Nm=i.object({type:i.enum(["response.completed","response.incomplete"]),response:i.object({incomplete_details:i.object({reason:i.string()}).nullish(),usage:ul})}),jm=i.object({type:i.literal("response.created"),response:i.object({id:i.string(),created_at:i.number(),model:i.string()})}),Mm=i.object({type:i.literal("response.output_item.done"),output_index:i.number(),item:i.discriminatedUnion("type",[i.object({type:i.literal("message")}),i.object({type:i.literal("function_call"),id:i.string(),call_id:i.string(),name:i.string(),arguments:i.string(),status:i.literal("completed")})])}),Dm=i.object({type:i.literal("response.function_call_arguments.delta"),item_id:i.string(),output_index:i.number(),delta:i.string()}),$m=i.object({type:i.literal("response.output_item.added"),output_index:i.number(),item:i.discriminatedUnion("type",[i.object({type:i.literal("message")}),i.object({type:i.literal("function_call"),id:i.string(),call_id:i.string(),name:i.string(),arguments:i.string()})])}),qm=i.object({type:i.literal("response.output_text.annotation.added"),annotation:i.object({type:i.literal("url_citation"),url:i.string(),title:i.string()})}),Um=i.object({type:i.literal("response.reasoning_summary_text.delta"),item_id:i.string(),output_index:i.number(),summary_index:i.number(),delta:i.string()}),Fm=i.union([Om,Nm,jm,Mm,Dm,$m,qm,Um,i.object({type:i.string()}).passthrough()]);function Lm(e){return e.type==="response.output_text.delta"}function Zm(e){return e.type==="response.output_item.done"}function Jm(e){return e.type==="response.completed"||e.type==="response.incomplete"}function Vm(e){return e.type==="response.created"}function zm(e){return e.type==="response.function_call_arguments.delta"}function Bm(e){return e.type==="response.output_item.added"}function Gm(e){return e.type==="response.output_text.annotation.added"}function Hm(e){return e.type==="response.reasoning_summary_text.delta"}function Wm(e){return e.startsWith("o")?e.startsWith("o1-mini")||e.startsWith("o1-preview")?{isReasoningModel:true,systemMessageMode:"remove",requiredAutoTruncation:false}:{isReasoningModel:true,systemMessageMode:"developer",requiredAutoTruncation:false}:{isReasoningModel:false,systemMessageMode:"system",requiredAutoTruncation:false}}var Km=i.object({metadata:i.any().nullish(),parallelToolCalls:i.boolean().nullish(),previousResponseId:i.string().nullish(),store:i.boolean().nullish(),user:i.string().nullish(),reasoningEffort:i.string().nullish(),strictSchemas:i.boolean().nullish(),instructions:i.string().nullish(),reasoningSummary:i.string().nullish()}),Ym=i.object({});function Xm({searchContextSize:e,userLocation:t}={}){return {type:"provider-defined",id:"openai.web_search_preview",args:{searchContextSize:e,userLocation:t},parameters:Ym}}var Qm={webSearchPreview:Xm},ef=i.object({instructions:i.string().nullish(),speed:i.number().min(.25).max(4).default(1).nullish()}),tf=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v1";}get provider(){return this.config.provider}getArgs({text:e,voice:t="alloy",outputFormat:r="mp3",speed:n,instructions:a,providerOptions:s}){let o=[],l=hr({provider:"openai",providerOptions:s,schema:ef}),u={model:this.modelId,input:e,voice:t,response_format:"mp3",speed:n,instructions:a};if(r&&(["mp3","opus","aac","flac","wav","pcm"].includes(r)?u.response_format=r:o.push({type:"unsupported-setting",setting:"outputFormat",details:`Unsupported output format: ${r}. Using mp3 instead.`})),l){let c={};for(let d in c){let m=c[d];m!==void 0&&(u[d]=m);}}return {requestBody:u,warnings:o}}doGenerate(e){return T(this,null,function*(){var t,r,n;let a=(n=(r=(t=this.config._internal)==null?void 0:t.currentDate)==null?void 0:r.call(t))!=null?n:new Date,{requestBody:s,warnings:o}=this.getArgs(e),{value:l,responseHeaders:u,rawValue:c}=yield je({url:this.config.url({path:"/audio/speech",modelId:this.modelId}),headers:Ie(this.config.headers(),e.headers),body:s,failedResponseHandler:dt,successfulResponseHandler:Js(),abortSignal:e.abortSignal,fetch:this.config.fetch});return {audio:l,warnings:o,request:{body:JSON.stringify(s)},response:{timestamp:a,modelId:this.modelId,headers:u,body:c}}})}};function ka(e={}){var t,r,n;let a=(t=Vs(e.baseURL))!=null?t:"https://api.openai.com/v1",s=(r=e.compatibility)!=null?r:"compatible",o=(n=e.name)!=null?n:"openai",l=()=>p({Authorization:`Bearer ${Us({apiKey:e.apiKey,environmentVariableName:"OPENAI_API_KEY",description:"OpenAI"})}`,"OpenAI-Organization":e.organization,"OpenAI-Project":e.project},e.headers),u=(b,k={})=>new cm(b,k,{provider:`${o}.chat`,url:({path:v})=>`${a}${v}`,headers:l,compatibility:s,fetch:e.fetch}),c=(b,k={})=>new ym(b,k,{provider:`${o}.completion`,url:({path:v})=>`${a}${v}`,headers:l,compatibility:s,fetch:e.fetch}),d=(b,k={})=>new bm(b,k,{provider:`${o}.embedding`,url:({path:v})=>`${a}${v}`,headers:l,fetch:e.fetch}),m=(b,k={})=>new Tm(b,k,{provider:`${o}.image`,url:({path:v})=>`${a}${v}`,headers:l,fetch:e.fetch}),h=b=>new Em(b,{provider:`${o}.transcription`,url:({path:k})=>`${a}${k}`,headers:l,fetch:e.fetch}),_=b=>new tf(b,{provider:`${o}.speech`,url:({path:k})=>`${a}${k}`,headers:l,fetch:e.fetch}),S=(b,k)=>{if(new.target)throw new Error("The OpenAI model function cannot be called with the new keyword.");return b==="gpt-3.5-turbo-instruct"?c(b,k):u(b,k)},I=b=>new Pm(b,{provider:`${o}.responses`,url:({path:k})=>`${a}${k}`,headers:l,fetch:e.fetch}),g=function(b,k){return S(b,k)};return g.languageModel=S,g.chat=u,g.completion=c,g.responses=I,g.embedding=d,g.textEmbedding=d,g.textEmbeddingModel=d,g.image=m,g.imageModel=m,g.transcription=h,g.transcriptionModel=h,g.speech=_,g.speechModel=_,g.tools=Qm,g}ka({compatibility:"strict"});var rf=(e,t,r,n,a,s)=>T(null,null,function*(){let{text:o}=yield Yi({model:e.openAI.chat(r,p({},t)),prompt:n,system:a}),l=new TextEncoder().encode(o);Dart.send_value(s,l);}),nf=(e,t,r,n)=>T(null,null,function*(){let a=tl({model:e.openAI.responses(t),prompt:r});try{for(var s=sn(a.fullStream),o,l,u;o=!(l=yield s.next()).done;o=!1){let c=l.value;if(c.type==="reasoning"||c.type==="text-delta"){let d=new TextEncoder().encode(c.textDelta);Dart.stream_value(n,d);}}}catch(l){u=[l];}finally{try{o&&(l=s.return)&&(yield l.call(s));}finally{if(u)throw u[0]}}Dart.stream_value_end(n);}),af=(e,t,r,n,a)=>T(null,null,function*(){let s=$r.convert(n),o=yield ki({model:e.openAI.responses(t),schema:s,prompt:r}),l=JsonPayload.encode(o.object);if(!l){Dart.send_error(a,"Failed to encode object");return}Dart.send_value(a,l);}),sf=(e,t,r,n,a)=>T(null,null,function*(){let s=$r.convert(n),{fullStream:o}=yield Ci({model:e.openAI.responses(t),schema:s,prompt:r});try{for(var l=sn(o),u,c,d;u=!(c=yield l.next()).done;u=!1){let m=c.value;if(m.type!="object")continue;let h=JsonPayload.encode(m.object);if(!h){Dart.send_error(a,"Failed to encode object");return}Dart.stream_value(a,h);}}catch(c){d=[c];}finally{try{u&&(c=l.return)&&(yield c.call(l));}finally{if(d)throw d[0]}}Dart.stream_value_end(a);}),fw={init:e=>({openAI:ka({apiKey:e,compatibility:"strict"})}),functions:{openai_chat_generate_text:rf,openai_chat_generate_object:af,openai_chat_stream_text:nf,openai_chat_stream_object:sf}};
export{fw as default};
''';
