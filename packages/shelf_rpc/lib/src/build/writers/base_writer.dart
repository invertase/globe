import 'package:dart_style/dart_style.dart';
import 'package:shelf_rpc/src/build/sourced_entrypoint.dart';
import 'package:shelf_rpc/src/build/sourced_imports.dart';

const header = '''
// GENERATED CODE - DO NOT MODIFY BY HAND
// This file was generated by shelf_rpc.
// ignore_for_file: non_constant_identifier_names, unused_local_variable, implementation_imports, no_leading_underscores_for_local_identifiers, prefer_null_aware_operators

''';

/// A base class for writing the generated code.
abstract class BaseWriter {
  /// Creates a new [BaseWriter] instance.
  BaseWriter({required this.imports, required this.entrypoints});

  /// The imports of the generated code.
  final SourcedImports imports;

  /// The entrypoints of the generated code.
  final List<SourcedEntrypoint> entrypoints;

  /// The formatter for the generated code.
  final formatter = DartFormatter(
    languageVersion: DartFormatter.latestLanguageVersion,
  );

  /// The buffer for the generated code.
  final StringBuffer b = StringBuffer(header.trimLeft());

  /// Writes the generated code.
  String write();

  /// Writes the imports of the generated code with keyed aliases.
  String writeImports() {
    final b = StringBuffer();
    for (var i = 0; i < imports.imports.length; i++) {
      final uri = imports.imports.elementAt(i);
      b.writeln("import '$uri' as i$i;");
    }
    return b.toString();
  }
}
